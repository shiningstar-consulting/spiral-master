```
SPIRAL ver.2 APIリファレンス

### App
- **getアプリ一覧を取得**  
- **getアプリを取得**  

### DB
- **getDB一覧を取得**  
- **getDBを取得**  

### Record
- **getレコード一覧を取得**  
- **postレコードを登録**  
- **getレコードを取得**  
- **patchレコードを変更**  
- **delレコードを削除**  
- **get参照先フィールドを含めたレコード一覧を取得**  
- **get参照先フィールドを含めたレコードを取得**  
- **postレコードを検証**  

### Record (bulk)
- **post複数レコードを登録**  
- **patch複数レコードを更新**  
- **del複数レコードを削除**  
```
```
Export
------
- **GET**: レコード一括出力依頼一覧を取得
- **POST**: レコード一括出力依頼を作成
- **GET**: レコード一括出力依頼を取得
- **POST**: レコード一括出力依頼をキャンセル

Record (Batch)
--------------
- **GET**: レコード一括登録依頼一覧を取得
- **POST**: レコード一括登録依頼を作成
- **GET**: レコード一括登録依頼を取得
- **POST**: レコード一括登録依頼をキャンセル
- **GET**: レコード一括更新依頼一覧を取得
- **POST**: レコード一括更新依頼を作成
```
```
APIリファレンス

---

### レコード一括更新関連

- **一括更新依頼を作成**
  - メソッド: `POST`

- **一括更新依頼を取得**
  - メソッド: `GET`

- **一括更新依頼をキャンセル**
  - メソッド: `POST`

---

### レコード一括削除関連

- **一括削除依頼一覧を取得**
  - メソッド: `GET`

- **一括削除依頼を作成**
  - メソッド: `POST`

- **一括削除依頼を取得**
  - メソッド: `GET`

- **一括削除依頼をキャンセル**
  - メソッド: `POST`

---

### ファイル関連 (Record File)

- **ファイルアップロードトークンを発行**
  - メソッド: `POST`

- **ファイルをアップロード**
  - メソッド: `POST`

- **ファイルをダウンロード**
  - メソッド: `GET`
```
### APIリファレンス

#### EXPRESSメール

**Email**

- `GET`  
  EXPRESSメール設定一覧を取得

- `POST`  
  EXPRESSメール設定を作成

- `GET`  
  EXPRESSメール設定を取得

- `PATCH`  
  EXPRESSメール設定を更新

- `DELETE`  
  EXPRESSメール設定を削除

- `POST`  
  テスト配信を実行

**Email Job**

- `GET`  
  EXPRESSメール配信ジョブ一覧を取得

- `GET`  
  EXPRESSメール配信ジョブを取得

**App Log**

- `GET`  
  EXPRESSメール配信ログ一覧を取得

---

#### アプリ管理

**App**

- `GET`  
  アプリ一覧を取得

- `POST`  
  アプリを作成

- `GET`  
  アプリを取得

- `PATCH`  
  アプリを変更

- `DELETE`  
  アプリを削除

---

#### データベース (DB)

**DB**

- `GET`  
  DB一覧を取得

- `POST`  
  DBを作成

- `GET`  
  DBを取得

- `PATCH`  
  DBを変更
# API リファレンス

## 概要

以下は SPIRAL ver.2 API のドキュメントです。本番環境およびベータ環境で動作します。

### エンドポイント
- **本番環境**: `https://api.spiral-platform.com/v1/apps`
- **ベータ環境**: `https://api.beta.spiral-platform.net/v1/apps`

## アクション一覧

### lDB を削除
- **HTTP メソッド**: POST
- **説明**: 指定された lDB を削除するアクション。

### SITE Authentication
- **HTTP メソッド**: POST
- **説明**: 各種認証エリアに関するアクション。

#### 認証エリアにログイン
- **HTTP メソッド**: POST
- **説明**: 認証エリアにログインする。

#### 認証トークンの有効性確認
- **HTTP メソッド**: POST
- **説明**: 発行された認証トークンが有効かを確認する。

#### 認証エリアログインのワンタイム URL 発行
- **HTTP メソッド**: POST
- **説明**: 認証エリアログイン用のワンタイム URL を発行する。

#### 認証エリアからログアウト
- **HTTP メソッド**: POST
- **説明**: 認証エリアからログアウトする。

---

## SPIRAL ver.2 App

### アクション

#### アプリ一覧を取得
- **HTTP メソッド**: GET  
- **エンドポイント**:
  - 本番環境: `https://api.spiral-platform.com/v1/apps`
  - ベータ環境: `https://api.beta.spiral-platform.net/v1/apps`
  
- **説明**: SPIRAL ver.2 のアプリ一覧を取得する。

#### ヘッダー情報
- **X-Spiral-App-Authority ヘッダー**:
  - 値が `use` の場合、アプリパッケージでインポート中のアプリはレスポンスに含まれません。

#### クエリパラメータ
1. **ids**  
   - **型**: Array of strings  
   - **制限**: 最大 200 アイテム  
   - **説明**: 検索するアプリ ID のリスト。

2. **querystring**  
   - **型**: String  
   - **説明**: 検索するアプリのキーワード (例: 表示名、説明)。部分一致による検索が可能です。

---

## その他

- **ドキュメント**: ReDoc により整備されています。
- **バージョン**: SPIRAL ver.2 API (1.1)
- **OpenAPI 仕様ダウンロード**: 利用可能
### API リファレンス

#### パラメータ

---

**`sort`**  
- **型:** string  
- **デフォルト値:** `"createdAt:desc"`  
- **値の選択肢:** `"id:asc"`, `"id:desc"`, `"name:asc"`, `"name:desc"`, `"displayName:asc"`, `"displayName:desc"`, `"createdAt:asc"`, `"createdAt:desc"`, `"updatedAt:asc"`, `"updatedAt:desc"`  
- **説明:** ソートの対象はID、識別名、表示名、作成日時、更新日時のいずれかを指定可能。`":asc"`で昇順、`":desc"`で降順に指定。

---

**`offset`**  
- **型:** integer  
- **例:** `offset=20`  
- **説明:** リストのオフセット値。

---

**`limit`**  
- **型:** integer  
- **範囲:** [1 .. 200]  
- **デフォルト値:** `20`  
- **例:** `limit=20`  
- **説明:** リストの取得上限値。

---

**ヘーダーパラメータ**

---

**`X-Spiral-App-Authority`**  
- **型:** string  
- **デフォルト値:** `"use"`  
- **値の選択肢:** `"use"`, `"manage"`  
- **例:** `"manage"`  
- **説明:**  
  アプリの権限種別を指定。利用 (`use`) または管理 (`manage`) のどちらかを選択する。  
  ヘッダーを省略するとデフォルトで `"use"`（利用）としてAPIが実行される。

---

#### レスポンス

**成功時:** 200  
- **説明:** 検索条件にマッチするアプリの一覧を取得。

---

**レスポンスヘッダー**

---

**`X-Spiral-App-Authority`**  
- **型:** string  
- **値の選択肢:** `"use"`, `"manage"`  
- **例:** `"manage"`  
- **説明:** アプリの権限種別。

---

**レスポンスデータ: `application/json`**  
- **型:** Array of objects (**items**)  
- **説明:** アプリの一覧。

---

**追加フィールド**

---

**`prevOffset`**  
- **型:** integer  
- **説明:** 前のリストのオフセット値。  
  前のリストが存在しない場合は `null` を返す。 
### API Reference: アプリ取得

---

#### **基本情報**
- **APIエンドポイント (本番環境):**
  - `https://api.spiral-platform.com/v1/apps/{appId}`
- **APIエンドポイント (ベータ環境):**
  - `https://api.beta.spiral-platform.net/v1/apps/{appId}`

- **概要:**
  - 指定された `appId` に基づき、アプリの情報を取得します。

- **制限事項:**
  - `X-Spiral-App-Authority` ヘッダーに `use` を指定している場合、アプリパッケージでインポート中のアプリは取得できません。

---

#### **パラメータ**

##### **1. Path Parameters**
| **パラメータ名** | **必須** | **型**   | **説明**     |
|------------------|----------|----------|--------------|
| `appId`          | 必須     | `string` | アプリID      |

##### **2. Header Parameters**
| **パラメータ名**               | **必須** | **型**      | **デフォルト値** | **説明**                                                                                          |
|--------------------------------|----------|-------------|-----------------|--------------------------------------------------------------------------------------------------|
| `X-Spiral-App-Authority`       | オプション | `string`    | `use`           | アプリ権限の種別。利用または管理としてAPIを実行する立場を指定します。                              |
|                                |           |             |                 | **Enum**: `"use"`, `"manage"`                                                                   |
|                                |           |             |                 | **例**: `manage`                                                                                |

---

#### **レスポンス**

##### **フィールド説明**
| **フィールド名**        | **型**     | **説明**                                   |
|--------------------------|------------|--------------------------------------------|
| `nextOffset`             | `integer` | 次のリストのオフセット。リストが存在しない場合は `null` |
| `totalCount`             | `integer` | 検索結果の全件数                           |
| `items`                  | `array`   | アプリ情報リスト                           |
| &emsp;`id`              | `string`  | アプリID                                   |
| &emsp;`name`            | `string`  | アプリ名                                   |
| &emsp;`displayName`     | `string`  | 表示名                                     |
| &emsp;`description`     | `string`  | アプリの説明                               |
| &emsp;`revision`        | `integer` | リビジョン                                 |
| &emsp;`version`         | `integer` | バージョン                                 |
| &emsp;`defaultPhpVersion` | `string`  | デフォルトのPHPバージョン                  |
| &emsp;`createdBy`       | `object`  | 作成者情報                                 |
| &emsp;&emsp;`type`     | `string`  | 作成者の種別 (`user` または他のタイプ)     |
| &emsp;&emsp;`userId`   | `string`  | 作成者のユーザーID                         |
| &emsp;`updatedBy`       | `object`  | 更新者情報                                 |
| &emsp;&emsp;`type`     | `string`  | 更新者の種別 (`user` または他のタイプ)     |
| &emsp;&emsp;`userId`   | `string`  | 更新者のユーザーID                         |
| &emsp;`createdAt`       | `string`  | 作成日時 (ISO8601形式)                     |
| &emsp;`updatedAt`       | `string`  | 更新日時 (ISO8601形式)                     |
| `prevOffset`             | `integer` | 前のリストのオフセット                     |

---

##### **レスポンス例**: `200 OK`

Content-type: `application/json`

```json
{
  "items": [
    {
      "id": "100",
      "name": "Name",
      "displayName": "アプリ",
      "description": "アプリ説明",
      "revision": 2,
      "version": 1,
      "defaultPhpVersion": "7.4",
      "createdBy": {
        "type": "user",
        "userId": "100"
      },
      "updatedBy": {
        "type": "user",
        "userId": "100"
      },
      "createdAt": "2019-08-24T14:15:22Z",
      "updatedAt": "2019-08-24T14:15:22Z"
    }
  ],
  "prevOffset": 0,
  "nextOffset": 40,
  "totalCount": 200
}
```
```
# APIリファレンス

## ヘッダーの指定 
- ヘッダーの指定を省略した場合、`use`（利用）が指定されたものとしてAPIが実行される。

---

## Responses

### 200 OK
指定したアプリを取得。

#### Response Headers
| Header Name          | Type   | Description                          |
|----------------------|--------|--------------------------------------|
| `X-Spiral-App-Authority` | string | アプリ権限種別。以下の値を取る：<br> - `use`<br> - `manage` <br> **Example**: `manage` |

---

#### Response Schema (application/json)
| Field Name              | Type      | Description                                                                                                             |
|-------------------------|-----------|-------------------------------------------------------------------------------------------------------------------------|
| `id`                    | string    | アプリのID。識別名（重複不可）。<br> **制約条件**:<br> - 長さ: 1～64文字<br> - 使用可能文字: アルファベット（大文字小文字）、数字、アンダースコア<br> - 最初の文字はアルファベットである必要がある<br> **未指定の場合**: 自動発行される。 |
| `name`                  | string    | 識別名（`id` としての役割）。同義。                                                                                    |
| `displayName`           | string    | 表示名                                                                                                               |
| `description`           | string    | 説明                                                                                                                 |
| `revision`              | integer   | リビジョン番号。アプリを変更するたびにカウントアップされる数値。                                                        |
| `version`               | integer   | バージョン                                                                                                           |
| `defaultPhpVersion`     | string    | 現在指定可能なPHPバージョン。以下のEnum値を取る：<br> - `7.4`<br> - `8.1`<br> - `system_default`<br> **現在の`system_default`**: `8.1`  |
```
### APIリファレンス

#### 説明
- **system_default**  
  - `system_default`を選択している場合、将来PHPサービス推奨バージョンが更新されると自動的にサービス推奨バージョンを参照します。

---

### オブジェクト詳細

#### データモデル
- **createdBy**  
  - 型: `object`  
  - 説明: 作成者

- **updatedBy**  
  - 型: `object`  
  - 説明: 更新者。更新がない場合は`createdBy`と同じ。

- **createdAt**  
  - 型: `string` (`<date-time>`)  
  - 説明: 作成日時

- **updatedAt**  
  - 型: `string` (`<date-time>`)  
  - 説明: 更新日時。更新がない場合は`createdAt`と同じ。

---

### エラーレスポンス

#### ステータスコード: 403  
以下のいずれかのケースで発生します:
1. アプリの利用権限がない場合
2. アプリ管理の設定権限がない場合

##### レスポンスヘッダー
- **X-Spiral-App-Authority**  
  - 型: `string`  
  - Enum値:
    - `"use"`
    - `"manage"`  
  - 例: `"manage"`  
  - 説明: アプリ権限種別

---

### サンプルレスポンス

- **HTTPステータス: 200**
- **Content-Type:** `application/json`

```json
{
  "id": "100",
  "name": "Name",
  "displayName": "アプリ",
  "description": "アプリ説明",
  "revision": 2,
  "version": 1,
  "defaultPhpVersion": "7.4",
  "createdBy": {
    "type": "user",
    "userId": "100"
  },
  "updatedBy": {
    "type": "user",
    "userId": "100"
  },
  "createdAt": "2019-08-24T14:15:22Z",
  "updatedAt": "2019-08-24T14:15:22Z"
}
```

---

### エンドポイント一覧

#### DB一覧を取得
- **エンドポイント:**  
  `GET /apps/{app}/dbs`

- **対象:**  
  SPIRAL ver.2 APIサーバ（本番環境）
# API Reference

## Endpoint
### Base URLs
- Production: `https://api.spiral-platform.com/v1/apps/{app}/dbs` (Spiral ver.2 API Server)
- Beta: `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs` (Beta Environment)

### Description
Retrieve a list of databases.

---

## Parameters

### 1. Path Parameters

- **app** (required):  
  **Type**: `string`  
  **Description**: Application ID.

---

### 2. Query Parameters

- **query** (optional):  
  **Type**: `string`  
  **Description**: Keyword for searching databases (based on display name or description).

- **sort** (optional):  
  **Type**: `string`  
  **Default**: `"createdAt:desc"`  
  **Enum**: 
  - `"id:asc"`
  - `"id:desc"`
  - `"name:asc"`
  - `"name:desc"`
  - `"displayName:asc"`
  - `"displayName:desc"`
  - `"createdAt:asc"`
  - `"createdAt:desc"`
  - `"updatedAt:asc"`
  - `"updatedAt:desc"`  
  **Description**: Sorting criteria for results (based on ID, identifier name, display name, creation date, or update date).  
  Use `":asc"` for ascending order or `":desc"` for descending order.

- **offset** (optional):  
  **Type**: `integer`  
  **Example**: `offset=20`  
  **Description**: Offset for the results list.

- **limit** (optional):  
  **Type**: `integer`  
  **Range**: `[ 1 .. 200 ]`  
  **Default**: `20`  
  **Example**: `limit=20`  
  **Description**: Maximum number of results to return.

---

### 3. Header Parameters

- **X-Spiral-App-Authority** (optional):  
  **Type**: `string`  
  **Default**: `"use"`  
  **Enum**: 
  - `"use"`
  - `"manage"`  
  **Example**: `manage`  
  **Description**: Specifies the permission level when executing the API (either `use` or `manage`).  
  If not specified, the system defaults to `use`.


### API リファレンス

---

#### Request Headers

- **X-Spiral-App-Roles**
  - Default: `_fullAccess`
  - Example: `"employee"`（アプリロール）
  - ヘッダーの指定が省略された場合、「全権限」のアプリロールがデフォルトで指定されます。
  - リクエストしたユーザ・APIエージェントが指定されたアプリロールに対する権限を持たない場合、エラーとなります。

- **X-Spiral-App-Authority**
  - 説明: `use`の場合にのみ指定が必要。
  - Enum:
    - `"use"`
    - `"manage"`

---

#### Responses

##### 200 OK
- **Description**: 取得したDBの一覧。

###### **Response Headers**
- **X-Spiral-App-Authority**
  - Type: `string`
  - Enum:
    - `"use"`
    - `"manage"`
  - Example: `"manage"`（アプリ権限種別）
  
- **X-Spiral-App-Roles**
  - Type: `string`
  - Example: `"employee"`（アプリロール）

###### **Response Schema: `application/json`**
- **items**
  - Type: `Array of objects`
  - Description: DBの一覧
- **prevOffset**
  - Type: `integer`
  - Description: 前のリストのオフセット。前のリストが存在しない場合は`null`。
- **nextOffset**
  - Type: `integer`
  - Description: 次のリストのオフセット。次のリストが存在しない場合は`null`。
- **totalCount**
  - Type: `integer`
  - Description: 検索結果の全件数。

---

##### 403 Forbidden
- **Description**: 以下のいずれかのケースで発生します。
  1. アプリの利用権限がない（または不足している）。
  2. アプリ管理の設定権限がない。
```
Response Headers
----------------
1. **X-Spiral-App-Authority**  
   - Type: `string`  
   - Enum: `"use"`, `"manage"`  
   - Example: `"manage"`  
   - Description: アプリ権限種別  

2. **X-Spiral-App-Role**  
   - Type: `string`  
   - Example: `"employee"`  
   - Description: アプリロール  

Response Samples
----------------
Status Code: **200**  
Content Type: `application/json`  

**Sample Response:**
```json
{
  "items": [
    {
      "id": "100",
      "name": "inquirydb",
      "displayName": "問い合わせ管理DB",
      "description": "問い合わせを管理するDBです",
      "revision": "1",
      "fields": [
        {
          "id": "1",
          "name": "name",
          "displayName": "氏名",
          "size": 128,
          "fieldOrder": 0,
          "type": "text",
          "required": true,
          "unique": true
        }
      ]
    }
  ]
}
```
```json
[
  {
    "id": "1",
    "name": "name",
    "displayName": "名前",
    "size": 128,
    "fieldOrder": 0,
    "type": "text",
    "required": false,
    "unique": false,
    "index": true,
    "minLength": "1",
    "maxLength": "128",
    "allowCharTypes": ["alphabet", "multibyte"],
    "regexp": "example.*"
  },
  {
    "id": "2",
    "name": "inquiry_detail",
    "displayName": "問い合わせ内容",
    "size": 1024,
    "fieldOrder": 1,
    "type": "textarea",
    "required": false,
    "unique": false,
    "index": false,
    "minLength": "1",
    "maxLength": "20000",
    "allowCharTypes": ["numeral", "alphabet", "sign", "multibyte"],
    "regexp": "example.*"
  },
  {
    "id": "3",
    "name": "email",
    "displayName": "メールアドレス",
    "size": 256,
    "fieldOrder": 2,
    "type": "email",
    "required": true,
    "unique": true,
    "index": true,
    "regexp": "^[a-z]+[.]+[a-z]*@."
  }
]
```
```json
[
  {
    "id": "4",
    "name": "gender",
    "displayName": "性別",
    "size": 8,
    "fieldOrder": 3,
    "type": "select",
    "required": true,
    "index": true,
    "options": [
      {
        "id": "1",
        "label": "男性"
      },
      {
        "id": "2",
        "label": "女性"
      }
    ]
  },
  {
    "id": "5",
    "name": "inquiry_type",
    "displayName": "問い合わせ種別",
    "size": 125,
    "fieldOrder": 4,
    "type": "multiselect",
    "required": true,
    "index": false,
    "minSelection": "1",
    "maxSelection": "4",
    "options": [
      {
        "id": "1",
        "label": "資料請求"
      },
      {
        "id": "2",
        "label": ""
      }
    ]
  }
]
```
```json
[
  {
    "id": "3",
    "label": "サポート"
  },
  {
    "id": "4",
    "label": "その他"
  },
  {
    "id": "6",
    "name": "inquiry_ID",
    "displayName": "問い合わせID",
    "size": 8,
    "fieldOrder": 5,
    "type": "integer",
    "required": true,
    "unique": true,
    "index": true,
    "minRange": "1",
    "maxRange": "10000"
  },
  {
    "id": "7",
    "name": "weight",
    "displayName": "重量",
    "size": 8,
    "fieldOrder": 6,
    "type": "double",
    "required": true,
    "unique": false,
    "index": true,
    "minRange": "0",
    "maxRange": "100.0",
    "decimalDigit": {
      "digitNumber": "1",
      "enableRoundDown": false
    }
  },
  {
    "id": "8",
    "name": "phone",
    "displayName": "電話番号"
  }
]
```
```json
[
  {
    "id": "7",
    "name": "phone",
    "displayName": null,
    "size": 19,
    "fieldOrder": 7,
    "type": "phone",
    "required": true,
    "unique": true,
    "index": true,
    "phoneRegionCode": "JP"
  },
  {
    "id": "9",
    "name": "response_date_time",
    "displayName": "対応日時",
    "size": 8,
    "fieldOrder": 8,
    "type": "dateTime",
    "required": true,
    "unique": false,
    "index": false,
    "minRange": "1989-12-31T15:00:00Z",
    "maxRange": "2021-12-31T14:30:00Z"
  },
  {
    "id": "10",
    "name": "response_date",
    "displayName": "対応日付",
    "size": 4,
    "fieldOrder": 9,
    "type": "date",
    "required": true,
    "unique": false,
    "index": true,
    "minRange": "1900-01-01",
    "maxRange": "2021-12-31"
  }
]
```
```json
[
  {
    "id": null,
    "name": "preferred_date",
    "displayName": "希望日",
    "size": 8,
    "fieldOrder": 10,
    "type": "monthDay",
    "required": false,
    "unique": false,
    "index": false,
    "minRange": "01-01",
    "maxRange": "12-31"
  },
  {
    "id": "12",
    "name": "preferred_time",
    "displayName": "希望時刻",
    "size": 8,
    "fieldOrder": 11,
    "type": "time",
    "required": true,
    "unique": false,
    "index": false,
    "minRange": "06:00:00",
    "maxRange": "12:00:00"
  },
  {
    "id": "13",
    "name": "file",
    "displayName": "添付ファイル",
    "size": null,
    "fieldOrder": 12,
    "type": "file",
    "required": true,
    "allowFileExtensionCategories": ["text"],
    "allowFileExtensions": ["jpe", "jpg", "txt", "csv", "tsv"]
  }
]
```
- **File Settings**  
  - `maxFiles`: **10**  
  - `maxFileSize`: **104857600**

- **Fields**  
  - **Field 1**  
    - `id`: **14**  
    - `name`: **password**  
    - `displayName`: **パスワード**  
    - `size`: **128**  
    - `fieldOrder`: **13**  
    - `type`: **password**  
    - `required`: **true**  
    - Validation:  
      - `minLength`: **8**  
      - `maxLength`: **128**  
      - `allowCharTypes`: **["numeral", "sign", "lowercase_alphabet", "uppercase_alphabet"]**  
      - `minCharTypes`: **4**
  - **Field 2**  
    - `id`: **15**  
    - `name`: **customer**  
    - `displayName`: **顧客**  
    - `size`: **8**  
    - `fieldOrder`: **14**  
    - `type`: **reference**  
    - `required`: **true**  
    - Reference Settings:  
      - `referenceDb`:  
        - `id`: **1**  
        - `name`: **customer_address**  
        - `displayName`: **顧客アドレス**  
      - `referenceMultiple`: **true**  
      - `referenceLabelField`:  
        - `type`: **_id**  
        - `id`: **_id**  
        - `name`: **_id**  
        - `displayName`: **(ID)**
```
APIリファレンス: データベース詳細取得

**エンドポイント**
GET /apps/{app}/dbs/{db}

**説明**
指定されたアプリケーションとデータベースについての詳細情報を取得します。

**レスポンス例**
```json
{
  "fields": [
    {
      "id": "16",
      "name": "response_person",
      "displayName": "問い合わせ担当者",
      "size": 320,
      "fieldOrder": 15,
      "type": "user",
      "defaultValue": {
        "type": "dynamic",
        "valueType": 5,
        "isOverwrite": true
      },
      "required": true,
      "unique": false,
      "index": false
    }
  ],
  "references": [
    {
      "minReference": "1",
      "maxReference": "10",
      "onReferenceDelete": "restrict",
      "multipleUnique": "1"
    }
  ],
  "createdBy": {
    "type": "user",
    "userId": "100"
  },
  "updatedBy": {
    "type": "user",
    "userId": "100"
  },
  "createdAt": "2021-01-28T03:57:23Z",
  "updatedAt": "2021-01-28T03:57:23Z",
  "pagination": {
    "prevOffset": 0,
    "nextOffset": 40,
    "totalCount": 200
  }
}
```

**フィールド詳細**

1. `fields`: データベースの各フィールド情報を表すリスト。
    - `id` (string): フィールドのID
    - `name` (string): フィールド名
    - `displayName` (string): 表示名
    - `size` (integer): フィールドのサイズ
    - `fieldOrder` (integer): フィールドの表示順
    - `type` (string): フィールドのタイプ (例: "user")
    - `defaultValue` (object): 基本値に関する設定
      - `type` (string): 基本値のタイプ (例: "dynamic")
      - `valueType` (integer): 値のタイプ（数値として表される）
      - `isOverwrite` (boolean): 上書き可能かどうか
    - `required` (boolean): 必須であるかどうか
    - `unique` (boolean): 一意性制約があるかどうか
    - `index` (boolean): インデックスが設定されているかどうか

2. `references`: 参照情報に関する設定。
    - `minReference` (string): 最小参照数
    - `maxReference` (string): 最大参照数
    - `onReferenceDelete` (string): 参照削除時の挙動（例: "restrict"）
    - `multipleUnique` (string): 複数一意制約の指定

3. `createdBy` / `updatedBy`: 作成者および更新者情報。
    - `type` (string): 作成者のタイプ (例: "user")
    - `userId` (string): 作成者のユーザーID

4. `createdAt` / `updatedAt`: 作成日時および更新日時（ISO 8601フォーマット）。

5. `pagination`: ページネーション情報。
    - `prevOffset` (integer): 前のオフセット値
    - `nextOffset` (integer): 次のオフセット値
    - `totalCount` (integer): 総アイテム数
```


## API リファレンス: SPIRAL ver.2 APIサーバ (ベータ環境)

### Base URL
- **Production Environment**: `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}`
- **Beta Environment**: `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}`

### 機能概要
指定されたアプリケーション (`app`) とデータベース (`db`) を取得します。

---

### HTTP メソッド
`GET`

---

### パスパラメータ (Path Parameters)
| パラメータ名 | 必須 | 型     | 説明      |
|--------------|------|--------|-----------|
| `app`        | 必須 | string | アプリID   |
| `db`         | 必須 | string | DBID       |

---

### ヘッダパラメータ (Header Parameters)
| パラメータ名                  | 型     | デフォルト値      | 説明                              |
|-------------------------------|--------|-------------------|-----------------------------------|
| `X-Spiral-App-Authority`      | string | `use`             | アプリ権限種別を指定します。<br>値の選択肢: `"use"`・`"manage"`<br>例: `"manage"`<br>※ヘッダーを省略した場合、`"use"` が指定されます。 |
| `X-Spiral-App-Role`           | string | `_fullAccess`     | アプリロール（`X-Spiral-App-Authority` が `"use"` の場合に必要）。<br>例: `"employee"`<br>※ヘッダーを省略した場合、`"_fullAccess"` (全権限) として実行されます。<br>ユーザ・APIエージェントが権限を持たない場合、エラーとなります。 |

---

### レスポンス
| ステータスコード | 内容       |
|------------------|------------|
| `200`           | DB設定情報 |

---

### 注意事項
- **権限とロール**:  
  `X-Spiral-App-Authority` に基づき、以下の点に留意してください:
  - `"use"`: 利用者としてAPIを実行します。この場合、`X-Spiral-App-Role` の指定が必要です。
  - `"manage"`: 管理者としてAPIを実行します。この場合、`X-Spiral-App-Role` の指定は不要です。
```
Response Headers:
- **X-Spiral-App-Authority** (string):  
  Enum: `"use"`, `"manage"`  
  Example: `"manage"`  
  説明: アプリ権限種別  

- **X-Spiral-App-Role** (string):  
  Example: `"employee"`  
  説明: アプリロール  

---

Response Schema: `application/json`
- **id** (string):  
  説明: DBID  
  *制約:*
  - 長さ: 1～64文字  
  - アルファベット大文字・小文字、数字、アンダースコアのみ使用可能  
  - 最初の文字はアルファベットである必要がある  
  - 重複不可  
  - 未指定の場合、自動発行  

- **name** (string):  
  説明: 識別名  
  *制約:*
  - 長さ: 1～64文字  
  - 上記と同様のフォーマット制約あり  

- **displayName** (string):  
  説明: DB表示名  
  *制約:*
  - 長さ: 1～64文字  

- **description** (string):  
  説明: DB説明  
  *制約:*
  - 長さ: 0～512文字  

- **revision** (string):  
  説明: DBリビジョン  

- **fields** (Array of objects):  
  説明: フィールド一覧  

- **createdBy** (object):  
  説明: 作成者  

- **updatedBy** (object):  
  説明: 更新者  
  *詳細:*
  - 更新がない場合、作成者と同じ  

- **createdAt** (string `<date-time>`):  
  説明: 作成日時  

- **updatedAt** (string `<date-time>`):  
  説明: 更新日時  
  *詳細:*
  - 更新がない場合、作成日時と同じ  

---

Error:  
- **403 Forbidden:**  
  *発生条件:*
  - アプリの利用権限がない（または不足している）
  - アプリ管理の設定権限がない
```
---

### Response Headers

- **X-Spiral-App-Authority**
  - **Type:** String
  - **Enum:** `"use"`, `"manage"`
  - **Example:** `"manage"`
  - **Description:** アプリ権限種別

- **X-Spiral-App-Role**
  - **Type:** String
  - **Example:** `"employee"`
  - **Description:** アプリロール

---

### Response Samples

#### HTTP Status: 200  

- **Content Type:** application/json  
- **Sample Response:**

```json
{
  "id": "100",
  "name": "inquirydb",
  "displayName": "問い合わせ管理DB",
  "description": "問い合わせを管理するDBです",
  "revision": "1",
  "fields": [
    {
      "id": "1",
      "name": "name",
      "displayName": "氏名",
      "size": 128,
      "fieldOrder": 0,
      "type": "text",
      "required": true,
      "unique": false,
      "index": false
    }
  ]
}
```
```json
[
  {
    "id": "1",
    "name": "name",
    "displayName": "利用者名",
    "size": 128,
    "fieldOrder": 0,
    "type": "text",
    "required": true,
    "unique": false,
    "index": false,
    "minLength": "1",
    "maxLength": "128",
    "allowCharTypes": ["alphabet", "multibyte"],
    "regexp": "example.*"
  },
  {
    "id": "2",
    "name": "inquiry_detail",
    "displayName": "問い合わせ内容",
    "size": 1024,
    "fieldOrder": 1,
    "type": "textarea",
    "required": false,
    "unique": false,
    "index": false,
    "minLength": "1",
    "maxLength": "20000",
    "allowCharTypes": ["numeral", "alphabet", "sign", "multibyte"],
    "regexp": "example.*"
  },
  {
    "id": "3",
    "name": "email",
    "displayName": "メールアドレス",
    "size": 256,
    "fieldOrder": 2,
    "type": "email",
    "required": true,
    "unique": true,
    "index": true,
    "regexp": "^[a-z]+[.]+[a-z]*@."
  }
]
```
```json
[
  {
    "id": "4",
    "name": "gender",
    "displayName": "性別",
    "size": 8,
    "fieldOrder": 3,
    "type": "select",
    "required": true,
    "index": true,
    "options": [
      {
        "id": "1",
        "label": "男性"
      },
      {
        "id": "2",
        "label": "女性"
      }
    ]
  },
  {
    "id": "5",
    "name": "inquiry_type",
    "displayName": "問い合わせ種別",
    "size": 125,
    "fieldOrder": 4,
    "type": "multiselect",
    "required": true,
    "index": false,
    "minSelection": "1",
    "maxSelection": "4",
    "options": [
      {
        "id": "1",
        "label": "資料請求"
      },
      {
        "id": "2",
        "label": ""
      }
    ]
  }
]
```
```json
[
  {
    "id": "3",
    "label": "サポート"
  },
  {
    "id": "4",
    "label": "その他"
  }
],
{
  "id": "6",
  "name": "inquiry_ID",
  "displayName": "問い合わせID",
  "size": 8,
  "fieldOrder": 5,
  "type": "integer",
  "required": true,
  "unique": true,
  "index": true,
  "minRange": "1",
  "maxRange": "10000"
},
{
  "id": "7",
  "name": "weight",
  "displayName": "重量",
  "size": 8,
  "fieldOrder": 6,
  "type": "double",
  "required": true,
  "unique": false,
  "index": true,
  "minRange": "0",
  "maxRange": "100.0",
  "decimalDigit": {
    "digitNumber": "1",
    "enableRoundDown": false
  }
},
{
  "id": "8",
  "name": "phone",
  "displayName": "電話番号"
}
```
```json
[
  {
    "id": "7",
    "name": "phone",
    "displayName": "Phone Number",
    "size": 19,
    "fieldOrder": 7,
    "type": "phone",
    "required": true,
    "unique": true,
    "index": true,
    "phoneRegionCode": "JP"
  },
  {
    "id": "9",
    "name": "response_date_time",
    "displayName": "対応日時",
    "size": 8,
    "fieldOrder": 8,
    "type": "dateTime",
    "required": true,
    "unique": false,
    "index": false,
    "minRange": "1989-12-31T15:00:00Z",
    "maxRange": "2021-12-31T14:30:00Z"
  },
  {
    "id": "10",
    "name": "response_date",
    "displayName": "対応日付",
    "size": 4,
    "fieldOrder": 9,
    "type": "date",
    "required": true,
    "unique": false,
    "index": true,
    "minRange": "1900-01-01",
    "maxRange": "2021-12-31"
  }
]
```
```json
[
  {
    "id": null,
    "name": "preferred_date",
    "displayName": "希望日",
    "size": 8,
    "fieldOrder": 10,
    "type": "monthDay",
    "required": false,
    "unique": false,
    "index": false,
    "minRange": "01-01",
    "maxRange": "12-31"
  },
  {
    "id": "12",
    "name": "preferred_time",
    "displayName": "希望時刻",
    "size": 8,
    "fieldOrder": 11,
    "type": "time",
    "required": true,
    "unique": false,
    "index": false,
    "minRange": "06:00:00",
    "maxRange": "12:00:00"
  },
  {
    "id": "13",
    "name": "file",
    "displayName": "添付ファイル",
    "size": "null",
    "fieldOrder": 12,
    "type": "file",
    "required": true,
    "allowFileExtensionCategories": ["text"],
    "allowFileExtensions": ["jpe", "jpg", "txt", "csv", "tsv"]
  }
]
```
```json
{
  "maxFiles": 10,
  "maxFileSize": 104857600
},
{
  "id": "14",
  "name": "password",
  "displayName": "パスワード",
  "size": 128,
  "fieldOrder": 13,
  "type": "password",
  "required": true,
  "minLength": 8,
  "maxLength": 128,
  "allowCharTypes": [
    "numeral",
    "sign",
    "lowercase_alphabet",
    "uppercase_alphabet"
  ],
  "minCharTypes": 4
},
{
  "id": "15",
  "name": "customer",
  "displayName": "顧客",
  "size": 8,
  "fieldOrder": 14,
  "type": "reference",
  "required": true,
  "referenceDb": {
    "id": "1",
    "name": "customer_address",
    "displayName": "顧客アドレス"
  },
  "referenceMultiple": true,
  "referenceLabelField": {
    "type": "_id",
    "id": "_id",
    "name": "_id",
    "displayName": "(ID)"
  },
  "referenceUnique": null
}
```
### API Reference: レコード一覧取得

#### 概要
特定のアプリケーションおよびデータベース内のレコード一覧を取得するエンドポイント。

---

### 構造化データ

#### フィールド情報

- **id**: `16`
- **name**: `response_person`
- **displayName**: `問い合わせ担当者`
- **size**: `320`
- **fieldOrder**: `15`
- **type**: `user`
- **defaultValue**:
  - **type**: `dynamic`
  - **valueType**: `5`
  - **isOverwrite**: `true`
- **required**: `true`
- **unique**: `false`
- **index**: `false`

---

#### データベース制約

- **minReference**: `"1"`
- **maxReference**: `"10"`
- **onReferenceDelete**: `"restrict"`
- **multipleUnique**: `"1"`

---

#### 作成者情報

- **createdBy**:
  - **type**: `user`
  - **userId**: `100`
- **createdAt**: `2021-01-28T03:57:23Z`

---

#### 更新者情報

- **updatedBy**:
  - **type**: `user`
  - **userId**: `100`
- **updatedAt**: `2021-01-28T03:57:23Z`

---

### エンドポイント詳細

#### メソッド
`GET`

#### エンドポイント URL
`get/apps/{app}/dbs/{db}/records`

#### 説明
指定されたアプリケーションおよびデータベースのレコード一覧を取得します。
### APIリファレンス

---

#### エンドポイント  
- **通常環境**: `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records`
- **ベータ環境**: `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records`

指定した条件に一致するレコードの一覧を取得します。

---

### パスパラメータ (path Parameters)

| パラメータ | 必須 | 種類 | 説明          |
|------------|------|------|---------------|
| `app`      | Yes  | string | アプリID     |
| `db`       | Yes  | string | DBID         |

---

### クエリパラメータ (query Parameters)

#### `fields`
- **型:** `Array of strings`  
- **最大数:** 150 アイテム  
- **デフォルト値:** `"全フィールド"`  
- **例:** `fields=name,age`  
- **説明:** 出力するフィールド識別名を配列で指定します。  
  - メタ情報フィールドは指定不可ですが、レスポンスには必ず含まれます。

---

#### `query`
- **型:** `string`  
- **例:** `query=AAA`  
- **説明:** フィールドを横断して検索する際の検索文字列を指定します。  
  - 検索は部分一致検索となります。  
  - 最大 128 文字まで指定可能。129 文字以上を指定するとエラーとなります。  
  - `queryFields` で検索対象のフィールドを指定する必要があります。  
  - `queryFields` が指定されていない場合、エラーとなります。

---

#### `queryFields`
- **型:** `Array of strings`  
- **例:** `queryFields="1,2,5,100"`  
- **説明:** フィールドを横断して文字列検索する際の検索対象フィールドの ID を指定します。

--- 
### APIリファレンス

---

#### **フィールドタイプ**
- **指定可能なフィールドタイプ:**
  - テキスト型
  - テキストエリア型
  - メールアドレス型

- **注意事項:**
  - 複数フィールドを指定する場合は、カンマ区切りで指定し、**OR検索**として扱われます。
  - **参照先のフィールドは指定不可**。

---

#### **検索条件 (query)**

- **`query`パラメータ:**
  - 検索対象の文字列を指定するパラメータ。
  - 必須項目： `query` を指定しない場合、エラーが発生します。

---

#### **抽出条件式 (where)**

- **`where`パラメータ:**
  - データを条件式で絞り込むための式を指定。

- **書式例:**
  ```text
  where=@age >= 30 AND @name = 'yamada'
  ```
  - 特殊文字は以下のようにエンコードされます:
    - `+` は `%2b`
    - `%` は `%%`

- **具体例:**
  ```text
  where=1%2b1=2
  ```

  ```text
  where=1%%1=1
  ```

---

#### **参照元フィルタリング (referrer)**

- **`referrer`パラメータ:**
  - 参照元から参照されているレコードを絞り込みます。

- **書式例:**
  ```text
  referrer=123.4:56
  ```

- **フォーマット形式:**
  ```text
  [参照元DB ID].[参照フィールドID]:[参照元レコードID]
  ```
  または
  ```text
  @[アプリ識別名].[参照元DB識別名].[参照フィールド識別名]:[参照元レコードID]
  ```

- **注意事項:**
  - 存在しないデータベース（DB）、フィールド、またはレコードを指定することはできません。

--- 


### API Reference

#### Parameters

1. **referrer**
   - Description:  
     指定すると、アプリロールで閲覧権限のないレコードを含んだ結果を返します。ただし、以下の制限があります:
       - フィールド値は返されず、キー `_id` および `_unauthorized` のみとなります。
   - Restrictions:  
     - `includeUnauthorized` パラメータとの同時指定は不可。

2. **includeUnauthorized**
   - **Type:** boolean  
   - **Default:** `false`  
   - **Example:** `includeUnauthorized=true`  
   - Description:  
     アプリロールで閲覧権限のないレコードを結果に含めます。ただし、含まれる場合のフィールド値は返されず、キー `_id` および `_unauthorized` のみとなります。
   - Restrictions:  
     - `referrer` パラメータとの同時指定は不可。

3. **optionsFormat**
   - **Type:** string  
   - **Default:** `"id"`  
   - **Enum:** `"id"`, `"label"`  
   - **Example:** `optionsFormat=label`  
   - Description:  
     セレクト、またはマルチセレクト型のレスポンス形式を指定します。

4. **enableTotalCount**
   - **Type:** boolean  
   - **Default:** `false`  
   - **Description:**
       - `true` に設定した場合: 検索結果の対象件数を取得します。ただし、登録されているレコード数が多いとレスポンス時間が長くなる恐れがあります。
       - `false` に設定した場合: `prevOffset`, `nextOffset`, `totalCount` は `null` となります。

5. **sort**
   - **Type:** string  
   - **Default:** `"_id:desc"`  
   - **Example:** `sort=_id:asc`  
   - Description:  
     ソート条件を指定します。対象は以下の通り:
       - `_id`
       - フィールド識別名
       - `_createdAt`
       - `_updatedAt`  
     ソート順は以下のフォーマットで指定します:
       - `":asc"`: 昇順
       - `":desc"`: 降順
### API リファレンス

#### 利用制限
- 指定できないフィールド型:
  - マルチセレクト
  - ファイル
  - パスワード
  - 参照フィールド型
  - `_createdBy`
  - `_updatedBy`
- 以下の場合、`_id`以外のフィールドでのソートは不可:
  - `referrer` または `includeUnauthorized` を指定した場合

---

### パラメータ

#### Query Parameters
- **`offset`** (integer)
  - 範囲: `[0 .. 10000]`
  - デフォルト値: `0`
  - 説明: リストのオフセット（開始位置）
  - 例: `offset=20`

- **`limit`** (integer)
  - 範囲: `[1 .. 200]`
  - デフォルト値: `20`
  - 説明: リストの上限数（1度に返す項目数）
  - 例: `limit=20`

---

#### Header Parameters
- **`X-Spiral-App-Role`** (string)
  - デフォルト値: `_fullAccess`
  - 説明: アプリロール
  - 例: `"employee"`

**注意**:
- ヘッダーが指定されない場合:
  - デフォルトで「全権限 (`_fullAccess`)」のアプリロールが指定された状態でAPIが実行される。
- 指定されたアプリロールにリクエストユーザ・APIエージェントが権限を持たない場合:
  - エラーが発生する。

---

### レスポンス

#### ステータスコード
- **200** 成功: レコード一覧が返される。

---

#### レスポンスヘッダー
- **`X-Spiral-App-Role`** (string)
  - 説明: アプリロール
  - 例: `"employee"`

---

#### レスポンスボディ
- **レスポンス形式**:
  - `application/json`

##### スキーマ
- **items** (array of objects)
  - 説明: レコードのリスト

- **options** (object)
  - 説明: 選択項目
  - **注意**:
    - `options`は**セレクト**または**マルチセレクト**フィールドの項目にのみ付与される。
    - それ以外のフィールドタイプには付与されない。

- **prevOffset** (integer)
  - 説明: 前のリストのオフセット
  - 特記事項:
    - 前のリストが存在しない場合は`null`。
    - オプション`enableTotalCount=true`を指定した場合にのみ返される。
```
### API Reference

#### Fields

- **nextOffset** *(integer)*  
  次のリストのオフセット。次のリストが存在しない場合は `null`。  
  `enableTotalCount=true` を指定した場合のみ返される。

- **totalCount** *(integer)*  
  検索結果の全件数。  
  `enableTotalCount=true` を指定した場合のみ返される。

#### Error Responses

- **403**  
  アプリの利用権限がない（または不足している）。

  **Response Headers**:  
  - **X-Spiral-App-Role** *(string)*  
    アプリロールの情報。  
    **Example:** `"employee"`

#### Response Samples

- **200**  
  - **Content type:** `application/json`  
  - **Example:**  
    ```json
    {
      "items": []
    }
    ```
```
```json
[
  {
    "_id": "10",
    "_unauthorized": false,
    "_revision": "10",
    "_createdBy": {
      "type": "user",
      "from": "ui",
      "userId": "100"
    },
    "_createdAt": "2020-04-30T17:06:29Z",
    "_updatedBy": {
      "type": "user",
      "from": "ui",
      "userId": "100"
    },
    "_updatedAt": "2020-04-30T17:06:29Z",
    "(textField)": "text",
    "(textareaField)": "textarea\ntextarea",
    "(emailField)": "spiral@example.com",
    "(phoneField)": "+81 80-1111-2222",
    "(integerField)": "100",
    "(doubleField)": "200.1",
    "(dateField)": "2020-04-30",
    "(monthDayField)": "04-30",
    "(timeField)": "17:06:29"
  }
]
```
```json
{
  "dateTimeField": "2020-04-30T17:06:29Z",
  "selectField": "0",
  "multiselectField": ["0", "1"],
  "fileField": [
    {
      "fileKey": "100_196a921286f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e",
      "url": "https://api.spiral-platform.com/v1/apps/100/dbs/200/300/400/files/100_196a921286f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e/download",
      "fileName": "sample.png",
      "fileSize": "5082",
      "createdAt": "2020-04-29T09:15:58Z"
    },
    {
      "fileKey": "200_3503ac054cd878b7b8f4fa66f8a9f4393664c599f496f65"
    }
  ]
}
```
```json
{
  "files": [
    {
      "id": "200_3503ac054cd878b7b8f4fa66f8a9f4393664c599f496f653e5834a97cfa6b3b2",
      "url": "https://api.spiral-platform.com/v1/apps/100/dbs/200/300/400/files/200_3503ac054cd878b7b8f4fa66f8a9f4393664c599f496f653e5834a97cfa6b3b2/download",
      "fileName": "sample.txt",
      "fileSize": "1024",
      "createdAt": "2020-04-29T09:20:58Z"
    }
  ],
  "(passwordField)": {
    "hasValue": "true"
  },
  "(referenceField)": {
    "url": "https://api.spiral-platform.com/v1/apps/100/dbs/123/records?referrer=123.4:56"
  },
  "(userField enableUser)": {
    "id": 9,
    "firstName": "太郎"
  }
}
```
```json
{
  "userDetails": {
    "lastName": "山田",
    "email": "spiral@example.com",
    "subEmail": "spiral-sub@example.com",
    "enabled": true,
    "userField": {
      "disableUser": {
        "id": 10,
        "enabled": false
      }
    }
  },
  "options": {
    "selectField": {
      "optionId": "ラベル1"
    },
    "multiselectField": {
      "optionId": "ラベル1"
    }
  },
  "pagination": {
    "prevOffset": 0,
    "nextOffset": 40,
    "totalCount": 200
  },
  "totalFileUsage": 1073741824,
  "apiInfo": {
    "name": "レコードを登録 - Spiral ver.2",
    "postEndpoint": "https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records",
    "postEndpointBeta": "https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records",
    "description": "SPIRAL ver.2 レコードを登録用のエンドポイント (ベータ環境含む)"
  },
  "pathParameters": {
    "app": {
      "required": true,
      "type": "string",
      "description": "アプリID"
    },
    "db": {
      "required": true,
      "type": "string",
      "description": "DBID"
    }
  },
  "headerParameters": {
    "X-Spiral-App-Role": {
      "type": "string",
      "defaultValue": "_fullAccess",
      "example": "employee",
      "description": "アプリロール ヘッダーの指定を省略した場合、「全権限」のアプリロールが指定される。リクエストユーザまたはAPIエージェントが権限を持たないアプリロールを指定された場合はエラーとなる。"
    }
  },
  "requestBody": {
    "schema": "application/json",
    "details": {
      "fieldName": {
        "type": "string or array",
        "description": "キーにフィールドの識別名を指定。バリューにはキーで指定したフィールドへ格納する値を指定する。"
      }
    }
  }
}
```
### APIリファレンス

---

#### フィールドタイプごとの値指定方法

- **マルチセレクト、ファイル、複数レコード参照の参照フィールド**  
  値は文字列リストとして指定します。

- **その他のフィールドタイプ**  
  値は文字列として指定します。

---

#### 特定のフィールドタイプにおける注意点

- **ファイル型フィールド**  
  - 有効期限が過ぎたファイルキーを指定するとエラーとなります。

- **ユーザフィールド**   
  - 無効ユーザのユーザIDやAPIエージェントのIDを指定するとエラーになります。

---

#### 値文字列の詳細

フィールドタイプによって指定する値文字列の形式が異なります。詳細についてはサポートサイトを参照してください。

---

### レスポンス

#### Status Code: `201 Created`

- **説明:** 登録したレコードが返されます。

##### Response Headers:
| ヘッダー名              | 型        | 説明               | 例           |
|-------------------------|-----------|--------------------|--------------|
| `X-Spiral-App-Role`     | string    | アプリロール情報   | `"employee"` |

##### Response Schema:
- **Content-Type:** `application/json`

| 名前        | 型              | 説明                                           |
|-------------|------------------|------------------------------------------------|
| `item`      | object           | レコード情報                                   |
| `options`   | object (任意)    | セレクト、マルチセレクトの選択項目。該当しない場合付与されません。 |

---

#### Status Code: `403 Forbidden`

- **説明:** アプリへの利用権限がない、または権限が不足している場合に返されます。

##### Response Headers:
| ヘッダー名              | 型        | 説明               | 例           |
|-------------------------|-----------|--------------------|--------------|
| `X-Spiral-App-Role`     | string    | アプリロール情報   | `"employee"` |
```
Request Samples:
Payload Content Type: application/json

Payload Example:
{
  "(textField)": "text",
  "(textareaField)": "textarea\ntextarea",
  "(emailField)": "spiral@example.com",
  "(phoneField)": "+81 80-1111-2222",
  "(integerField)": "100",
  "(doubleField)": "200.1",
  "(dateField)": "2020-04-30",
  "(monthDayField)": "04-30",
  "(timeField)": "17:06:29",
  "(dateTimeField)": "2020-04-30T17:06:29Z",
  "(selectField)": "0",
  "(multiselectField)": ["0", "1"],
  "(fileField)": [
    "100_196a921286f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e"
  ]
}
```
```
### API Reference

#### Request Format
```json
{
  "(passwordField)": "pK-4Pqec",
  "(single referenceField)": "14",
  "(multi referenceField)": ["1", "3", "5"],
  "(userField)": "1"
}
```

#### Response Samples
- **Status Code**: `201`
- **Content Type**: `application/json`

__Response Body:__
```json
{
  "item": {
    "_id": "10",
    "_unauthorized": false,
    "_revision": "10",
    "_createdBy": {
      "type": "user",
      "from": "ui",
      "userId": "100"
    },
    "_createdAt": "2020-04-30T17:06:29Z",
    "_updatedBy": {
      "type": "user",
      "from": "ui",
      "userId": "100"
    },
    "_updatedAt": "2020-04-30T17:06:29Z"
  }
}
```
```
```json
{
  "textField": "text",
  "textareaField": "textarea\ntextarea",
  "emailField": "spiral@example.com",
  "phoneField": "+81 80-1111-2222",
  "integerField": "100",
  "doubleField": "200.1",
  "dateField": "2020-04-30",
  "monthDayField": "04-30",
  "timeField": "17:06:29",
  "dateTimeField": "2020-04-30T17:06:29Z",
  "selectField": "0",
  "multiselectField": ["0", "1"],
  "fileField": [
    {
      "fileKey": "100_196a921286f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e",
      "url": "https://api.spiral-platform."
    }
  ]
}
```
```json
[
  {
    "fileKey": "100_196a921286f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e",
    "url": "https://api.spiral-platform.com/v1/apps/100/dbs/200/300/400/files/100_196a921286f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e/download",
    "fileName": "sample.png",
    "fileSize": "5082",
    "createdAt": "2020-04-29T09:15:58Z"
  },
  {
    "fileKey": "200_3503ac054cd878b7b8f4fa66f8a9f4393664c599f496f653e5834a97cfa6b3b2",
    "url": "https://api.spiral-platform.com/v1/apps/100/dbs/200/300/400/files/200_3503ac054cd878b7b8f4fa66f8a9f4393664c599f496f653e5834a97cfa6b3b2"
  }
]
```
```json
{
  "b2": {
    "download": {
      "fileName": "sample.txt",
      "fileSize": "1024",
      "createdAt": "2020-04-29T09:20:58Z"
    }
  },
  "(passwordField)": {
    "hasValue": "true"
  },
  "(single referenceField)": {
    "info": {
      "url": "https://api.spiral-platform.com/v1/apps/100/dbs/123/records?referrer=123.4:56"
    },
    "value": {
      "_id": "1",
      "_unauthorized": false,
      "_revision": "10",
      "_createdBy": {
        "type": "user",
        "userId": "100"
      },
      "_createdAt": "2020-04-30T17:06:29Z",
      "_createOperationSourceId": "10",
      "_updatedBy": {
        "type": "user",
        "userId": "100"
      },
      "_updatedAt": "2020-04-30T17:06:29Z",
      "_updateOperationSourceId": null
    }
  }
}
```
```json
{
  "multiReferenceField": {
    "info": {
      "url": "https://api.spiral-platform.com/v1/apps/100/dbs/123/records?referrer=123.4:56"
    },
    "value": [
      {
        "_id": "1",
        "_unauthorized": false,
        "_revision": "10",
        "_createdBy": {
          "type": "user",
          "userId": "100"
        },
        "_createdAt": "2020-04-30T17:06:29Z",
        "_createOperationSourceId": "10",
        "_updatedBy": {
          "type": "user",
          "userId": "100"
        },
        "_updatedAt": "2020-04-30T17:06:29Z",
        "_updateOperationSourceId": "10",
        "shopName": "赤坂店"
      },
      {
        "_id": "3",
        "_unauthorized": false,
        "_revision": ...
      }
    ]
  }
}
```
```json
{
  "id": 10,
  "_createdBy": {
    "type": "user",
    "userId": "100"
  },
  "_createdAt": "2020-04-30T17:06:29Z",
  "_createOperationSourceId": "10",
  "_updatedBy": {
    "type": "user",
    "userId": "100"
  },
  "_updatedAt": "2020-04-30T17:06:29Z",
  "_updateOperationSourceId": "10",
  "shopName": "青山店"
},
"userField": {
  "enableUser": {
    "id": 9,
    "firstName": "太郎",
    "lastName": "山田",
    "email": "spiral@example.com",
    "subEmail": "spiral-sub@example.com",
    "enabled": true
  },
  "disableUser": {
    "id": 10,
    "enabled": false
  }
},
"options": {
  "selectField": {
    "optionId": "ラベル1"
  },
  "multiselectField": null
}
```
### APIリファレンス: レコードを取得

#### 概要
`get/apps/{app}/dbs/{db}/records/{recordId}`  
このエンドポイントを利用して、指定されたDBの指定レコードIDに対応するレコードを取得します。

- **ベータ環境 URL**: `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/{recordId}`
- **SPIRAL ver.2 APIサーバ URL**: `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/{recordId}`

---

#### **Path Parameters**

| 名前        | 必須  | 種類   | 説明       |
|-------------|-------|--------|------------|
| `app`       | 必須   | string | アプリID   |
| `db`        | 必須   | string | DB ID      |
| `recordId`  | 必須   | string | レコードID |

---

#### **Query Parameters**

| 名前             | 種類     | デフォルト値 | 値の種類 | 説明                                         |
|------------------|----------|--------------|----------|----------------------------------------------|
| `optionsFormat`  | string   | `"id"`       | Enum: `"id"`, `"label"` | セレクト、マルチセレクト型のレスポンス形式 |

- **例**: `optionsFormat=label`

---

#### **Header Parameters**

| 名前                  | 種類   | デフォルト値     | 例         | 説明                                                                       |
|-----------------------|--------|------------------|------------|----------------------------------------------------------------------------|
| `X-Spiral-App-Role`   | string | `_fullAccess`    | `employee` | アプリロール。ヘッダーの指定を省略した場合、「全権限」のアプリロールが使用されます。 |

- リクエストしたユーザ・APIエージェントが権限を持たないアプリロールを指定するとエラーになります。

---

#### **Responses**

##### **200: 指定のレコード**

**Response Headers**:
| 名前                  | 種類   | 例         | 説明             |
|-----------------------|--------|------------|------------------|
| `X-Spiral-App-Role`   | string | `employee` | アプリロール     |

**Response Schema**: `application/json`

| フィールド名 | 種類     | 説明                                 |
|--------------|----------|--------------------------------------|
| `item`       | object   | レコード情報                        |
| `options`    | object   | セレクト、マルチセレクトの選択項目   |
```
APIリファレンス概要
===================
以下に、提供されたAPIリファレンス情報を構造化した形式でまとめます。

適用対象
--------
- **セレクト、マルチセレクト以外のフィールドタイプ**には付与されない。

HTTPステータスコード
---------------------
- **403 Forbidden**
  - 説明: アプリの利用権限がない、または権限が不足している。

レスポンスヘッダー
-------------------
- **Header Name: `X-Spiral-App-Role`**
  - 型: `string`
  - 例: `"employee"`（アプリロール）

レスポンスサンプル
-------------------
- **ステータスコード: 200**
  - **Content-Type:** `application/json`

レスポンスボディ例:
```json
{
  "item": {
    "_id": "10",
    "_unauthorized": false,
    "_revision": "10",
    "_createdBy": {
      "type": "user",
      "from": "ui",
      "userId": "100"
    },
    "_createdAt": "2020-04-30T17:06:29Z",
    "_updatedBy": {
      "type": "user",
      "from": "ui",
      "userId": "100"
    },
    "_updatedAt": ""
  }
}
```
```
```json
{
  "timestamp": "2020-04-30T17:06:29Z",
  "textField": "text",
  "textareaField": "textarea\ntextarea",
  "emailField": "spiral@example.com",
  "phoneField": "+81 80-1111-2222",
  "integerField": 100,
  "doubleField": 200.1,
  "dateField": "2020-04-30",
  "monthDayField": "04-30",
  "timeField": "17:06:29",
  "dateTimeField": "2020-04-30T17:06:29Z",
  "selectField": "0",
  "multiselectField": ["0", "1"],
  "fileField": [
    {
      "fileKey": "100_196a921286f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e"
    }
  ]
}
```
```json
[
  {
    "url": "https://api.spiral-platform.com/v1/apps/100/dbs/200/300/400/files/100_196a921286f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e/download",
    "fileName": "sample.png",
    "fileSize": "5082",
    "createdAt": "2020-04-29T09:15:58Z"
  },
  {
    "fileKey": "200_3503ac054cd878b7b8f4fa66f8a9f4393664c599f496f653e5834a97cfa6b3b2",
    "url": "https://api.spiral-platform.com/v1/apps/100/dbs/200/300/400/files/200_3503ac054cd878b7b8f4fa66f8a9f4393664c599f496f653e5834a97cfa6b3"
  }
]
```
```json
{
  "b2/download": [
    {
      "fileName": "sample.txt",
      "fileSize": "1024",
      "createdAt": "2020-04-29T09:20:58Z"
    }
  ],
  "(passwordField)": {
    "hasValue": "true"
  },
  "(single referenceField)": {
    "info": {
      "url": "https://api.spiral-platform.com/v1/apps/100/dbs/123/records?referrer=123.4:56"
    },
    "value": {
      "_id": "1",
      "_unauthorized": false,
      "_revision": "10",
      "_createdBy": {
        "type": "user",
        "userId": "100"
      },
      "_createdAt": "2020-04-30T17:06:29Z",
      "_createOperationSourceId": "10",
      "_updatedBy": {
        "type": "user",
        "userId": "100"
      },
      "_updatedAt": "2020-04-30T17:06:29Z",
      "_updateOperationSourceId": null
    }
  }
}
```
```
{
  "email": "yamada@example.com",
  "multi_referenceField": {
    "info": {
      "url": "https://api.spiral-platform.com/v1/apps/100/dbs/123/records?referrer=123.4:56"
    },
    "value": [
      {
        "_id": "1",
        "_unauthorized": false,
        "_revision": "10",
        "_createdBy": {
          "type": "user",
          "userId": "100"
        },
        "_createdAt": "2020-04-30T17:06:29Z",
        "_createOperationSourceId": "10",
        "_updatedBy": {
          "type": "user",
          "userId": "100"
        },
        "_updatedAt": "2020-04-30T17:06:29Z",
        "_updateOperationSourceId": "10",
        "shopName": "赤坂店"
      },
      {
        "_id": "3",
        "_unauthorized": false,
        "_revision": null
      }
    ]
  }
}
```
```
{
  "10": {
    "_createdBy": {
      "type": "user",
      "userId": "100"
    },
    "_createdAt": "2020-04-30T17:06:29Z",
    "_createOperationSourceId": "10",
    "_updatedBy": {
      "type": "user",
      "userId": "100"
    },
    "_updatedAt": "2020-04-30T17:06:29Z",
    "_updateOperationSourceId": "10",
    "shopName": "青山店"
  },
  "(userField enableUser)": {
    "id": 9,
    "firstName": "太郎",
    "lastName": "山田",
    "email": "spiral@example.com",
    "subEmail": "spiral-sub@example.com",
    "enabled": true
  },
  "(userField disableUser)": {
    "id": 10,
    "enabled": false
  },
  "options": {
    "(selectField)": {
      "(optionId)": "ラベル1"
    },
    "(multiselectField)": {}
  }
}
```
### APIリファレンス

#### レコードを変更
PATCH: `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/{recordId}`  
ベータ環境: `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/{recordId}`  

指定DBの指定レコードIDのレコードを変更します。

---

#### Path Parameters
| 名前       | 必須       | 型        | 説明          |
|------------|------------|-----------|---------------|
| `app`      | required   | string    | アプリID       |
| `db`       | required   | string    | DBID          |
| `recordId` | required   | string    | レコードID     |

---

#### Header Parameters
| 名前                | 型      | デフォルト値     | 例         | 説明                                    |
|---------------------|---------|------------------|------------|-----------------------------------------|
| `X-Spiral-App-Role` | string  | `_fullAccess`    | `employee` | アプリロール                            |

- **補足**  
ヘッダーの指定を省略した場合、「全権限」のアプリロールが指定されたものとしてAPIが実行されます。  
リクエストしたユーザまたはAPIエージェントが権限を持たないアプリロールを指定した場合はエラーが発生します。

---

#### Request Body
- **Content-Type**: `application/json`

| フィールド名         | 型      | 説明                                                                 |
|----------------------|---------|----------------------------------------------------------------------|
| `_revision`          | string  | リビジョン番号                                                       |
|                      |         | 更新時に指定されたリビジョンが最新でない場合、エラーとなります。       |
|                      |         | 指定しない場合はリビジョンチェックを行いません。                     |
| `(fieldName)`        | string  | レコードのフィールド識別名をキーとして指定してください。              |


```
API仕様（構造化）

### 機能説明
- バリューにはキーで指定したフィールドへ格納する値を指定します。
- ファイル型フィールドは有効期限を過ぎたファイルキーを指定するとエラーが発生します。
- ユーザフィールドは以下の場合にエラーとなります：
  - 無効なユーザのユーザIDを指定した場合。
  - APIエージェントのIDを指定した場合。

---

### レスポンス

#### 200: 更新したレコード
**Response Headers**  
- `X-Spiral-App-Role`  
  - **Type**: string  
  - **Example**: `"employee"`
  - **Description**: アプリロール

**Response Schema**  
- **Content Type**: `application/json`
  - `item` (object): レコード情報。
  - `options` (object): セレクト、マルチセレクトの選択項目（※セレクト・マルチセレクト以外のフィールドタイプには付与されません）。

---

#### 403: アプリの利用権限が不足している場合
**Response Headers**  
- `X-Spiral-App-Role`  
  - **Type**: string  
  - **Example**: `"employee"`
  - **Description**: アプリロール
```
```
API Request Sample:

Payload Content-Type:
- application/json

Request Payload:
```json
{
  "_revision": "10",
  "(textField)": "text",
  "(textareaField)": "textarea\ntextarea",
  "(emailField)": "spiral@example.com",
  "(phoneField)": "+81 80-1111-2222",
  "(integerField)": "100",
  "(doubleField)": "200.1",
  "(dateField)": "2020-04-30",
  "(monthDayField)": "04-30",
  "(timeField)": "17:06:29",
  "(dateTimeField)": "2020-04-30T17:06:29Z",
  "(selectField)": "0",
  "(multiselectField)": ["0", "1"],
  "(fileField)": [
    "100_196a921286f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e"
  ]
}
```
```
```
### API Reference

---

#### Request Fields:
- `passwordField`:
  - Type: String  
  - Example: `"pK-4Pqec"`
- `single referenceField`:
  - Type: String  
  - Example: `"14"`
- `multi referenceField`:
  - Type: Array of Strings  
  - Example: `["1", "3", "5"]`
- `userField`:
  - Type: String  
  - Example: `"1"`

---

#### Response:
- **HTTP Status Code**: 200  
- **Content Type**: `application/json`

##### Response Structure:
```json
{
  "item": {
    "_id": "10",
    "_unauthorized": false,
    "_revision": "10",
    "_createdBy": {
      "type": "user",
      "from": "ui",
      "userId": "100"
    },
    "_createdAt": "2020-04-30T17:06:29Z",
    "_updatedBy": {
      "type": "user",
      "from": "ui",
      "userId": "100"
    },
    "_updatedAt": "2020-04-30T17:06:29Z"
  }
}
```

---

#### Sample Request:
```json
{
  "passwordField": "pK-4Pqec",
  "single referenceField": "14",
  "multi referenceField": ["1", "3", "5"],
  "userField": "1"
}
```

---

#### Sample Response:
```json
{
  "item": {
    "_id": "10",
    "_unauthorized": false,
    "_revision": "10",
    "_createdBy": {
      "type": "user",
      "from": "ui",
      "userId": "100"
    },
    "_createdAt": "2020-04-30T17:06:29Z",
    "_updatedBy": {
      "type": "user",
      "from": "ui",
      "userId": "100"
    },
    "_updatedAt": "2020-04-30T17:06:29Z"
  }
}
```
```
```
{
  "textField": "text",
  "textareaField": "textarea\ntextarea",
  "emailField": "spiral@example.com",
  "phoneField": "+81 80-1111-2222",
  "integerField": "100",
  "doubleField": "200.1",
  "dateField": "2020-04-30",
  "monthDayField": "04-30",
  "timeField": "17:06:29",
  "dateTimeField": "2020-04-30T17:06:29Z",
  "selectField": "0",
  "multiselectField": ["0", "1"],
  "fileField": [
    {
      "fileKey": "100_196a921286f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e",
      "url": "https://api.spiral-platform."
    }
  ]
}
```
```json
[
  {
    "fileKey": "100_196a921286f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e",
    "url": "https://api.spiral-platform.com/v1/apps/100/dbs/200/300/400/files/100_196a921286f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e/download",
    "fileName": "sample.png",
    "fileSize": 5082,
    "createdAt": "2020-04-29T09:15:58Z"
  },
  {
    "fileKey": "200_3503ac054cd878b7b8f4fa66f8a9f4393664c599f496f653e5834a97cfa6b3b2",
    "url": "https://api.spiral-platform.com/v1/apps/100/dbs/200/300/400/files/200_3503ac054cd878b7b8f4fa66f8a9f4393664c599f496f653e5834a97cfa6b3b2"
  }
]
```
```json
{
  "download": {
    "fileName": "sample.txt",
    "fileSize": "1024",
    "createdAt": "2020-04-29T09:20:58Z"
  },
  "passwordField": "pK-4Pqec",
  "singleReferenceField": {
    "info": {
      "url": "https://api.spiral-platform.com/v1/apps/100/dbs/123/records?referrer=123.4:56"
    },
    "value": {
      "_id": "1",
      "_unauthorized": false,
      "_revision": "10",
      "_createdBy": {
        "type": "user",
        "userId": "100"
      },
      "_createdAt": "2020-04-30T17:06:29Z",
      "_createOperationSourceId": "10",
      "_updatedBy": {
        "type": "user",
        "userId": "100"
      },
      "_updatedAt": "2020-04-30T17:06:29Z",
      "_updateOperationSourceId": null
    }
  }
}
```
```
{
  "email": "yamada@example.com"
},
"multi referenceField": {
    "info": {
        "url": "https://api.spiral-platform.com/v1/apps/100/dbs/123/records?referrer=123.4:56"
    },
    "value": [
        {
            "_id": "1",
            "_unauthorized": false,
            "_revision": "10",
            "_createdBy": {
                "type": "user",
                "userId": "100"
            },
            "_createdAt": "2020-04-30T17:06:29Z",
            "_createOperationSourceId": "10",
            "_updatedBy": {
                "type": "user",
                "userId": "100"
            },
            "_updatedAt": "2020-04-30T17:06:29Z",
            "_updateOperationSourceId": "10",
            "shopName": "赤坂店"
        },
        {
            "_id": "3",
            "_unauthorized": false,
            "_revision": ...
        }
    ]
}
```
```json
{
  "_createdBy": {
    "type": "user",
    "userId": "100"
  },
  "_createdAt": "2020-04-30T17:06:29Z",
  "_createOperationSourceId": "10",
  "_updatedBy": {
    "type": "user",
    "userId": "100"
  },
  "_updatedAt": "2020-04-30T17:06:29Z",
  "_updateOperationSourceId": "10",
  "shopName": "青山店",
  "userField": {
    "enableUser": {
      "id": 9,
      "firstName": "太郎",
      "lastName": "山田",
      "email": "spiral@example.com",
      "subEmail": "spiral-sub@example.com",
      "enabled": true
    },
    "disableUser": {
      "id": 10,
      "enabled": false
    }
  },
  "options": {
    "selectField": {
      "optionId": "ラベル1"
    },
    "multiselectField": {}
  }
}
```
### APIリファレンス: レコードを削除

#### エンドポイント
- **本番環境**: `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/{recordId}`  
- **ベータ環境**: `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/{recordId}`

#### 機能
指定したDBのレコードIDに紐づくレコードを削除します。

---

### パラメーター

#### **Path Parameters**
| 名前       | 必須   | 種類   | 説明         |
|------------|--------|--------|--------------|
| `app`      | はい   | string | アプリID      |
| `db`       | はい   | string | DB ID        |
| `recordId` | はい   | string | レコードID    |

#### **Header Parameters**
| 名前                 | 種類   | デフォルト値           | 例       | 説明                                   |
|----------------------|--------|------------------------|----------|----------------------------------------|
| `X-Spiral-App-Role`  | string | `_fullAccess`          | `employee` | アプリロール                         |

- ヘッダーで `X-Spiral-App-Role` を指定しない場合、デフォルトで「全権限」(`_fullAccess`) のアプリロールが適用されます。  
- リクエストを送信したユーザーまたはAPIエージェントが指定したアプリロールに対して権限を持たない場合、エラーとなります。

---

### レスポンス

#### **HTTPステータスコード**
- **204 No Content**:  
  レスポンスボディなし。
  - **Response Headers**:  
    | 名前                 | 種類   | 例         | 説明        |
    |----------------------|--------|------------|-------------|
    | `X-Spiral-App-Role`  | string | `"employee"` | アプリロール |

- **403 Forbidden**:  
  アプリの利用権限がない、または不足している場合。
  - **Response Headers**:  
    | 名前                 | 種類   | 例         | 説明        |
    |----------------------|--------|------------|-------------|
    | `X-Spiral-App-Role`  | string | `"employee"` | アプリロール |
### API情報: 参照先フィールドを含めたレコード一覧を取得

#### エンドポイント
- 本番環境: `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/join`
- ベータ環境: `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/join`

#### 概要
指定した条件に一致するレコードの一覧を取得します。  
フィールドを指定することで、以下が可能です:
- 参照先DBのフィールドを取得
- 参照先DBのさらに参照先フィールドを取得

詳細についてはサポートサイトをご確認ください。

---

### パスパラメータ (Path Parameters)
| パラメータ名 | 必須 | 種類   | 説明     |
|--------------|------|--------|----------|
| `app`        | 必須 | string | アプリID |
| `db`         | 必須 | string | DBID     |

---

### クエリパラメータ (Query Parameters)
| パラメータ名  | データ型         | 制約                              | デフォルト値            | 説明                                                                                                     |
|---------------|------------------|-----------------------------------|-------------------------|---------------------------------------------------------------------------------------------------------|
| `fields`      | Array of strings | 最大150項目                       | 自DBの全フィールド       | 出力するフィールド識別名を配列で指定します。                                                            |
|               |                  |                                   |                         | - 参照フィールドを指定する場合、フォーマットは `[参照フィールド識別名].[参照先DBのフィールド識別名]` です。 |
|               |                  |                                   |                         | - 例: `fields=name,age`  |


### API使用時の参照フィールド指定ルール

#### 1. フィールド指定フォーマット
参照先データベース（DB）の参照先のフィールドを指定する場合は、以下の形式で記述します：
```
[参照フィールド識別名].[参照先DBの参照フィールド識別名].[参照先DBの参照先のフィールド識別名]
```

#### 2. 自DBのメタ情報フィールド
- **指定不可**  
  自DBのメタ情報フィールドは指定できません。  
- **レスポンスへの含有**  
  必ずレスポンスに含まれます。

#### 3. 複数参照の場合の制限
参照先DBの参照先のフィールドについて、以下の条件下では指定ができません：
- `[参照フィールド識別名]`または`[参照先DBの参照フィールド識別名]`が**複数参照**の場合

#### 4. 単一参照の場合の制限
参照先DBの参照先のフィールドが**単一参照**である場合、指定できないフィールドは以下の通りです：
- メタ情報フィールド（`_id`を除く）
- ファイルフィールド
- パスワードフィールド
- 複数参照の参照フィールド  

さらに、参照先DBの参照先に関しては、以下の制限があります：
- 単一参照の参照フィールドも指定**不可**  
### APIリファレンス

---

#### 制約事項
- **参照フィールドの制限**:  
  - 合わせて6フィールド以上は指定不可。
  - `_id`以外のメタ情報フィールド、テキストエリア、マルチセレクト、ファイル、パスワード、参照フィールド、ユーザフィールドは指定不可。
  - 参照先データベース（DB）のフィールドや参照先DBのさらに参照先フィールドも指定不可。

---

#### パラメータ

1. **where** (string):
   - **用途**: 抽出条件式。
   - **詳細**: 条件式でフィルタリングを行います。
   - **エンコード仕様**: 
     - `+` は `%2b` にエンコード。
     - `%` は `%%` にエンコード。
   - **例**:
     - `where=@age >= 30 AND @name = 'yamada'`
     - `where=1%2b1=2`
     - `where=1%%1=1`

2. **optionsFormat** (string):
   - **デフォルト値**: `"id"`
   - **選択可能値**: `"id"` または `"label"`
   - **用途**: セレクト、マルチセレクト型のレスポンス形式を指定します。
   - **例**: `optionsFormat=label`

3. **enableTotalCount** (boolean):
   - **デフォルト値**: `false`
   - **用途**: 検索結果の対象件数を取得するかを指定。
   - **注意点**:  
     - `true` に設定すると、登録されているレコード数が多い場合、レスポンスまでの時間が長くなる。

4. **sort** (string):
   - **デフォルト値**: `"_id:desc"`
   - **用途**: ソート対象と順序を指定します。
   - **指定可能なソート対象**: `_id`, フィールド識別名, `_createdAt`, `_updatedAt`
   - **順序指定**:
     - `":asc"`: 昇順
     - `":desc"`: 降順
   - **例**: `sort=_id:asc`

---
### API リファレンス

#### 利用不可のフィールド
以下のフィールドは指定できません：
- マルチセレクト
- ファイル
- パスワード
- 参照フィールド
- `_createdBy`
- `_updatedBy`
- 参照先DBのフィールド
- 参照先DBの参照先のフィールド

---

### クエリパラメータ

#### `offset`
- **型**: `integer`
- **範囲**: `[0 .. 10000]`
- **デフォルト値**: `0`
- **例**: `offset=20`
- **説明**: リストのオフセット

#### `limit`
- **型**: `integer`
- **範囲**: `[1 .. 200]`
- **デフォルト値**: `20`
- **例**: `limit=20`
- **説明**: リストの上限

---

### ヘッダーパラメータ

#### `X-Spiral-App-Role`
- **型**: `string`
- **デフォルト値**: `_fullAccess`
- **例**: `"employee"`
- **説明**: アプリロール  
  - ヘッダーが省略された場合は、デフォルトで「全権限」のアプリロールが指定されます。
  - リクエストしたユーザやAPIエージェントが権限のないアプリロールを指定するとエラーになります。

---

### レスポンス

#### 成功レスポンス
- **ステータスコード**: `200`
- **内容**: レコード一覧

##### レスポンスヘッダー
- **`X-Spiral-App-Role`**
  - **型**: `string`
  - **例**: `"employee"`
  - **説明**: アプリロール

##### レスポンススキーマ
- **Content-Type**: `application/json`
- **内容**:
  - **`items`**: `Array of objects`  
    レコードのリスト
  - **`options`**: `object`  
    - セレクトやマルチセレクトの選択項目
    - セレクト、マルチセレクト以外のフィールドタイプには付与されない
  - **`prevOffset`**: `integer | null`  
    前のリストのオフセット。前のリストが存在しない場合は`null`
  - **`nextOffset`**: `integer | null`  
    次のリストのオフセット。次のリストが存在しない場合は`null`
```
### API リファレンス

#### totalCount (integer)
- **説明**: 検索結果の全件数

---

### ステータスコード

- **403**:  
  アプリの利用権限がない（または不足している）

---

### レスポンス

#### Response Headers
- **X-Spiral-App-Role (string)**  
  - **説明**: アプリロール  
  - **例**: `"employee"`

#### Response サンプル (200 OK)
- **Content Type**: `application/json`
- **サンプルレスポンス**:
  ```json
  {
    "items": [
      {
        "_id": "10",
        "_revision": "10",
        "_createdBy": {
          "type": "user",
          "from": "ui",
          "userId": "100"
        },
        "_createdAt": "2020-04-30T17:06:29Z",
        "_updatedBy": {
          "type": "user",
          "from": "ui",
          "userId": "100"
        },
        "_updatedAt": "2020-04-30T17:06:29Z",
        "(textField)": null
      }
    ]
  }
  ```
```
```
{
  "text": "(textareaField): \"textarea\\ntextarea\"",
  "emailField": "spiral@example.com",
  "phoneField": "+81 80-1111-2222",
  "integerField": "100",
  "doubleField": "200.1",
  "dateField": "2020-04-30",
  "monthDayField": "04-30",
  "timeField": "17:06:29",
  "dateTimeField": "2020-04-30T17:06:29Z",
  "selectField": "0",
  "multiselectField": [
    "0",
    "1"
  ],
  "fileField": [
    {
      "fileKey": "100_196a921286f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e",
      "url": "https://api.spiral-platform.com/v1/apps/100/dbs/200/300/400/files/100_196a921286"
    }
  ]
}
```
```json
[
  {
    "fileKey": "f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e",
    "url": "https://api.spiral-platform.com/v1/apps/100/dbs/200/300/400/files/f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e/download",
    "fileName": "sample.png",
    "fileSize": "5082",
    "createdAt": "2020-04-29T09:15:58Z"
  },
  {
    "fileKey": "200_3503ac054cd878b7b8f4fa66f8a9f4393664c599f496f653e5834a97cfa6b3b2",
    "url": "https://api.spiral-platform.com/v1/apps/100/dbs/200/300/400/files/200_3503ac054cd878b7b8f4fa66f8a9f4393664c599f496f653e5834a97cfa6b3b2/download",
    "fileName": "sample.txt"
  }
]
```
```
{
  "entries": [
    {
      "id": "1024",
      "createdAt": "2020-04-29T09:20:58Z"
    }
  ],
  "(passwordField)": {
    "hasValue": "true"
  },
  "(userField enableUser)": {
    "id": 9,
    "firstName": "太郎",
    "lastName": "山田",
    "email": "spiral@example.com",
    "subEmail": "spiral-sub@example.com",
    "enabled": true
  },
  "(userField disableUser)": {
    "id": 10,
    "enabled": false
  },
  "(single referenceField)": "1",
  "(single referenceField)._id": "1",
  "(single referenceField).(textField)": "text",
  "(single referenceField).(textareaField)": "textarea\ntextarea",
  "(single referenceField).(emailField)": "spiral@example.com",
  "(single referenceField).(phoneField)": "+81 80-1111-2222",
  "(single referenceField).(integerField)": null
}
```
```
{
  "100": {
    "(single referenceField)": {
      "(doubleField)": 200.1,
      "(dateField)": "2020-04-30",
      "(monthDayField)": "04-30",
      "(timeField)": "17:06:29",
      "(dateTimeField)": "2020-04-30T17:06:29Z",
      "(selectField)": "0",
      "(multiselectField)": ["0", "1"],
      "(userField enableUser)": {
        "id": 9,
        "firstName": "太郎",
        "lastName": "山田",
        "email": "spiral@example.com",
        "subEmail": "spiral-sub@example.com",
        "enabled": true
      },
      "(userField disableUser)": {
        "id": null
      }
    }
  }
}
```
```json
{
  "enabled": false,
  "(single referenceField)": {
    "(single referenceField)": {
      "_id": "1",
      "(textField)": "text",
      "(textareaField)": "textarea\ntextarea",
      "(emailField)": "spiral@example.com",
      "(phoneField)": "+81 80-1111-2222",
      "(integerField)": 100,
      "(doubleField)": 200.1,
      "(dateField)": "2020-04-30",
      "(monthDayField)": null
    }
  }
}
```
```json
{
  "04-30": {
    "(single referenceField).(single referenceField).(timeField)": "17:06:29",
    "(single referenceField).(single referenceField).(dateTimeField)": "2020-04-30T17:06:29Z",
    "(single referenceField).(single referenceField).(selectField)": "0",
    "(single referenceField).(single referenceField).(multiselectField)": ["0", "1"],
    "(single referenceField).(single referenceField).(userField enableUser)": {
      "id": 9,
      "firstName": "太郎",
      "lastName": "山田",
      "email": "spiral@example.com",
      "subEmail": "spiral-sub@example.com",
      "enabled": true
    },
    "(single referenceField).(single referenceField).(userField disableUser)": {
      "id": 10,
      "enabled": false
    },
    "(multi referenceField)": ["1", "3"]
  }
}
```
```json
{
  "(multi referenceField)": {
    "_id": ["1", "3"],
    "(textField)": ["text", "text"],
    "(emailField)": ["spiral@example.com", "spiral@example.com"],
    "(phoneField)": ["+81 80-1111-2222", "+81 80-1111-2222"],
    "(integerField)": ["100", "100"],
    "(doubleField)": ["200.1", "200.1"],
    "(dateField)": ["2020-04-30", "2020-04-30"],
    "(monthDayField)": ["04-30", "04-30"],
    "(timeField)": ["17:06:29", "17:06:29"],
    "(dateTimeField)": ["2020-04-30T17:06:29Z"]
  }
}
```
```
{
  "2020-04-30T17:06:29Z": [],
  "(multi referenceField).(selectField)": ["0", "0"]
},
"options": {
  "(selectField)": {
    "(optionId)": "ラベル1"
  },
  "(multiselectField)": {
    "(optionId)": "ラベル1"
  },
  "(single referenceField).(selectField)": {
    "(optionId)": "ラベル1"
  },
  "(single referenceField).(multiselectField)": {
    "(optionId)": "ラベル1"
  },
  "(single referenceField).(single referenceField).(selectField)": {
    "(optionId)": "ラベル1"
  },
  "(single referenceField).(single referenceField).(multiselectField)": {
    "(optionId)": "ラベル1"
  },
  "(multi referenceField).(selectField)": {
    "(optionId)": "ラベル1"
  }
},
"prevOffset": 0,
"nextOffset": ""
```
### APIリファレンス: 参照先フィールドを含めたレコードを取得

#### エンドポイント

**API URL (本番環境)**  
`https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/{recordId}/join`

**API URL (ベータ環境)**  
`https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/{recordId}/join`

---

### 機能概要
指定されたDBの指定されたレコードIDに対応するレコードを取得します。  
フィールドを指定してリクエストした場合、参照先DBのフィールドや、さらにその参照先DBのフィールドを取得することも可能です。

- 詳細については公式サポートサイトをご確認ください。

---

### HTTP メソッド
`GET`

---

### パスパラメータ (Path Parameters)

| パラメータ | 必須 | 型       | 説明          |
|------------|------|----------|---------------|
| `app`      | 必須 | `string` | アプリID      |
| `db`       | 必須 | `string` | DBのID        |
| `recordId` | 必須 | `string` | レコードのID  |

---

### クエリパラメータ (Query Parameters)

| パラメータ   | 型                | デフォルト値      | 最大サイズ | 説明 |
|--------------|-------------------|-------------------|------------|------|
| `fields`     | 配列 (数値なしの文字列) | `"自DBの全フィールド"` | 最大150個   | 出力するフィールドの識別名を配列で指定します。参照先DBのフィールドを指定する場合は、以下のフォーマットを使用してください：<br>**`[参照フィールド識別名].[参照先DBのフィールド識別名]`** |

- **例**: `fields=name,age`  
  ※ この例では `name` と `age` フィールドを出力。

---

### 注意事項
- 最大リストサイズは **150** フィールドまでです。
- フィールドの指定がない場合は、デフォルトで自DBの全フィールドが出力されます。

--- 
- **参照フィールドの指定方法**  
  参照先DBのフィールドを指定する場合、以下のフォーマットを使用します:  
  `[参照フィールド識別名].[参照先DBの参照フィールド識別名].[参照先DBの参照先のフィールド識別名]`

- **指定不可のケース**
  - **自DBのメタ情報フィールド**:  
    自DBのメタ情報フィールドは指定できません。ただし、レスポンスには必ず含まれます。
  - **複数参照の場合**:  
    参照先DBの参照先フィールドについて、以下のいずれかが複数参照の場合、フィールドの指定はできません。  
    - `[参照フィールド識別名]`  
    - `[参照先DBの参照フィールド識別名]`
  - **単一参照の場合**:  
    単一参照の場合は、以下のフィールドは指定できません:  
    - _id以外のメタ情報フィールド  
    - ファイル  
    - パスワード  
    - 複数参照の参照フィールド  
    - **[参照先DBの参照先の場合]**:  
      単一参照の参照フィールドも指定不可
### APIリファレンス構造化

---

#### 制限事項
1. **フィールドの指定**:
   - 複数参照の場合、**6フィールド以上は指定不可**。
   - `_id`以外の以下のフィールドは指定不可:
     - メタ情報フィールド
     - テキストエリア
     - マルチセレクト
     - ファイル
     - パスワード
     - 参照フィールド
     - ユーザフィールド
   - **参照フィールド**: 合わせて**6フィールド以上は指定不可**。

---

#### `optionsFormat`
- **型**: `string`
- **デフォルト値**: `"id"`
- **列挙型**: `"id"` / `"label"`
- **説明**: セレクト、マルチセレクト型のレスポンス形式。
- **例**: `optionsFormat=label`

---

#### Header Parameters
- **`X-Spiral-App-Role`**
  - **型**: `string`
  - **デフォルト値**: `_fullAccess`
  - **説明**: アプリロールの指定。
  - **例**: `"employee"`

**備考**:
- ヘッダーで指定が省略された場合、デフォルトで「全権限」 (`_fullAccess`) のアプリロールが設定されてAPIが実行される。
- リクエストしたユーザまたはAPIエージェントが権限を持たないアプリロールを指定した場合、エラーとなる。

---

#### Responses

##### **200 OK**
- **説明**: 指定されたレコードのレスポンス。
- **Response Headers**:
  - **`X-Spiral-App-Role`**
    - **型**: `string`
    - **例**: `"employee"`
    - **説明**: アプリロール。
- **Response Schema**:
  - **Content Type**: `application/json`
  - **構成**:
    - **`item` (object)**: レコードのデータ。
    - **`options` (object)**: セレクトおよびマルチセレクトの選択項目。
      - **備考**: セレクト、マルチセレクト以外のフィールドタイプには付与されない。

---
```
# API Documentation: Error 403 - Insufficient Application Permissions

## Error Code
**403**  
Description: The application lacks sufficient permissions or user does not have access rights.

---

## Response Headers

- **X-Spiral-App-Role**  
  - **Type**: string  
  - **Example**: "employee" (Specifies the application role)

---

## Response Samples  

### Status Code: 200  
**Content Type**: `application/json`  

**Response Body Example**:
```json
{
  "item": {
    "_id": "10",
    "_revision": "10",
    "_createdBy": {
      "type": "user",
      "from": "ui",
      "userId": "100"
    },
    "_createdAt": "2020-04-30T17:06:29Z",
    "_updatedBy": {
      "type": "user",
      "from": "ui",
      "userId": "100"
    },
    "_updatedAt": "2020-04-30T17:06:29Z",
    "(textField)": "text",
    "(textareaField)": "textarea\ntextarea",
    "(emailField)": ""
  }
}
```
```
```json
{
  "email": "spiral@example.com",
  "phoneField": "+81 80-1111-2222",
  "integerField": 100,
  "doubleField": 200.1,
  "dateField": "2020-04-30",
  "monthDayField": "04-30",
  "timeField": "17:06:29",
  "dateTimeField": "2020-04-30T17:06:29Z",
  "selectField": "0",
  "multiselectField": ["0", "1"],
  "fileField": [
    {
      "fileKey": "100_196a921286f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e",
      "url": "https://api.spiral-platform.com/v1/apps/100/dbs/200/300/400/files/100_196a921286"
    }
  ]
}
```
```
[
  {
    "fileKey": "f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e",
    "url": "https://api.spiral-platform.com/v1/apps/100/dbs/200/300/400/files/f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e/download",
    "fileName": "sample.png",
    "fileSize": "5082",
    "createdAt": "2020-04-29T09:15:58Z"
  },
  {
    "fileKey": "200_3503ac054cd878b7b8f4fa66f8a9f4393664c599f496f653e5834a97cfa6b3b2",
    "url": "https://api.spiral-platform.com/v1/apps/100/dbs/200/300/400/files/200_3503ac054cd878b7b8f4fa66f8a9f4393664c599f496f653e5834a97cfa6b3b2/download",
    "fileName": "sample.txt"
  }
]
```
```json
{
  "records": [
    {
      "id": 1024,
      "createdAt": "2020-04-29T09:20:58Z"
    }
  ],
  "passwordField": {
    "hasValue": "true"
  },
  "userField": {
    "enableUser": {
      "id": 9,
      "firstName": "太郎",
      "lastName": "山田",
      "email": "spiral@example.com",
      "subEmail": "spiral-sub@example.com",
      "enabled": true
    },
    "disableUser": {
      "id": 10,
      "enabled": false
    }
  },
  "singleReferenceField": {
    "_id": "1",
    "textField": "text",
    "textareaField": "textarea\ntextarea",
    "emailField": "spiral@example.com",
    "phoneField": "+81 80-1111-2222",
    "integerField": null
  }
}
```
```json
{
  "100": {
    "(single referenceField)": {
      "(doubleField)": 200.1,
      "(dateField)": "2020-04-30",
      "(monthDayField)": "04-30",
      "(timeField)": "17:06:29",
      "(dateTimeField)": "2020-04-30T17:06:29Z",
      "(selectField)": "0",
      "(multiselectField)": ["0", "1"],
      "(userField enableUser)": {
        "id": 9,
        "firstName": "太郎",
        "lastName": "山田",
        "email": "spiral@example.com",
        "subEmail": "spiral-sub@example.com",
        "enabled": true
      },
      "(userField disableUser)": {
        "id": null
      }
    }
  }
}
```
```json
{
  "10": {
    "enabled": false
  },
  "(single referenceField)": {
    "(single referenceField)": {
      "_id": "1",
      "(textField)": "text",
      "(textareaField)": "textarea\ntextarea",
      "(emailField)": "spiral@example.com",
      "(phoneField)": "+81 80-1111-2222",
      "(integerField)": "100",
      "(doubleField)": "200.1",
      "(dateField)": "2020-04-30",
      "(monthDayField)": ""
    }
  }
}
```
```json
{
  "date": "04-30",
  "fields": {
    "(single referenceField).(single referenceField).(timeField)": "17:06:29",
    "(single referenceField).(single referenceField).(dateTimeField)": "2020-04-30T17:06:29Z",
    "(single referenceField).(single referenceField).(selectField)": "0",
    "(single referenceField).(single referenceField).(multiselectField)": ["0", "1"],
    "(single referenceField).(single referenceField).(userField enableUser)": {
      "id": 9,
      "firstName": "太郎",
      "lastName": "山田",
      "email": "spiral@example.com",
      "subEmail": "spiral-sub@example.com",
      "enabled": true
    },
    "(single referenceField).(single referenceField).(userField disableUser)": {
      "id": 10,
      "enabled": false
    },
    "(multi referenceField)": ["1", "3"]
  }
}
```
```json
{
  "multiReferenceField": [
    {
      "_id": "1",
      "textField": "text",
      "emailField": "spiral@example.com",
      "phoneField": "+81 80-1111-2222",
      "integerField": 100,
      "doubleField": 200.1,
      "dateField": "2020-04-30",
      "monthDayField": "04-30",
      "timeField": "17:06:29",
      "dateTimeField": "2020-04-30T17:06:29Z"
    },
    {
      "_id": "3",
      "textField": "text",
      "emailField": "spiral@example.com",
      "phoneField": "+81 80-1111-2222",
      "integerField": 100,
      "doubleField": 200.1,
      "dateField": "2020-04-30",
      "monthDayField": "04-30",
      "timeField": "17:06:29",
      "dateTimeField": "2020-04-30T17:06:29Z"
    }
  ]
}
```
```json
{
  "validation": {
    "fields": {
      "(multi referenceField).(selectField)": ["0", "0"]
    },
    "options": {
      "(selectField)": {
        "(optionId)": "ラベル1"
      },
      "(multiselectField)": {
        "(optionId)": "ラベル1"
      },
      "(single referenceField).(selectField)": {
        "(optionId)": "ラベル1"
      },
      "(single referenceField).(multiselectField)": {
        "(optionId)": "ラベル1"
      },
      "(single referenceField).(single referenceField).(selectField)": {
        "(optionId)": "ラベル1"
      },
      "(single referenceField).(single referenceField).(multiselectField)": {
        "(optionId)": "ラベル1"
      },
      "(multi referenceField).(selectField)": {
        "(optionId)": "ラベル1"
      }
    }
  }
}
```
### API Reference: Verify SPIRAL ver.2

#### Endpoint
`POST /apps/{app}/dbs/{db}/records/verify`

- **Production Environment**: `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/verify`
- **Beta Environment**: `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/verify`

#### Purpose
This API verifies whether a record identifier matches the associated password. It is intended for use with databases that include both a required, unique identifier field and a password-type field.

---

### Parameters

#### Path Parameters
| Name | Required | Type   | Description                      |
|------|----------|--------|----------------------------------|
| `app` | Yes      | String | Application ID                  |
| `db`  | Yes      | String | Database ID                     |

#### Header Parameters
| Name                | Type    | Default       | Example    | Description                                                                                            |
|---------------------|---------|---------------|------------|--------------------------------------------------------------------------------------------------------|
| `X-Spiral-App-Role` | String  | `_fullAccess` | `employee` | Specifies the application role to use. If omitted, "Full Access" role (`_fullAccess`) is applied by default. <br> - If the role specified is one the requesting user/API agent lacks permissions for, the API will return an error. |

---

### Request Body
- **Content-Type**: `application/json`

#### Schema
| Name      | Required | Type   | Description                                                                                     |
|-----------|----------|--------|-------------------------------------------------------------------------------------------------|
| `idField` | Yes      | Object | A required and unique field used to identify records. The API will search for and validate a record matching this field. |


```
### API Reference: Password Field Validation

#### Request

- **passwordField** (required, object):  
  The password field to be validated. This is the target of validation.  
  - If the stored (registered) value is `null`, the validation will fail, even if the value being validated is also `null`.

#### Responses

1. **200 OK**: Validation Result  
   - **Response Headers**:  
     - `X-Spiral-App-Role` (string): The app role, e.g., `"employee"`.
   - **Response Schema**: Content-Type `application/json`  
     - **`verified`** (boolean): Validation result.  
       - `true`: The record exists, and the password matches.  
       - `false`: Either the record identifier or the password does not match for some reason.  
     - **`recordId`** (string): The record ID.

2. **403 Forbidden**: Insufficient or missing app permissions.  
   - **Response Headers**:  
     - `X-Spiral-App-Role` (string): The app role, e.g., `"employee"`.
```
## APIリファレンス

---

### **Request**

#### **サンプルペイロード**
- **Content Type:** `application/json`

```json
{
  "idField": {
    "customerId(textField or emailField)": "bc100325"
  },
  "passwordField": {
    "loginPassword(passwordField)": "pK-4Pqec"
  }
}
```

---

### **Response**

#### **サンプルレスポンス**
- **ステータスコード:** `200`
- **Content Type:** `application/json`

**例:**

```json
{
  "verified": "true",
  "recordId": "10"
}
```

---

### **エンドポイント説明: Record (bulk)**

#### **機能**
- 指定のDBに最大**1000件**のレコードを一括登録します。
- **注意:** 以下のフィールド型は対象外のため、指定するとエラーとなります:
  1. パスワード型フィールド
  2. ファイル型フィールド
  3. ユーザフィールド

#### **HTTP メソッド**
- `POST`

#### **エンドポイントURL**
- **SPIRAL ver.2 APIサーバ（本番環境）**  
  `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/bulk`
  
- **SPIRAL ver.2 APIサーバ（ベータ環境）**  
  `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/bulk`

---

### **Path Parameters**

| パラメータ名  | 必須 | 型      | 説明       |
|---------------|------|---------|------------|
| `app`         | 必須 | `string`| アプリID   |
| `db`          | 必須 | `string`| DB ID      |

---

### **Header Parameters**

| パラメータ名           | 必須 | 型      | デフォルト値     | 例             | 説明                                                                 |
|------------------------|------|---------|------------------|----------------|----------------------------------------------------------------------|
| `X-Spiral-App-Role`    | 任意 | `string`| `_fullAccess`    | `employee`     | アプリロール                                                       |
  
**注記:**
- ヘッダーを指定しない場合、デフォルトで「全権限」のアプリロールが指定されます。
- 以下の場合にはエラーが返されます:
  - リクエストしたユーザまたはAPIエージェントが権限を持たないアプリロールを指定した場合。
### API Reference: Bulk Update Records

---

#### Request

- **Endpoint:**  
  **Production Environment:** `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/bulk`  
  **Beta Environment:** `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/bulk`

- **Method:** `PATCH`

- **Content Type:** `application/json`

- **Request Body Schema:**
  ```json
  {
    "records": [
      {
        "(textField)": "text",
        "(textareaField)": "textarea\ntextarea",
        "(emailField)": "spiral@example.com",
        "(phoneField)": "+81 80-1111-2222",
        "(integerField)": "100",
        "(doubleField)": "200.1",
        "(dateField)": "2020-04-30",
        "(monthDayField)": "04-30",
        "(timeField)": "17:06:29",
        "(dateTimeField)": "2020-04-30T17:06:29Z",
        "(selectField)": "0",
        "(multiselectField)": ["0", "1"],
        "(single referenceField)": "14",
        "(multi referenceField)": ["1", "3", "5"]
      }
    ]
  }
  ```

  - **`records`** (required):  
    Array of objects (up to 1000 items). Each object represents a record.

---

#### Responses

- **`200 OK`:**  
  Returns the array of newly registered record IDs.
  
  - **Response Headers:**
    - `X-Spiral-App-Role`: A string representing the app role. Example: `"employee"`

  - **Response Schema:**
    ```json
    {
      "ids": ["1", "2"]
    }
    ```

- **`403 Forbidden`:**  
  Indicates that the user lacks sufficient permissions to use the app.  
  
  - **Response Headers:**
    - `X-Spiral-App-Role`: A string representing the app role. Example: `"employee"`

---

#### Request Sample

- **Content Type:** `application/json`  

  ```json
  {
    "records": [
      {
        "(textField)": "text",
        "(textareaField)": "textarea\ntextarea",
        "(emailField)": "spiral@example.com",
        "(phoneField)": "+81 80-1111-2222",
        "(integerField)": "100",
        "(doubleField)": "200.1",
        "(dateField)": "2020-04-30",
        "(monthDayField)": "04-30",
        "(timeField)": "17:06:29",
        "(dateTimeField)": "2020-04-30T17:06:29Z",
        "(selectField)": "0",
        "(multiselectField)": ["0", "1"],
        "(single referenceField)": "14",
        "(multi referenceField)": ["1", "3", "5"]
      }
    ]
  }
  ```

---

#### Response Sample

- **`200 OK`:**
  ```json
  {
    "ids": ["1", "2"]
  }
  ```
# API Reference: Bulk Update Records

## Endpoint
**URL:**  
`https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/bulk`  

**Description:**  
Update records in bulk.  

- Maximum of **1,000 records** can be specified per request.
- The update key must be a **required, unique field** or the **Record ID**.
  - For field keys, only **text type** or **email address type** are allowed. Specifying other types will cause an error.
- Fields of the following types cannot be updated:
  - Password
  - File
  - User  
  Specifying these fields as update targets will result in an error.
- If the target record does not exist, it will be ignored.
- Even if no values are updated, the **update timestamp** and **revision number** will still be modified.

---

## Parameters

### Path Parameters
| Parameter | Type   | Required | Description                      |
|-----------|--------|----------|----------------------------------|
| **app**   | string | Yes      | Application ID                  |
| **db**    | string | Yes      | Database ID                     |

---

### Header Parameters
| Parameter              | Type   | Default       | Example    | Description          |
|------------------------|--------|---------------|------------|----------------------|
| **X-Spiral-App-Role**  | string | `_fullAccess` | `employee` | Application role     | 
### APIリファレンス

---

#### 概要
- ヘッダーの指定を省略した場合、「全権限」のアプリロールが指定されたものとしてAPIが実行される。
- リクエストしたユーザ・APIエージェントが権限を持たないアプリロールを指定された場合はエラーとなる。

---

### **Request**

#### **Request Body**
- **Schema:** `application/json`
- **フィールド:**
  - `records` *(必須)*  
    - データ型: 配列（Array of objects）
    - 制約: 最大 1000 要素まで
    - 説明: レコードの配列

---

### **Responses**

#### **200 OK**
- **説明:** 更新されたレコードIDの配列
- **Response Headers:**
  - `X-Spiral-App-Role`  
    - データ型: `string`  
    - 例: `"employee"` アプリロール
- **Response Schema:** `application/json`
  - **フィールド:**
    - `ids`  
      - データ型: 配列（Array of strings）  
      - 説明: レコードIDの配列

---

#### **403 Forbidden**
- **説明:** アプリの利用権限がない（または権限が不足している）
- **Response Headers:**
  - `X-Spiral-App-Role`  
    - データ型: `string`  
    - 例: `"employee"` アプリロール

---
### APIリファレンス構造化

---

#### **Request サンプル**
- **Payload Content type**
  - application/json

```json
{
  "records": [
    {
      "_id": "10",
      "_updateKey": {
        "customerId(textField or emailField)": "bc100325"
      },
      "_revision": "10",
      "fullName(textField)": "田中太郎",
      "description(textareaField)": "特になし\n",
      "email(emailField)": "spiral@example.com",
      "phoneNumber(phoneField)": "+81 80-1111-2222",
      "age(integerField)": "30",
      "height(doubleField)": "170.1",
      "applyDate(dateField)": "2020-04-30",
      "birthDay(monthDayField)": "04-30",
      "requestTime(timeField)": "17:30:00",
      "orderedAt(dateTimeField)": "2020-04-30T17:06:29Z",
      "prefecture(selectField)": "3",
      "choice(multiselectField)": ["0", "1"],
      "charge(single referenceField)": "14",
      "favoriteShop(multi referenceField)": ["1", "3", "5"]
    }
  ]
}
```

---

#### **Response サンプル**
- **200 Content type**
  - application/json

```json
{
  "ids": ["1", "2"]
}
```

---

#### **エンドポイント**
- **複数レコードを削除**
  - **API URL (本番環境):**
    - `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/bulk`
  - **API URL (ベータ環境):**
    - `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/bulk`

  **概要:**
  - 指定した削除キーのレコードを最大1000件一括削除する。

---

#### **Path パラメータ**
- **`app`**
  - 必須
  - **型:** string
  - 説明: アプリID

- **`db`**
  - 必須
  - **型:** string
  - 説明: DB ID

---
### API リファレンス構造化

#### Header Parameters
- **`X-Spiral-App-Role`**  
  - **Type**: `string`  
  - **Default**: `_fullAccess`  
  - **Example**: `employee`  
  - **Description**: アプリロールを指定します。指定を省略した場合、「全権限」のアプリロール（`_fullAccess`）が適用されます。リクエストユーザーやAPIエージェントが指定されたアプリロールに対する権限を持たない場合、エラーが発生します。

---

#### Request Body
- **Content Type**: `application/json`

##### Properties
1. **`ids`**
   - **Type**: `Array` of `strings` (最大 1000 アイテム)  
   - **Description**: レコードIDの配列です。`ids`を指定した場合、削除キーとして使用されます。
   - **Validation**:  
     - `ids`または`key`のいずれか片方を必ず指定してください。

2. **`key`**
   - **Type**: `string`  
   - **Description**: 削除キーとして使用されるフィールドの識別名を指定します。必須、かつ重複不可のフィールド（例: テキスト型、メールアドレス型）に限ります。
   - **Validation**:  
     - `ids`または`key`のいずれか片方を必ず指定してください。

3. **`values`**
   - **Type**: `Array` of `strings` (最大 1000 アイテム)  
   - **Description**: `key`を指定した場合、その削除キーに関連付けられた値の配列を指定します。
   - **Validation**:  
     - `key`を指定した場合、このフィールドは必須です。

---

#### Responses

1. **`204 No Content`**
   - **Description**: 正常に処理され、レスポンスデータはありません。
   - **Response Headers**:
     - **`X-Spiral-App-Role`**  
       - **Type**: `string`  
       - **Example**: `"employee"`  
       - **Description**: 実行時に使用されたアプリロール。

2. **`403 Forbidden`**
   - **Description**: アプリに対する利用権限がない、または権限が不足している場合に発生します。
### API リファレンス（構造化）

#### **エンドポイント：レコード一括出力依頼一覧を取得**
`get /apps/{app}/dbs/{db}/records/exports`

---

#### **概要**
指定されたDBの一括出力依頼の一覧を取得します。  
- 一括出力依頼が完了している場合、`status`が`succeeded`に更新され、ファイルURLが取得可能になります。
- 生成されたファイルは24時間後に自動削除されます。
- `status`が`canceled`、`succeeded`、`failed`の依頼は14日後に自動削除されます。

---

#### **APIサーバー（環境情報）**
- **SPIRAL ver.2 APIサーバ（本番環境）**  
  `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/exports`
- **SPIRAL ver.2 APIサーバ（ベータ環境）**  
  `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/exports`

---

#### **パスパラメータ**

| パラメータ | 必須 | 型    | 説明       |
|------------|------|-------|------------|
| `app`      | 必須 | string | アプリID    |
| `db`       | 必須 | string | DBID       |

---

#### **レスポンスヘッダー**

| ヘッダー名              | 型     | 説明                  |
|-------------------------|--------|-----------------------|
| `X-Spiral-App-Rolestring` | string | アプリロール（例: `"employee"`） |

---

#### **リクエストサンプル**
**Payload**
```json
{
  "ids": ["10", "20"],
  "key": "CustomerId",
  "values": ["CU0001", "CU0002"]
}
```
## APIリファレンス

### Query Parameters

#### `sort`
- **Type**: `string`
- **Default**: `"createdAt:desc"`
- **Enum**:
  - `"id:asc"`
  - `"id:desc"`
  - `"status:asc"`
  - `"status:desc"`
  - `"createdAt:asc"`
  - `"createdAt:desc"`
  - `"finishedAt:asc"`
  - `"finishedAt:desc"`
- **Description**: ソートする対象。以下のフィールドで指定可能：
  - 一括出力依頼ID (`id`)
  - ステータス (`status`)
  - 作成日時 (`createdAt`)
  - 処理終了日時 (`finishedAt`)
- フィールド識別名の後に `:asc` を付けると昇順、`:desc` を付けると降順になります。

#### `offset`
- **Type**: `integer`
- **Example**: `offset=20`
- **Description**: リストのオフセット。

#### `limit`
- **Type**: `integer`
- **Default**: `20`
- **Range**: `[1 .. 200]`
- **Example**: `limit=20`
- **Description**: リストの上限。

---

### Header Parameters

#### `X-Spiral-App-Role`
- **Type**: `string`
- **Default**: `_fullAccess`
- **Example**: `employee`
- **Description**: 指定するアプリロール。
  - ヘッダーの指定を省略した場合、デフォルトで「全権限」のアプリロール (`_fullAccess`) が指定されたものとしてAPIが実行される。
  - リクエストしたユーザまたはAPIエージェントが権限を持たないアプリロールが指定されるとエラーとなる。

---

### Responses

#### Status: `200`
**Description**: レコードの一括出力依頼一覧。

##### Response Headers

- **`X-Spiral-App-Role`**
  - **Type**: `string`
  - **Example**: `"employee"`
  - **Description**: アプリロール。

##### Response Schema
- **Content Type**: `application/json`
- **Structure**:
  - **`items`**: Array of objects  
    レコードの一括出力依頼のリスト。
  - **`prevOffset`**: `integer`  
    前のリストのオフセット。前のリストが存在しない場合は `null`。
```
# APIリファレンス構造

## パラメーター
- **nextOffset**  
  - **Type**: integer  
  - **Description**: 次のリストのオフセット。次のリストが存在しない場合は `null`。

- **totalCount**  
  - **Type**: integer  
  - **Description**: 検索結果の全件数。

## エラーレスポンス
- **403 Forbidden**
  - **Description**: アプリの利用権限がない（または不足している）。

### Response Headers
- **X-Spiral-App-Role**  
  - **Type**: string  
  - **Example**: `"employee"`  
  - **Description**: アプリロール。

### Response サンプル
- **Status Code**: 200  
- **Content type**: application/json

```json
{
    "items": [
        {
            "id": "100",
            "operatedFrom": "ui",
            "fileName": "string",
            "fileFormat": "tsv",
            "characterCode": "utf-8",
            "hasHeader": true,
            "headerType": "name",
            "sort": "_id:DESC",
            "where": "string"
        }
    ]
}
```
```
```json
{
  "exists": {
    "type": "exists",
    "fieldId": "100",
    "otherDbId": "200",
    "otherDbFieldId": "200"
  },
  "excludeEmailError": {
    "fieldId": "100",
    "count": 1
  },
  "fields": [
    {
      "field": "_id"
    },
    {
      "field": "_createdAt",
      "format": "dateTime"
    },
    {
      "field": "1",
      "format": "E164"
    }
  ],
  "status": "waiting",
  "files": [
    {
      "url": "https://api.spiral-platform.com/v1/apps/100/dbs/100/records/download/200/1",
      "fileSize": 104857600,
      "recordCount": 81752
    },
    {
      "url": "https://api.spiral-platform.com/v1/apps/100/dbs/100/records/download/200/2",
      "fileSize": 31457280,
      "recordCount": 21590
    }
  ],
  "errorMessage": [
    {
      "code": "internalError",
      "message": ""
    }
  ]
}
```
```
API Reference: レコード一括出力依頼の作成

## 機能概要
指定されたDBのレコードを一括で出力するための依頼を作成します。出力されたファイルは別のAPIで取得可能なURL経由でダウンロードできます。ファイルは 100MiB 単位で分割され、最大 30 ファイルまで一時保存されます。

---

## エンドポイント
- 本番環境:  
  https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/exportsSPIRAL ver.2
- ベータ環境:  
  https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/exports

---

## 動作仕様
1. 出力ファイルは 100MiB 単位で分割される。
2. 生成されたファイルは 1 アカウントあたり最大 30 ファイルまで一時的に保存される。
3. 30 ファイル分が保存されている状態で新しい依頼をリクエストすると、作成日時が最も古いファイルから削除される。

---

## エラーレスポンス例
1. **エラーコード:** `internal error`  
   - **`locationType`:** null  
   - **`location`:** null  

2. **エラーコード:** `invalidParameter`  
   - **`message`:** "does not exist"  
   - **`locationType`:** "body"  
   - **`location`:** "/sort"  

---

## メタデータ
- **作成日時:** `createdAt`: 2019-08-24T14:15:22Z  
- **完了日時:** `finishedAt`: 2019-08-24T14:15:22Z  
- **ファイル削除日時:** `fileDeletedAt`: 2019-08-24T14:15:22Z  
- **タイムゾーン:** `recordValueTimeZone`: Asia/Tokyo  

---

## ページネーション情報
- **前のオフセット:** `prevOffset`: 0  
- **次のオフセット:** `nextOffset`: 40  
- **総レコード数:** `totalCount`: 200  

---
```
### APIリファレンス構造化内容

---

#### 1. 基本情報
- **一時保存ファイルの自動削除**  
  - 生成された一時保存ファイルは、**24時間後に自動削除**されます。

- **依頼制限**  
  - `status` が **`waiting`** の依頼は、**最大5件まで**実行可能です。

---

#### 2. Path Parameters
| パラメータ名 | 必須 | 型 | 説明 |
|--------------|------|----|------|
| `app`        | 必須 | string | アプリID |
| `db`         | 必須 | string | DBID |

---

#### 3. Header Parameters
| パラメータ名            | 型     | デフォルト値         | 説明 |
|-------------------------|--------|----------------------|------|
| `X-Spiral-App-Role`     | string | `_fullAccess`        | アプリロール<br>例: `employee` |

- **注意事項**:  
  - ヘッダーの指定を省略した場合、APIは「全権限」のアプリロール (`_fullAccess`) を指定されたものとして実行されます。  
  - リクエストを行うユーザ・APIエージェントが、一部のアプリロールに対する権限を持たない場合、**エラー**となります。

---

#### 4. Request Body
- **Content Type**: `application/json`

| フィールド名        | 型       | 制約/デフォルト値                       | 説明                               |
|---------------------|----------|----------------------------------------|------------------------------------|
| `fileName`          | string   | [1..128文字]                           | ファイル名。<br>`{DB識別名}_{依頼日時の年月日時分}` がデフォルト。<br>使用できる文字: アルファベット大文字・小文字、数字のみ |
| `fileFormat`        | string   | デフォルト: `"tsv"`<br>Enum: `"tsv"`, `"csv"` | ファイルフォーマット               |
| `characterCode`     | string   | デフォルト: `"utf-8"`<br>Enum: `"utf-8"`, `"utf-8WithBOM"` | 文字コード                         |
| `hasHeader`         | boolean  | デフォルト: `true`                     | **`true`**: ヘッダありのファイルを出力<br>**`false`**: ヘッダなしのファイルを出力 |
```
### API Reference

#### **headerType** (string)
- **Default**: "name"
- **Enum**: "name", "displayName", "fieldId"
- **Description**: タイプを指定し、ヘッダーに出力します。
  - **Conditions**:
    - `hasHeader` が未指定または `true` の場合、指定可能。
    - `false` の場合、指定するとエラーが発生。

---

#### **sort** (string)
- **Default**: "_id:ASC"
- **Description**: ファイル内のレコードの並び順を指定します。
  - **対象フィールド**:
    - レコードID、ユーザ作成フィールド。
  - **指定不可フィールド**:
    - マルチセレクト、ファイル、パスワード、参照フィールド型、および `_createdBy`, `_updatedBy`。
  - **使用例**:
    - フィールド識別名の後に `":ASC"` または `":asc"` を付けると昇順。
    - `":DESC"` または `":desc"` を付けると降順。

---

#### **where** (string)
- **Length**: [1 .. 4096] characters
- **Description**: 高度な条件抽出を指定します。
  - 抽出条件式を記述してください。
  - **詳細**: 詳しくはサポートサイトをご確認ください。

---

#### **exists** (object)
- **Description**: 他のDBのフィールド値に基づいてデータを抽出します。
  - **Default**: 未指定の場合、抽出しません。

---

#### **excludeEmailError** (object)
- **Description**: 配信エラーのあるデータを除外します。
  - **Default**: 未指定の場合、抽出しません。

---

#### **fields** (Array of objects)
- **Description**: 出力するフィールドのリストを指定します。
  - 指定したフィールドの並び順でファイルを出力します。
```
```
API リファレンス構造化

---

### 共通設定
- **全フィールド出力**
  - デフォルトでは全フィールドを出力。

- **recordValueTimeZone**: `string`
  - **Default**: `"UTC"`
  - 日時フィールド（作成日時、更新日時）を指定したタイムゾーンの時刻に変換して出力。
  - **補足**: タイムゾーンの一覧はサポートサイトをご確認ください。

---

### Responses

#### HTTP 201: 依頼した一括出力成功時

##### **Response Headers**
- **X-Spiral-App-Role**: `string`
  - **Example**: `"employee"`
  - アプリロールを出力。

##### **Response Schema**: `application/json`

- **id**: `string`
  - 一括出力依頼ID。
  
- **operatedFrom**: `string`
  - **Enum**: `"ui"`, `"api"`
  - 操作元。

- **fileName**: `string`
  - ファイル名。

- **fileFormat**: `string`
  - **Enum**: `"tsv"`, `"csv"`
  - ファイルフォーマット。

- **characterCode**: `string`
  - **Enum**: `"utf-8"`, `"utf-8WithBOM"`
  - 文字コード。

- **hasHeader**: `boolean`
  - **true**:
    - ヘッダありのファイルを出力。
  - **false**:
    - ヘッダなしのファイルを出力。

- **headerType**: `string`
  - **Enum**: `"name"`, `"displayName"`, `"fieldId"`
  - ヘッダに出力するタイプ。

- **sort**: `string`
  - ファイル内のレコードの並び順。
  - **補足**:
    - ソート可能な対象:
      - レコードID。
      - ユーザ作成フィールド。
    - 指定不可のフィールド型:
      - マルチセレクト、ファイル、パスワード、参照フィールド。
      - および`_createdBy`, `_updatedBy`。
```
- **フィールド識別名の昇順/降順指定**  
  フィールド識別名の後に以下を使用することで並び順を指定できます：  
  - `:ASC` または `:asc`: 昇順  
  - `:DESC` または `:desc`: 降順  

---

### パラメーター詳細

- **`wherestring`**  
  高度な条件抽出を行う抽出条件式を記述します。詳細はサポートサイトをご確認ください。

- **`existsobject`**  
  他のデータベース（DB）のフィールド値を利用した抽出を行います。  
  未指定の場合、抽出処理は実行されません。

- **`excludeEmailErrorobject`**  
  配信エラーを除外する抽出を行います。  
  未指定の場合、配信エラーは抽出条件に影響を与えません。

- **`fields`** *(Array of objects)*  
  出力するフィールドのリストを指定します。指定したフィールドは、その並び順に基づいてファイル出力されます。  
  未指定の場合、すべてのフィールドが出力されます。

- **`recordValueTimeZone`** *(string)*  
  日時フィールド（例: 作成日時、更新日時）を指定したタイムゾーンの時刻に変換して出力します。  
  タイムゾーンの一覧についてはサポートサイトをご確認ください。

- **`status`** *(string)*  
  処理状況を示すステータス。以下のいずれかの値を取ります：  
  - `"waiting"`  
  - `"processing"`  
  - `"canceling"`  
  - `"canceled"`  
  - `"succeeded"`  
  - `"failed"`  

- **`createdAt`** *(string, <date-time>)*  
  作成日時を記録します。

- **`updatedAt`** *(string, <date-time>)*  
  更新日時を記録します。
```plaintext
# API Reference: 403 アプリの利用権限がない（または不足している）

## 概要
このエラーは、アプリケーションの利用権限がない、または不足している場合に発生します。

---

## Response Headers

### X-Spiral-App-Role 【型: string】
- アプリのロール情報を表すヘッダー。

#### Example:
```
"employee"
```

---

## Request Samples: Payload

### Content-Type: `application/json`

#### Example:
```json
{
  "fileName": "recordExport",
  "fileFormat": "tsv",
  "characterCode": "utf-8",
  "hasHeader": true,
  "headerType": "name",
  "sort": "_id:DESC",
  "where": "@email ILIKE '%@example.com' OR @email ILIKE '%@example.net' AND @birthDay >= DATE('1990-01-01') AND @birthDay <= DATE('2000-12-31')",
  "exists": {
    "type": "exists",
    "fieldId": "100",
    "otherDbId": null
  }
}
```

--- 
```
```
API Reference Structure:

1. HTTP Response Code:
   - Status Code: "200"
   - Description: Indicates a successful request.

2. `excludeEmailError`:
   - `fieldId`: "100"
   - `count`: 1
   
3. Fields:
   - Field Definitions:
     1. `field`: "_id"
     2. `field`: "_createdAt", `format`: "dateTime"
     3. `field`: "1", `format`: "E164"

4. `recordValueTimeZone`:
   - Value: "Asia/Tokyo"

5. Response Samples:
   - HTTP Status Code: 201
   - Content Type: `application/json`

6. JSON Response Example:
   ```json
   {
       "id": "100",
       "operatedFrom": "ui",
       "fileName": "string",
       "fileFormat": "tsv",
       "characterCode": "utf-8",
       "hasHeader": true,
       "headerType": "name",
       "sort": "_id:DESC",
       "where": "string",
       "exists": {
           "type": "exists",
           "fieldId": "100",
           "otherDbId": "200",
           "otherDbFieldId": "200"
       },
       "excludeEmailError": {
           "fieldId": "100",
           "count": 1
       },
       "fields": [
           {"field": "_id"},
           {"field": "_createdAt", "format": "dateTime"},
           {"field": "1", "format": "E164"}
       ]
   }
   ```
```
### APIリファレンス: レコード一括出力依頼を取得

#### 概要
**エンドポイント:**
- 環境: [SPIRAL ver.2 APIサーバ](https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/exports/{recordExportId})
- ベータ環境: [SPIRAL ver.2 (ベータ環境)](https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/exports/{recordExportId})

指定したデータベース (DB) に登録された一括出力依頼を取得します。  
依頼ステータスが `succeeded` に更新されると、ファイルのURLを取得可能です。

#### 仕様
1. **ファイル有効期限**: 生成されたファイルは作成から24時間後に自動削除されます。
2. **依頼有効期限**: `canceled`, `succeeded`, `failed` 状態の依頼は、作成から14日後に自動削除されます。

---

### パラメーター

#### **Path Parameters**
| パラメーター名       | 必須   | 型      | 説明           |
|----------------------|--------|---------|----------------|
| `app`               | 必須   | string  | アプリID       |
| `db`                | 必須   | string  | DB ID          |
| `recordExportId`    | 必須   | string  | 一括出力依頼ID |

#### **Header Parameters**
| パラメーター名            | 型      | デフォルト値   | 説明            |
|---------------------------|---------|----------------|-----------------|
| `X-Spiral-App-Role`       | string  | `_fullAccess`  | アプリロール    |
|                           |         |例: `employee` |                 |


```
### APIリファレンス

#### 概要
- ヘッダーの指定を省略した場合、「全権限」のアプリロールが指定されたものとしてAPIが実行される。
- リクエストしたユーザまたはAPIエージェントが権限を持たないアプリロールを指定した場合、エラーとなる。

---

### レスポンス

#### HTTPステータス
- **200**: 指定した一括出力依頼を正常に取得。

#### Response Headers
- **X-Spiral-App-Role** (`string`): アプリロール  
  例: `"employee"`

#### Response Schema
- **Content-Type:** `application/json`

##### フィールド一覧
1. **id** (`string`): 一括出力依頼ID
2. **operatedFrom** (`string`): 操作元  
   - Enum: `"ui"`, `"api"`
3. **fileName** (`string`): ファイル名
4. **fileFormat** (`string`): ファイルフォーマット  
   - Enum: `"tsv"`, `"csv"`
5. **characterCode** (`string`): 文字コード  
   - Enum: `"utf-8"`, `"utf-8WithBOM"`
6. **hasHeader** (`boolean`):  
   - `true`: ヘッダありのファイルを出力  
   - `false`: ヘッダなしのファイルを出力
7. **headerType** (`string`): ヘッダに出力するタイプ  
   - Enum: `"name"`, `"displayName"`, `"fieldId"`
8. **sort** (`string`): ファイル内のレコードの並び順  
   - ソート可能なフィールド対象:
     - レコードID
     - ユーザ作成フィールド
   - **ソート不可のフィールド型:**
     - マルチセレクト
     - ファイル
     - パスワード
     - 参照フィールド型
     - システムフィールド: `_createdBy`, `_updatedBy`

```
- **フィールド識別名**  
  - `:ASC` または `:asc`: 昇順  
  - `:DESC` または `:desc`: 降順  

- **wherestring**  
  - **説明**: 高度な条件抽出  
  - **詳細**: 抽出条件式を記述する  
  - **補足**: 詳細はサポートサイトを確認  

- **existsobject**  
  - **説明**: 他DBのフィールド値による抽出  
  - **未指定時の動作**: 抽出しない  

- **excludeEmailErrorobject**  
  - **説明**: 配信エラーの除外  
  - **未指定時の動作**: 抽出しない  

- **fields**  
  - **データ型**: 配列 (Array of objects)  
  - **説明**: 出力するフィールドのリスト  
  - **挙動**: 指定したフィールドの並び順でファイルを出力  
  - **未指定時の動作**: 全フィールドを出力  

- **status**  
  - **データ型**: 文字列 (string)  
  - **選択肢 (Enum)**: `"waiting"`, `"processing"`, `"canceling"`, `"canceled"`, `"succeeded"`, `"failed"`  
  - **説明**: 依頼状況ステータス  

- **files**  
  - **データ型**: 配列 (Array of objects)  
  - **説明**: 一括出力で生成されたファイル  
  - **注釈**: `status`が`succeeded`のときに出力される  

- **errorMessage**  
  - **データ型**: オブジェクト (object)  
  - **説明**: エラーメッセージ  
  - **注釈**: `status`が`failed`のときに出力される  

- **createdAt**  
  - **データ型**: 文字列 (string) `<date-time>`  
  - **説明**: 作成日時  

- **finishedAt**  
  - **データ型**: 文字列 (string) `<date-time>`  
  - **説明**: 処理終了日時  
  - **注釈**: `status`が`canceled`、`succeeded`、`failed`のときに出力される  

- **fileDeletedAt**  
  - **データ型**: 文字列 (string) `<date-time>`  
  - **説明**: ファイル削除日時  
### APIリファレンス構造化

#### 条件
- **status** が `succeeded` かつファイルが削除された場合に出力

#### パラメータ
- **recordValueTimeZone**: *string*  
  - 日時フィールド（作成日時、更新日時）を、指定したタイムゾーンの時刻に変換して出力  
  - **補足**: タイムゾーンの一覧についてはサポートサイトをご確認ください。

#### エラーレスポンス
- **403**: アプリの利用権限がない、または権限が不足している

#### レスポンスヘッダー
- **X-Spiral-App-Role**: *string*  
  - **例**: `"employee"` （アプリロール情報）

#### レスポンスサンプル
- **ステータスコード**: `200`  
  - **Content-Type**: `application/json`  

```json
{
  "id": "100",
  "operatedFrom": "ui",
  "fileName": "string",
  "fileFormat": "tsv",
  "characterCode": "utf-8",
  "hasHeader": true,
  "headerType": "name",
  "sort": "_id:DESC",
  "where": "string",
  "exists": {
    "type": "exists",
    "fieldId": "100",
    "otherDbId": "200",
    "otherDbFieldId": "200"
  },
  "excludeEmailError": {
    "fieldId": "100",
    "count": 1
  },
  "fields": [
    {
      "field": "_id"
    },
    {
      "field": "_createdAt",
      "format": "dateTime"
    },
    {
      "field": "1",
      "format": "E164"
    }
  ],
  "status": "waiting",
  "files": [
    {
      "url": "https://api.spiral-platform.com/v1/apps/100/dbs/100/records/download/200/1",
      "fileSize": 104857600,
      "recordCount": 81752
    }
  ]
}
```
### APIリファレンス: レコード一括出力依頼をキャンセル

#### エンドポイント
```
POST /apps/{app}/dbs/{db}/records/exports/{recordExpo}
```

---

### パラメーター
| パラメーター名 | 型     | 必須 | 説明                             |
|----------------|--------|------|----------------------------------|
| `{app}`        | String | はい | アプリケーションID               |
| `{db}`         | String | はい | データベースID                   |
| `{recordExpo}` | String | はい | エクスポート依頼ID               |

---

### レスポンス
#### 成功時の構造
```json
{
  "url": "https://api.spiral-platform.com/v1/apps/100/dbs/100/records/download/200/2",
  "fileSize": 31457280,
  "recordCount": 21590
}
```
- `url`: ダウンロードURL。
- `fileSize`: ファイルサイズ (バイト)。
- `recordCount`: レコード数。

---

#### エラー時の構造
```json
{
  "errorMessage": [
    {
      "code": "internalError",
      "message": "internal error",
      "locationType": null,
      "location": null
    },
    {
      "code": "invalidParameter",
      "message": "does not exist",
      "locationType": "body",
      "location": "/sort"
    }
  ]
}
```
- `errorMessage`: 以下のリストでエラー詳細を提供。
  - `code`: エラーコード。例: `internalError`, `invalidParameter`
  - `message`: エラーの詳細メッセージ。
  - `locationType`: エラー発生箇所のタイプ (例: `body`)。
  - `location`: 特定のエラー発生箇所。例: `/sort`。

---

### メタデータ
| フィールド名            | 型       | 説明                                         |
|-------------------------|----------|---------------------------------------------|
| `createdAt`             | String   | エクスポートが作成された日時。ISO 8601形式。 |
| `finishedAt`            | String   | エクスポートが完了した日時。ISO 8601形式。   |
| `fileDeletedAt`         | String   | ファイルが削除された日時。ISO 8601形式。     |
| `recordValueTimeZone`   | String   | レコードデータのタイムゾーン情報。例: `Asia/Tokyo` |

---

### タイムスタンプ例
- `createdAt`: `"2019-08-24T14:15:22Z"`
- `finishedAt`: `"2019-08-24T14:15:22Z"`
- `fileDeletedAt`: `"2019-08-24T14:15:22Z"`
- `recordValueTimeZone`: `"Asia/Tokyo"`
# API リファレンス：キャンセルSPIRAL ver.2

## 概要
このAPIは、一括出力が完了していない依頼をキャンセルするためのものです。

### 主な仕様
- **キャンセル可能なステータス**  
  `waiting` または `processing`
- 状態の変化:
  - `waiting` → `canceled`
  - `processing` → `canceling`  
    `canceling` 状態は、サービス内部のキャンセル処理が完了後に `canceled` に更新されます。
- その他のステータスに対して実行した場合は、エラーが返されます。

---

## エンドポイント一覧

### 本番環境
```
https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/exports/{recordExportId}/cancel
```

### ベータ環境
```
https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/exports/{recordExportId}/cancel
```

---

## HTTP メソッド
`POST`

---

## パラメータ

### 1. **Path Parameters**
| パラメータ名      | 必須 | 型       | 説明             |
|-------------------|------|----------|------------------|
| **app**           | 必須 | `string` | アプリID         |
| **db**            | 必須 | `string` | DB ID            |
| **recordExportId**| 必須 | `string` | 一括出力依頼ID   |

---

### 2. **Header Parameters**
| ヘッダー名                   | 必須 | 型       | デフォルト値         | 説明 |
|------------------------------|------|----------|----------------------|------|
| **X-Spiral-App-Role**        | 任意 | `string` | `_fullAccess`        | アプリロールを指定します。もし指定を省略した場合、デフォルトで「全権限」のアプリロールが設定されます。|

#### 注意点
- リクエストしたユーザまたはAPIエージェントが、指定されたアプリロールの権限を持っていない場合は、エラーを返します。

---

## 状態の変化例
| 実行前の Status | 実行後の Status   | 備考                  |
|------------------|------------------|-----------------------|
| `waiting`        | `canceled`       | 即座に `canceled` となる |
| `processing`     | `canceling` → `canceled` | 内部処理完了後に更新 |

---


# API Documentation: Responses201 - キャンセルした一括出力依頼

## Response Headers

- **X-Spiral-App-Role**: `string`  
  - **Example**: `"employee"`  
  アプリロール

---

## Response Schema: application/json

### Properties

- **id**: `string`  
  一括出力依頼ID

- **operatedFrom**: `string`  
  Enum: `"ui"`, `"api"`  
  操作元
  
- **fileName**: `string`  
  ファイル名

- **fileFormat**: `string`  
  Enum: `"tsv"`, `"csv"`  
  ファイルフォーマット

- **characterCode**: `string`  
  Enum: `"utf-8"`, `"utf-8WithBOM"`  
  文字コード

- **hasHeader**: `boolean`  
  - `true`: ヘッダありのファイルを出力  
  - `false`: ヘッダなしのファイルを出力  

- **headerType**: `string`  
  Enum: `"name"`, `"displayName"`, `"fieldId"`  
  ヘッダに出力するタイプ

- **sort**: `string`  
  ファイル内のレコードの並び順  
  - ソートできるフィールド（レコードIDやユーザ作成フィールド）に対して適用可能  
  - **制約**: 下記のフィールドは指定不可:  
    - マルチセレクト  
    - ファイル  
    - パスワード  
    - 参照フィールド型  
    - `_createdBy`  
    - `_updatedBy`  
  - 指定例: フィールド識別名の後に以下を付加  
    - 昇順: `:ASC` または `:asc`  
    - 降順: `:DESC` または `:desc`  

- **where**: `string`  
  高度な条件抽出  
  - 抽出条件式を記述可能  
  - 詳細はサポートサイトを参照
### APIリファレンス

#### Parameters

- **existsobject**
  - 他DBのフィールド値による抽出
  - 未指定の場合、抽出しない

- **excludeEmailErrorobject**
  - 配信エラー除外
  - 未指定の場合、抽出しない

- **fields**
  - **Type:** Array of objects  
  - 出力するフィールドのリスト
  - 指定したフィールドの並び順でファイルを出力
  - 未指定の場合、全フィールドを出力

#### Properties

- **status**
  - **Type:** string
  - **Enum:** `"waiting"`, `"processing"`, `"canceling"`, `"canceled"`, `"succeeded"`, `"failed"`
  - 依頼状況ステータス

- **createdAt**
  - **Type:** string  
  - **Format:** <date-time>
  - 作成日時

- **finishedAt**
  - **Type:** string  
  - **Format:** <date-time>
  - 処理終了日時
  - **Note:** statusが`canceled`, `succeeded`, `failed`の時に出力

#### Error Responses

- **403 Forbidden**
  - アプリの利用権限がない（または不足している）

##### Response Headers

- **X-Spiral-App-Role**
  - **Type:** string  
  - **Example:** `"employee"`  
  - アプリロール
### API リファレンス構造化

---

#### **Response - Sample**

**HTTP Status**: `201`  
**Content-Type**: `application/json`  

```json
{
  "id": "100",
  "operatedFrom": "ui",
  "fileName": "string",
  "fileFormat": "tsv",
  "characterCode": "utf-8",
  "hasHeader": true,
  "headerType": "name",
  "sort": "_id:DESC",
  "where": "string",
  "exists": {
    "type": "exists",
    "fieldId": "100",
    "otherDbId": "200",
    "otherDbFieldId": "200"
  },
  "excludeEmailError": {
    "fieldId": "100",
    "count": 1
  },
  "fields": [
    {
      "field": "_id"
    },
    {
      "field": "_createdAt",
      "format": "dateTime"
    },
    {
      "field": "1",
      "format": "E164"
    }
  ],
  "status": "waiting",
  "createdAt": "2019-08-24T14:15:22Z",
  "finishedAt": "2019-08-24T14:15:22Z"
}
```

---

### **エンドポイント説明: レコード一括登録依頼一覧を取得**

#### **HTTP Method**: GET  
**Endpoint**:  
- **本番環境**: `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/batchInserts`  
- **ベータ環境**: `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/batchInserts`

---

### **エンドポイントの概要**

指定されたデータベース（DB）の一括登録依頼一覧を取得します。

---

### **Path Parameters**

| Parameter Name | Required | Type   | Description          |
|----------------|----------|--------|----------------------|
| `app`          | Yes      | String | アプリID             |
| `db`           | Yes      | String | DBID（データベースID）|


```
# APIリファレンス

## Query Parameters

### `sort` (string)  
- **Default**: `"createdAt:desc"`  
- **Enum**:  
  - `"id:asc"`  
  - `"id:desc"`  
  - `"status:asc"`  
  - `"status:desc"`  
  - `"createdAt:asc"`  
  - `"createdAt:desc"`  
  - `"finishedAt:asc"`  
  - `"finishedAt:desc"`  
- **Description**:  
  ソートする対象 (ID、ステータス、作成日時、終了日時)  
  - `":asc"` を指定すると昇順  
  - `":desc"` を指定すると降順  
  - ステータスを指定した場合、処理が遷移する順番で並びます。

---

### `offset` (integer)  
- **Example**: `offset=20`  
- **Description**:  
  リストのオフセット位置を指定します。

---

### `limit` (integer)  
- **Range**: `[ 1 .. 200 ]`  
- **Default**: `20`  
- **Example**: `limit=20`  
- **Description**:  
  リストの取得上限を指定します。

---

## Header Parameters

### `X-Spiral-App-Role` (string)  
- **Default**: `_fullAccess`  
- **Example**: `employee`  
- **Description**:  
  - アプリロールを指定します。  
  - ヘッダーの指定を省略した場合、デフォルトで「全権限」(`_fullAccess`) のアプリロールが指定されたものとしてAPIが実行されます。  
  - リクエストしたユーザ、またはAPIエージェントが権限を持たないアプリロールを指定した場合、エラーとなります。

---

## Responses

### **`200`**  
指定した一括登録依頼に対するレスポンスです。  

#### Response Headers  

- **`X-Spiral-App-Role`** (string)  
  - **Example**: `"employee"`  
  - **Description**: 応答時のアプリロール。

---

### Response Schema: `application/json`

#### Properties

- **`items`** (Array of objects)  
  一括登録依頼の詳細を格納したオブジェクト配列。

- **`prevOffset`** (integer)  
  - **Description**:  
    前のリストのオフセット位置を返します。  
    前のリストが存在しない場合、`null` を返します。
```
```
# APIリファレンス

## リソース
### レコード一括登録依頼を作成
- **エンドポイント (本番環境):**
  ```
  https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/batchInserts
  ```

- **エンドポイント (ベータ環境):**
  ```
  https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/batchInserts
  ```

- **説明:**
  レコードを一括で登録するためのAPIです。
  *リクエストフォーマット*: `multipart/form-data`

---

## レスポンスフィールド
### メインレスポンス
| フィールド名       | 型        | 説明                                |
|-------------------|----------|-----------------------------------|
| `nextOffset`      | integer  | 次のリストのオフセット。次のリストが存在しない場合は`null` |
| `totalCount`      | integer  | 検索結果の全件数                     |

#### レスポンスサンプル (200)
- **Content Type:** `application/json`
```json
{
  "items": [
    {
      "id": "100",
      "operatedFrom": "ui",
      "status": "waiting",
      "errors": [
        {
          "code": "string",
          "message": "string",
          "locationType": "string",
          "location": "string",
          "row": 0,
          "column": 0
        }
      ],
      "onError": "rollback",
      "fileName": "content.csv",
      "fileSize": 104857600,
      "numberRows": 100,
      "numberRowsSuccessful": 100,
      "numberRowsFailed": 100,
      "rowsFailed": "1,3,4",
      "createdAt": "2019-08-24T14:15:22Z",
      "finishedAt": "2019-08-24T14:15:22Z"
    }
  ],
  "prevOffset": 0,
  "nextOffset": 40,
  "totalCount": 200
}
```

---

## エラーレスポンス
### ステータスコード
- **403 Forbidden**  
  *メッセージ:* アプリの利用権限がない（または不足している）

#### Response Headers
| 名前                    | 型     | 説明                      | 例                      |
|-----------------------|-------|-------------------------|-----------------------|
| `X-Spiral-App-Role` | string | アプリロールを示します | `"employee"`          |
```
# APIリファレンス

## 概要
- 同一DB上で、一括登録/一括更新/一括削除の処理中は、新たにこれらの操作は依頼できません。
- **対象外フィールド**: パスワード型フィールド、ファイル型フィールド、ユーザフィールド。
  - インポートファイルのヘッダ行にこれら対象外フィールドの識別名が指定されている場合、エラーが発生します。

---

## Path Parameters
### `app` (required)
- **Type**: string
- **Description**: アプリID

### `db` (required)
- **Type**: string
- **Description**: DBID

---

## Header Parameters
### `X-Spiral-App-Role`
- **Type**: string
- **Default**: `_fullAccess`
- **Example**: `employee` (アプリロール)
- **動作**:
  - ヘッダーの指定を省略した場合、デフォルト値（全権限のアプリロール）が適用されます。
  - リクエストしたユーザ/ APIエージェントが権限を持たないアプリロールを指定すると、エラーが発生します。

---

## Request Body
- **Schema**: `multipart/form-data`

### `onError`
- **Type**: string
- **Default**: `"rollback"`
- **Enum**: `"rollback"` | `"ignore"`

#### 説明:  
一括登録中にレコードに関して以下のエラーが発生した場合の処理方法を指定します。  
- フィールドタイプに合わない値が存在する場合。
- 入力必須のフィールドに値がない場合。


### APIリファレンス

#### エラーハンドリング

- **重複不可のフィールドに重複する値がある場合**
  - `"rollback"`: 全てのレコードの登録処理を中止。
  - `"ignore"`: 重複対象のレコードをスキップし、正常なレコードのみ登録。

---

#### パラメーター

- **file**  
  - 必須: `true`  
  - 型: `string <binary>`  
  - 説明: インポートファイル。以下の条件を満たす必要がある。
    - ファイル拡張子: `.tsv` または `.csv`
    - 文字コード: `UTF-8`
    - ファイルサイズ: `100MB以下`
    - ファイルにヘッダ行を付け、1行目にフィールドの識別名を記述。
    - **対象外**: ヘッダ行にファイル型フィールドの識別名が含まれていない。
    - ファイル名に以下の文字が含まれていない: `\`、`/`、`:`、`*`、`?`、`"`、`<`、`>`、`|`
    
---

#### レスポンス

###### **成功時 (201)**
- レコードの一括登録依頼が成功。

##### **Response Headers**
- **X-Spiral-App-Role**  
  - 型: `string`  
  - 例: `"employee"`  
  - 説明: アプリロール。

##### **Response Schema**
- **id**  
  - 型: `string`  
  - 説明: 一括登録の依頼ID。
  
- **operatedFrom**  
  - 型: `string`  
  - 値 (Enum): `"ui"` | `"api"`  
  - 説明: 操作元。

- **status**  
  - 型: `string`  
  - 値: `"waiting"`  
  - 説明: レスポンスステータス。

- **errors**  
  - 型: `Array of objects`  
  - 説明: エラー情報。
### APIリファレンス

#### パラメータ

- **onError**  
  **Type**: string  
  **Enum**: "rollback", "ignore"  
  一括登録中にレコードに関するエラーが発生した場合の処理の扱い。

- **fileName**  
  **Type**: string  
  インポートファイル名。

- **fileSize**  
  **Type**: integer  
  インポートファイルサイズ（byte単位）。

- **numberRows**  
  **Type**: integer  
  インポートファイルの全行数。

- **numberRowsSuccessful**  
  **Type**: integer  
  登録に成功した行数。

- **numberRowsFailed**  
  **Type**: integer  
  登録に失敗した行数。

- **rowsFailed**  
  **Type**: string  
  登録に失敗したレコード行番号（カンマ区切り）。

- **createdAt**  
  **Type**: string (`<date-time>`)  
  作成日時。

- **finishedAt**  
  **Type**: string (`<date-time>`)  
  一括登録完了日時。  
  **備考**: ステータスが "canceled" になった場合に出力される。

---

### ステータスコード

- **403**  
  アプリの利用権限がない（または不足している）。

---

### Response Headers

- **X-Spiral-App-Role**  
  **Type**: string  
  **例**: "employee"  
  アプリロールを示す。

---

### Request サンプル

- **形式**: CSV, TSV  
- **Payload**:

```
name,email,phone,gender,age,birthday,mailGroup,registration,lastAccess
山田 太郎,taro.yamada@example.com,+81 90-1234-5678,1,30,01-01,"1,2",2020-01-01,2020-01-01T00:00:00Z
田中 次郎,jiro.tanaka@example.com,090-1234-5678,1,25,1-1,3,2020-1-1,2020-01-01T12:00:00+09:00
```
# API Reference

## User Information
| Name        | Email                          | Phone       | App ID | DB ID | BatchInsertID | Extra Info | Created At        | Finished At |
|-------------|--------------------------------|-------------|--------|-------|---------------|------------|-------------------|-------------|
| 鈴木 花子    | hanako.suzuki@example.com      | 9012345678  | 2      | 20    | 12-20         |            | 2020-12-20        | 2020-12-30T12:00:00Z |

---

## Response Sample

### Status Code
- 201

### Content Type
- application/json

### Example Response
```json
{
  "id": "100",
  "operatedFrom": "ui",
  "status": "waiting",
  "errors": [
    {
      "code": "string",
      "message": "string",
      "locationType": "string",
      "location": "string",
      "row": 0,
      "column": 0
    }
  ],
  "onError": "rollback",
  "fileName": "content.csv",
  "fileSize": 104857600,
  "numberRows": 100,
  "numberRowsSuccessful": 100,
  "numberRowsFailed": 100,
  "rowsFailed": "1,3,4",
  "createdAt": "2019-08-24T14:15:22Z",
  "finishedAt": "2019-08-24T14:15:22Z"
}
```

---

## Functionality
### Description
Retrieve batch record registration request from the specified database.

---

## Endpoints
1. **Production Environment**  
   `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/batchInserts/{batchInsertId}`  

2. **Beta Environment**  
   `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/batchInserts/{batchInsertId}`  

---

## Path Parameters
| Parameter          | Required | Type   | Description        |
|---------------------|----------|--------|--------------------|
| app                | Yes      | string | App ID             |
| db                 | Yes      | string | Database ID        |
| batchInsertId      | Yes      | string | Batch Insert ID    |

---

## Header Parameters
| Parameter           | Type   | Default Value | Example   | Description          |
|---------------------|--------|---------------|-----------|----------------------|
| X-Spiral-App-Role  | string | _fullAccess    | employee  | Application role     |

---
## API リファレンス

### 概要
- **ヘッダーの指定が省略された場合**  
  「全権限」のアプリロールが指定されたものとしてAPIが実行される。
- **アプリロールの権限エラー**  
  リクエストしたユーザー・APIエージェントが権限を持たないアプリロールを指定した場合はエラーを返す。

---

### レスポンス

#### **200 OK**
指定された一括登録依頼の情報を返します。

#### **Response Headers**
- **X-Spiral-App-Role**  
  **Type:** string  
  **Example:** `"employee"`  
  アプリロールを示します。

#### **Response Schema**
- **Content Type:** `application/json`

| フィールド               | 型                | 説明                                           |
|--------------------------|-------------------|----------------------------------------------|
| `id`                     | string           | 一括登録依頼ID                              |
| `operatedFrom`           | string (Enum)    | 操作元。以下の値のいずれか:                  |
|                          |                  | - `"ui"`                                     |
|                          |                  | - `"api"`                                    |
| `status`                 | string (Enum)    | ステータス。以下の値のいずれか:              |
|                          |                  | - `"waiting"`                                |
|                          |                  | - `"processing"`                             |
|                          |                  | - `"canceling"`                              |
|                          |                  | - `"succeeded"`                              |
|                          |                  | - `"failed"`                                 |
|                          |                  | - `"canceled"`                               |
| `errors`                 | Array of objects | エラー情報。ステータスが`"failed"`のときに出力されます。 |
| - **`onError`**          | string (Enum)    | 一括登録中にレコードに関するエラーが発生した場合の処理の扱い。以下の値のいずれか: |
|                          |                  | - `"rollback"`                               |
|                          |                  | - `"ignore"`                                 |
| - **`fileName`**         | string           | インポートファイル名                        |
| - **`fileSize`**         | integer          | インポートファイルサイズ (バイト単位)         |
| - **`numberRows`**       | integer          | インポートファイルの全行数                  |
| ステータスが`"processing"`の時に出力:                         |
| - **`numberRowsSuccessful`** | integer      | 登録に成功した行数                          |

```
### 出力対象情報

#### 1. 登録失敗情報
- **numberRowsFailed** (integer)  
  登録に失敗した行数  
  *ステータスが "processing" 後に "succeeded" または "failed" または "canceled" になった時に出力される。*

- **rowsFailed** (string)  
  登録に失敗したレコード行の番号（カンマ区切り）  
  *ステータスが "processing" 後に "succeeded" または "failed" または "canceled" になった時に出力される。*

#### 2. 作成および完了日時
- **createdAt** (string) <date-time>  
  作成日時

- **finishedAt** (string) <date-time>  
  一括登録完了日時  
  *ステータスが "succeeded" または "failed" または "canceled" になった時に出力される。*

---

### エラー情報

#### ステータスコード
- **403 Forbidden**  
  アプリの利用権限がない（または不足している）。

#### Response Headers
- **X-Spiral-App-Role** (string)  
  アプリロール  
  *例: "employee"*
```
### APIリファレンス: レコード一括登録依頼をキャンセル

#### 概要
レコードの一括登録依頼をキャンセルします。この操作は、`status` が `"waiting"` または `"processing"` の場合に有効です。

---

### エンドポイント

#### 本番環境
```
https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/batchInserts/{batchInsertId}/cancel
```

#### ベータ環境
```
https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/batchInserts/{batchInsertId}/cancel
```

---

### パスパラメータ (Path Parameters)

| パラメータ名    | 必須 | 型       | 説明                |
|------------------|------|----------|---------------------|
| `app`           | 必須 | `string` | アプリID            |
| `db`            | 必須 | `string` | DB ID               |
| `batchInsertId` | 必須 | `string` | 一括登録依頼ID      |

---

### ヘッダーパラメータ (Header Parameters)

| パラメータ名            | 型       | デフォルト値     | 例          | 説明          |
|--------------------------|----------|------------------|-------------|---------------|
| `X-Spiral-App-Role`      | `string` | `_fullAccess`    | `employee`  | アプリロール  |

---

### サンプルレスポンス

#### レスポンスコード: 200  
**Content Type:** `application/json`

```json
{
  "id": "100",
  "operatedFrom": "ui",
  "status": "waiting",
  "errors": [
    {
      "code": "string",
      "message": "string",
      "locationType": "string",
      "location": "string",
      "row": 0,
      "column": 0
    }
  ],
  "onError": "rollback",
  "fileName": "content.csv",
  "fileSize": 104857600,
  "numberRows": 100,
  "numberRowsSuccessful": 100,
  "numberRowsFailed": 100,
  "rowsFailed": "1,3,4",
  "createdAt": "2019-08-24T14:15:22Z",
  "finishedAt": "2019-08-24T14:15:22Z"
}
```
### APIリファレンス

---

#### ヘッダー指定について
- ヘッダーが省略された場合、デフォルトで「全権限」のアプリロールが指定されたものとしてAPIが実行されます。
- リクエストしたユーザやAPIエージェントが権限を持たないアプリロールを指定された場合、エラーが発生します。

---

### Responses

#### `201 Created`
**説明**: キャンセルされた一括登録依頼。

##### Response Headers
- **`X-Spiral-App-Role`**:  
  - **型**: string  
  - **説明**: アプリロール  
  - **例**: `"employee"`

##### Response Schema（`application/json`）
- **`id`**:  
  - **型**: string  
  - **説明**: 一括登録依頼のID  

- **`operatedFrom`**:  
  - **型**: string  
  - **Enum**: `"ui"`, `"api"`  
  - **説明**: 操作元  

- **`status`**:  
  - **型**: string  
  - **Enum**: `"canceling"`, `"canceled"`  
  - **説明**: ステータス  

- **`errors`**:  
  - **型**: Array of objects  
  - **説明**: エラー情報  

- **`onError`**:  
  - **型**: string  
  - **Enum**: `"rollback"`, `"ignore"`  
  - **説明**: 一括登録中にレコードのエラーが発生した場合の処理の扱い  

- **`fileName`**:  
  - **型**: string  
  - **説明**: インポートファイル名  

- **`fileSize`**:  
  - **型**: integer  
  - **説明**: インポートファイルのサイズ（バイト）  

- **`numberRows`**:  
  - **型**: integer  
  - **説明**: インポートファイルの全行数  

- **`numberRowsSuccessful`**:  
  - **型**: integer  
  - **説明**: 登録に成功した行数  

- **`numberRowsFailed`**:  
  - **型**: integer  
  - **説明**: 登録に失敗した行数  

- **`rowsFailed`**:  
  - **型**: string  
  - **説明**: 登録に失敗したレコード行の番号（カンマ区切り）  

- **`createdAt`**:  
  - **型**: string  
  - **フォーマット**: `<date-time>`  
  - **説明**: 作成日時  
### API Reference

#### 一括登録完了日時 (finishedAt)
- **Type:** string (<date-time>)
- **Description:** 一括登録完了日時。ステータスが"canceled"になった時に出力される。

---

### HTTP Responses
#### 403 Forbidden
- **Condition:** アプリの利用権限がない（または不足している）。

**Response Headers**:
- **Header:** `X-Spiral-App-Role`
  - **Type:** string
  - **Example:** `"employee"` （アプリロール）

**Response Sample**:
- **HTTP Status**: 201
- **Content Type:** application/json

```json
{
  "id": "100",
  "operatedFrom": "ui",
  "status": "canceling",
  "errors": [
    {
      "code": "string",
      "message": "string",
      "locationType": "string",
      "location": "string",
      "row": 0,
      "column": 0
    }
  ],
  "onError": "rollback",
  "fileName": "content.csv",
  "fileSize": 104857600,
  "numberRows": 100,
  "numberRowsSuccessful": 100,
  "numberRowsFailed": 100,
  "rowsFailed": "1,3,4",
  "createdAt": "2019-08-24T14:15:22Z",
  "finishedAt": "2019-08-24T14:15:22Z"
}
```

---

### レコード一括更新依頼一覧を取得 API

- **Endpoint:**  
  **Production:**  
  `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/batchUpdates`  
  **Beta:**  
  `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/batchUpdates`  

- **Description:** 指定されたDBに対する一括更新依頼の一覧を取得。

---

#### Path Parameters
1. **app**
   - **Required:** Yes
   - **Type:** string
   - **Description:** アプリID

2. **db**
   - **Required:** Yes
   - **Type:** string
   - **Description:** DBID
### API リファレンス構造化

#### Query Parameters

1. **upsert**  
   - **Type**: boolean  
   - **Description**:  
     - `true`の場合、一括登録更新依頼を取得する  
     - `false`の場合、一括更新依頼を取得する  
     - 未指定の場合、両方取得する  

2. **sort**  
   - **Type**: string  
   - **Default**: `"createdAt:desc"`  
   - **Enum**:  
     - `"id:asc"`  
     - `"id:desc"`  
     - `"status:asc"`  
     - `"status:desc"`  
     - `"createdAt:asc"`  
     - `"createdAt:desc"`  
     - `"finishedAt:asc"`  
     - `"finishedAt:desc"`  
   - **Description**:  
     ソートする対象（ID、ステータス、作成日時、終了日時）  
     - `":asc"`を指定すると昇順  
     - `":desc"`を指定すると降順  
     ステータスを指定した場合、処理が遷移する順番となる  

3. **offset**  
   - **Type**: integer  
   - **Example**: `offset=20`  
   - **Description**: リストのオフセット  

4. **limit**  
   - **Type**: integer  
   - **Range**: `[1 .. 200]`  
   - **Default**: `20`  
   - **Example**: `limit=20`  
   - **Description**: リストの上限  

---

#### Header Parameters

1. **X-Spiral-App-Role**  
   - **Type**: string  
   - **Default**: `_fullAccess`  
   - **Example**: `employee`  
   - **Description**:  
     ヘッダーの指定を省略した場合、「全権限」のアプリロールが指定されたものとしてAPIが実行される。  
     リクエストしたユーザ・APIエージェントが権限を持たないアプリロールを指定された場合はエラーとなる。  

---

#### Responses

1. **200**  
   - **Description**: 指定した一括更新依頼
## Response Headers

### X-Spiral-App-Role
- **Type:** string  
- **Example:** `"employee"`  
  - アプリロール

---

## Response Schema: `application/json`

- **items**: `Array` of `objects`
  - **prevOffset**: `integer`
    - 前のリストのオフセット。前のリストが存在しない場合は `null`
  - **nextOffset**: `integer`
    - 次のリストのオフセット。次のリストが存在しない場合は `null`
  - **totalCount**: `integer`
    - 検索結果の全件数

---

## HTTP ステータスコード

- **403**: アプリの利用権限がない（または不足している）

---

## Response Headers (403 状態の場合)

### X-Spiral-App-Role
- **Type:** string  
- **Example:** `"employee"`  
  - アプリロール

---

## Response Samples

### ステータスコード: 200  
**Content Type**: `application/json`

```json
{
  "items": [
    {
      "id": "100",
      "operatedFrom": "ui",
      "upsert": false,
      "updateKeyField": "_id",
      "status": "waiting",
      "errors": [
        {
          "code": "string",
          "message": "string",
          "locationType": "string",
          "location": "string",
          "type": "update",
          "row": 0,
          "column": 0
        }
      ],
      "fileName": "content.csv",
      "fileSize": 104857600,
      "numberRows": 100,
      "numberRowsInsertSuccessful": 100,
      "numberRowsInsertFailed": 100,
      "numberRowsUpdateSuccessful": 100,
      "numberRowsUpdateFailed": 100,
      "rowsFailed": "1,3,4",
      "createdAt": "2019-08-24T14:15:22Z",
      "finishedAt": "2019-08-24T14:15:22Z"
    }
  ],
  "prevOffset": 0,
  "nextOffset": 40,
  "totalCount": 200
}
```

---

## 機能概要

### レコード一括更新依頼を作成
- **HTTP メソッド:** POST  
- **エンドポイント:** `/apps/{app}/dbs/{db}/records/batchUpdates`  
- **API 構成:** SPIRAL ver.2 API サーバ (本番環境)
## APIリファレンス: レコードの一括更新依頼作成

### エンドポイント
#### 本番環境
```
https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/batchUpdates
```

#### ベータ環境
```
https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/batchUpdates
```

### 機能
- 指定されたリクエストに基づき、レコードの一括更新処理を行う依頼を作成します。
- **upsert** オプションを指定することで、更新後に新しいレコードを登録することも可能です。

### データ形式
- **Multipart/form-data形式** でリクエストを送信します。

### 制約事項
1. **同一データベース(DB)上での制限:**
   - 一括登録、一括更新、一括削除が進行中の場合、新しい依頼を行うことはできません。
   
2. **対象外のフィールドタイプ:**
   - **パスワード型フィールド**
   - **ファイル型フィールド**
   - **ユーザフィールド**
   - 上記フィールドタイプがインポートファイルのヘッダー行に含まれている場合、エラーとなります。

3. **エラー時のロールバック:**
   - 更新中に以下のエラーが発生した場合、すべてのレコードの更新処理がロールバックされます。
     - フィールドタイプに合わない値が存在する場合。
     - 入力必須のフィールドに値がない場合。
     - 重複不可のフィールドで、重複する値が存在する場合。
# API リファレンス

## Path Parameters
- **app** (required, string):  
  アプリIDを指定するパラメータ。

- **db** (required, string):  
  DBIDを指定するパラメータ。

---

## Header Parameters
- **X-Spiral-App-Role** (string):  
  デフォルト値: `_fullAccess`  
  例: `employee`  
  アプリロールを指定するヘッダー。  
  - ヘッダーを指定しない場合、`全権限` のアプリロールが指定されたものとしてAPIが実行されます。
  - リクエストしたユーザやAPIエージェントが権限を持たないアプリロールを指定した場合、エラーとなります。

---

## Request Body
- **Schema:** `multipart/form-data`

  ### Parameters:
  - **upsert** (boolean):  
    デフォルト値: `false`  
    一括登録更新を行うためのフラグ。  
    - `true`: DBのレコードに存在するデータを更新し、存在しないデータを新規登録します。  
    - `false`: 更新のみで新規登録は行いません。

  - **updateKeyField** (string):  
    デフォルト値: `_id`  
    更新キーを指定するフィールド。  
    - このフィールドは「入力必須」「重複不可」の条件を満たす必要があります。  
    - テキスト型またはメールアドレス型のフィールドが指定可能です。それ以外のタイプを指定するとエラーになります。

  - **file** (required, string):  
    必須。バイナリ形式のインポートファイル。  
    ファイルの条件:
    - 拡張子は `tsv` または `csv` である必要があります。
**ファイル要件**  
- ファイル名に以下の文字が含まれていないこと: `\`, `/`, `:`, `*`, `?`, `"`, `<`, `>`, `|`
- 文字コード: UTF-8  
- ファイルサイズ: 100MB以下  
- ファイルにヘッダ行が含まれる  
- ヘッダ行にフィールドの識別名が指定されている  
- データベース（DB）に更新キーフィールドが存在しない状況で利用される  
- 更新キーフィールド名がファイルに含まれない  
- ファイル型フィールドは対象外とされ、ヘッダ行にファイル型フィールドの識別名が指定されていない  

---

**Responses: 201 レコードの一括更新依頼**  

- **Response Headers**  
  - **X-Spiral-App-Role**: `string`  
    - 例: `"employee"` アプリロール  

- **Response Schema: application/json**  
  - **id**: `string`  
    - 一括更新依頼ID  
  - **operatedFrom**: `string`  
    - Enum: `"ui"`, `"api"`  
    - 操作元  
  - **upsert**: `boolean`  
    - 登録処理の有無  
  - **updateKeyField**: `string`  
    - 更新対象キーフィールド  
  - **status**: `string`  
    - 値: `"waiting"`  
    - ステータス  
  - **errors**: `Array of objects`  
    - エラー情報  
  - **fileName**: `string`  
    - インポートファイル名  
  - **fileSize**: `integer`  
    - インポートファイルサイズ（バイト単位）  
  - **numberRows**: `integer`  
    - インポートファイルの全行数  
  - **numberRowsInsertSuccessful**: `integer`  
    - 登録に成功した行数  
  - **numberRowsInsertFailed**: `integer`  
    - 登録に失敗した行数  
### APIリファレンス

---

#### パラメータ

- **numberRowsUpdateSuccessful**  
  **Type**: integer  
  **Description**: 更新に成功した行数

- **numberRowsUpdateFailed**  
  **Type**: integer  
  **Description**: 更新に失敗した行数

- **rowsFailed**  
  **Type**: string  
  **Description**: 登録・更新に失敗した行

- **createdAt**  
  **Type**: string (ISO 8601 `<date-time>`)  
  **Description**: 作成日時

- **finishedAt**  
  **Type**: string (ISO 8601 `<date-time>`)  
  **Description**: 一括更新完了日時  
  **Note**: ステータスが "canceled" になった時に出力される

---

#### ステータスコード

- **403 Forbidden**  
  **Description**: アプリの利用権限がない（または不足している）

---

#### レスポンスヘッダ

- **X-Spiral-App-Role**  
  **Type**: string  
  **Example**: `"employee"`  
  **Description**: アプリロール

---

#### サンプルリクエスト

- **データフォーマット**: CSV / TSV

**Payload例**:
```
_id,name,email,phone,gender,age,birthday,mailGroup,registration,lastAccess
1,山田 太郎,taro.yamada@example.com,+81 90-1234-5678,1,30,01-01,"1,2",2020-01-01,2020-01-01T00:00:00Z
2,田中 次郎,jiro.tanaka@example.com,090-1234-5678,1,25,1-1,3,2020-1-1,2020-01-01T12:00:00+09:00
3,鈴木 花子,hanako.suzuki@example.com,9012345678,2,20,12-20,,2020-12-20,2020-12-30T12:00:00Z
``` 
## API Reference: レコード一括更新依頼を取得

### Endpoint
- **本番環境**  
  `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/batchUpdates/{batchUpdateId}`
- **ベータ環境**  
  `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/batchUpdates/{batchUpdateId}`

### 機能概要
指定されたデータベースの一括更新依頼情報を取得します。

---

### Path Parameters
| Name            | Required | Type    | Description            |
|-----------------|----------|---------|------------------------|
| `app`          | required | string  | アプリID               |
| `db`           | required | string  | DBID                   |
| `batchUpdateId`| required | string  | 一括更新依頼ID         |

---

### Header Parameters
| Name                  | Type    | Default       | Example    | Description          |
|-----------------------|---------|---------------|------------|----------------------|
| `X-Spiral-App-Role`  | string  | `_fullAccess` | `employee` | アプリロール         |

---

### Response Samples
**HTTP 201**  
**Content-Type:** `application/json`

```json
{
  "id": "100",
  "operatedFrom": "ui",
  "upsert": false,
  "updateKeyField": "_id",
  "status": "waiting",
  "errors": [
    {
      "code": "string",
      "message": "string",
      "locationType": "string",
      "location": "string",
      "type": "update",
      "row": 0,
      "column": 0
    }
  ],
  "fileName": "content.csv",
  "fileSize": 104857600,
  "numberRows": 100,
  "numberRowsInsertSuccessful": 100,
  "numberRowsInsertFailed": 100,
  "numberRowsUpdateSuccessful": 100,
  "numberRowsUpdateFailed": 100,
  "rowsFailed": "1,3,4",
  "createdAt": "2019-08-24T14:15:22Z",
  "finishedAt": "2019-08-24T14:15:22Z"
}
```

#### Response Fields
| Field                          | Type    | Description                                      |
|--------------------------------|---------|--------------------------------------------------|
| `id`                          | string  | 一括更新依頼ID                                   |
| `operatedFrom`                | string  | 操作元（例: "ui"）                               |
| `upsert`                      | boolean | 挿入/更新の試行フラグ                           |
| `updateKeyField`              | string  | 更新のキーとなるフィールド                      |
| `status`                      | string  | 現在のステータス (例: "waiting")                |
| `errors`                      | array   | エラー情報                                       |
| `errors[].code`               | string  | エラーコード                                     |
| `errors[].message`            | string  | エラーメッセージ                                 |
| `errors[].locationType`       | string  | エラーの発生箇所タイプ                          |
| `errors[].location`           | string  | エラー発生場所                                   |
| `errors[].type`               | string  | エラー種別 (例: "update")                       |
| `errors[].row`                | number  | エラーが発生した行番号                           |
| `errors[].column`             | number  | エラーが発生した列番号                           |
| `fileName`                    | string  | ファイル名                                       |
| `fileSize`                    | number  | ファイルサイズ（バイト単位）                    |
| `numberRows`                  | number  | 全行数                                           |
| `numberRowsInsertSuccessful`  | number  | 挿入が成功した行数                               |
| `numberRowsInsertFailed`      | number  | 挿入が失敗した行数                               |
| `numberRowsUpdateSuccessful`  | number  | 更新が成功した行数                               |
| `numberRowsUpdateFailed`      | number  | 更新が失敗した行数                               |
| `rowsFailed`                  | string  | 失敗した行番号のリスト (例: "1,3,4")            |
| `createdAt`                   | string  | レコードの作成日時 (ISO 8601形式)               |
| `finishedAt`                  | string  | レコードの処理終了日時 (ISO 8601形式)           |
### APIリファレンス

#### **説明**
- ヘッダーの指定を省略した場合、「全権限」のアプリロールが指定されたものとしてAPIが実行されます。
- リクエストしたユーザやAPIエージェントが権限を持たないアプリロールを指定した場合、エラーが発生します。

---

### **Responses**

#### **200: 指定した一括更新依頼**

#### Response Headers
- **X-Spiral-App-Role**: `string`  
  Example: `"employee"`（アプリロール）

---

#### Response Schema
Content-Type: application/json

##### フィールド一覧
- **id**: `string`  
  一括更新依頼ID

- **operatedFrom**: `string`  
  操作元  
  Enum: `"ui"`, `"api"`

- **upsert**: `boolean`  
  登録処理の有無

- **updateKeyField**: `string`  
  更新対象キーフィールド

- **status**: `string`  
  ステータス  
  Enum: `"waiting"`, `"processing"`, `"canceling"`, `"succeeded"`, `"failed"`, `"canceled"`

- **errors**: `Array of objects`  
  エラー情報（ステータスが`"failed"`の場合に出力）

  - **fileName**: `string`  
    インポートファイル名

  - **fileSize**: `integer`  
    インポートファイルサイズ（byte）

  - **numberRows**: `integer`  
    インポートファイルの全行数

- **numberRowsInsertSuccessful**: `integer`  
  登録に成功した行数（ステータスが`"processing"`の場合に出力）

- **numberRowsInsertFailed**: `integer`  
  登録に失敗した行数（ステータスが`"processing"`の場合に出力）

- **numberRowsUpdateSuccessful**: `integer`  
  更新に成功した行数（ステータスが`"processing"`の場合に出力）
### API リファレンス構造

---

#### フィールド
- **`numberRowsUpdateFailed`**  
  - **型**: `integer`  
  - **説明**: 更新に失敗した行数  

- **`rowsFailed`**  
  - **型**: `string`  
  - **説明**: 登録・更新に失敗した行  

- **`createdAt`**  
  - **型**: `string (<date-time>)`  
  - **説明**: 作成日時  

- **`finishedAt`**  
  - **型**: `string (<date-time>)`  
  - **説明**: 一括更新完了日時  
  - **補足**: ステータスが `"succeeded"`, `"failed"`, `"canceled"` になった時に出力される  

---

#### ステータスコード
- **403**  
  - **説明**: アプリの利用権限がない（または不足している）  

---

#### レスポンスヘッダー
- **`X-Spiral-App-Role`**  
  - **型**: `string`  
  - **例**: `"employee"`  
  - **説明**: アプリロール  

---

#### レスポンスサンプル
**HTTP ステータスコード**: `200`  
**Content-Type**: `application/json`  

**レスポンス例**:  
```json
{
  "id": "100",
  "operatedFrom": "ui",
  "upsert": false,
  "updateKeyField": "_id",
  "status": "waiting",
  "errors": [
    {
      "code": "string",
      "message": "string",
      "locationType": "string",
      "location": "string",
      "type": "update",
      "row": 0,
      "column": 0
    }
  ],
  "fileName": "content.csv",
  "fileSize": 104857600,
  "numberRows": 100,
  "numberRowsInsertSuccessful": 100,
  "numberRowsInsertFailed": 100,
  "numberRowsUpdateSuccessful": 100,
  "numberRowsUpdateFailed": 100,
  "rowsFailed": "1,3,4",
  "createdAt": "2019-08-24T14:15:22Z",
  "finishedAt": "2019-08-24T14:15:22Z"
}
```

---

#### エンドポイント: レコード一括更新依頼をキャンセル
- **メソッド**: `POST`  
- **パス**: `/apps/{app}/dbs/{db}/records/batchUpdates/{batchUpdateId}/cancel`  

---

#### 備考
- **SPIRAL ver.2 API サーバ** (本番環境)  
- **APIエンドポイント**  
  - 本番環境: `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/batchUpdates/{batchUpdateId}/cancel`  
  - ベータ環境: `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/batchUpdates/{batchUpdateId}/cancel`  

- **概要**  
  レコードの一括更新依頼をキャンセルするためのAPI。  
  キャンセルが有効となるのは `status` が `"waiting"` または `"processing"` の時。

---

### **Path Parameters**
| パラメータ        | 必須   | 種別   | 意味        |
|------------------|-------|-------|------------|
| `app`           | 必須   | string | アプリID    |
| `db`            | 必須   | string | DB ID       |
| `batchUpdateId` | 必須   | string | 一括更新依頼ID |

---

### **Header Parameters**
| パラメータ            | 種別   | デフォルト値      | 例              | 説明                                                                                                 |
|---------------------|-------|---------------|----------------|----------------------------------------------------------------------------------------------------|
| `X-Spiral-App-Role` | string | `_fullAccess` | `employee`     | アプリロール。デフォルト値が使用され、リクエストされたユーザやAPIエージェントが権限を持たない場合はエラーとなる。  

---

### **レスポンス**

#### **HTTPステータスコード**  
- **201**: キャンセルした一括更新依頼が正常に返される。

#### **Response Headers**
| ヘッダー                   | 種別   | 例          | 説明        |
|-------------------------|-------|------------|------------|
| `X-Spiral-App-Role`    | string | `"employee"` | アプリロール |

#### **Response スキーマ**
| フィールド名         | 種別         | 内容                               |
|------------------|------------|----------------------------------|
| `id`             | string     | 一括更新依頼ID                     |
| `operatedFrom`   | string Enum| 操作元: `"ui"` または `"api"`         |
| `upsert`         | boolean    | 登録処理の有無                      |
| `updateKeyField` | string     | 更新対象キーフィールド                 |
```
APIリファレンス

- **status**  
  **Type**: string  
  **Enum**: `"canceling"`, `"canceled"`  
  **Description**: ステータス  

- **errors**  
  **Type**: Array of objects  
  **Description**: エラー情報  

- **fileName**  
  **Type**: string  
  **Description**: インポートファイル名  

- **fileSize**  
  **Type**: integer  
  **Description**: インポートファイルサイズ (byte)  

- **numberRows**  
  **Type**: integer  
  **Description**: インポートファイルの全行数  

- **numberRowsInsertSuccessful**  
  **Type**: integer  
  **Description**: 登録に成功した行数  

- **numberRowsInsertFailed**  
  **Type**: integer  
  **Description**: 登録に失敗した行数  

- **numberRowsUpdateSuccessful**  
  **Type**: integer  
  **Description**: 更新に成功した行数  

- **numberRowsUpdateFailed**  
  **Type**: integer  
  **Description**: 更新に失敗した行数  

- **rowsFailed**  
  **Type**: string  
  **Description**: 登録・更新に失敗した行  

- **createdAt**  
  **Type**: string (`<date-time>`)  
  **Description**: 作成日時  

- **finishedAt**  
  **Type**: string (`<date-time>`)  
  **Description**: 一括更新完了日時  
  **Note**: ステータスが `"canceled"` になった時に出力される  

---

**エラーコード**  

- **403**  
  **Description**: アプリの利用権限がない（または不足している）  
  **Response Headers**:  
  - **X-Spiral-App-Role**  
    **Type**: string  
    **Example**: `"employee"`  
    **Description**: アプリロール
```
# API Reference: レコード一括削除依頼一覧を取得

## 概要
指定したDBの一括削除依頼の一覧を取得します。

---

## エンドポイント
### 本番環境
```
https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/batchDeletes
```

### ベータ環境
```
https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/batchDeletes
```

---

## パスパラメータ (Path Parameters)
| パラメータ名 | 必須 | 種類   | 説明          |
| ------------ | ---- | ------ | ------------- |
| `app`        | Yes  | string | アプリID      |
| `db`         | Yes  | string | DB ID         |

---

## クエリパラメータ (Query Parameters)
| パラメータ名 | 種類   | デフォルト値      | 選択可能な値                                                                                              | 説明                            |
| ------------ | ------ | ----------------- | --------------------------------------------------------------------------------------------------------- | ------------------------------- |
| `sort`       | string | `"createdAt:desc"` | `"id:asc"`, `"id:desc"`, `"status:asc"`, `"status:desc"`, `"createdAt:asc"`, `"createdAt:desc"`, `"finishedAt:asc"`, `"finishedAt:desc"` | ソートする対象 (ID、ステータス、作成日時、終了日時) |

---

## レスポンスサンプル
### ステータスコード: 201 (成功)
**Content Type:** `application/json`

```json
{
  "id": "100",
  "operatedFrom": "ui",
  "upsert": false,
  "updateKeyField": "string",
  "status": "canceling",
  "errors": [
    {
      "code": "string",
      "message": "string",
      "locationType": "string",
      "location": "string",
      "type": "update",
      "row": 0,
      "column": 0
    }
  ],
  "fileName": "content.csv",
  "fileSize": 104857600,
  "numberRows": 100,
  "numberRowsInsertSuccessful": 100,
  "numberRowsInsertFailed": 100,
  "numberRowsUpdateSuccessful": 100,
  "numberRowsUpdateFailed": 100,
  "rowsFailed": "1,3,4",
  "createdAt": "2019-08-24T14:15:22Z",
  "finishedAt": "2019-08-24T14:15:22Z"
}
```
### APIリファレンス構造化情報

---

#### **ソート指定**
- `:asc`  
  - 昇順
- `:desc`  
  - 降順  
  ステータスを指定した場合は処理が遷移する順番になります。

---

#### **パラメータ**

##### **クエリパラメータ**

1. **`offset` (integer)**  
   - 説明: リストのオフセット  
   - 例: `offset=20`

2. **`limit` (integer)**  
   - 説明: リストの上限  
   - 範囲: `[1 .. 200]`  
   - デフォルト値: `20`  
   - 例: `limit=20`

##### **ヘッダー（Header Parameters）**

1. **`X-Spiral-App-Role` (string)**  
   - デフォルト値: `_fullAccess`  
   - 説明: アプリのロール（権限レベル）を指定  
   - 例: `"employee"`  
   - **注意**:  
     1. ヘッダーの指定を省略した場合、「全権限」のアプリロールが指定されたものとしてAPIが実行されます。  
     2. リクエストしたユーザーまたはAPIエージェントがアプリロールの権限を持たない場合はエラーとなります。

---

#### **レスポンス**

##### **2xx (成功)**
- **`200`**  
  指定した一括削除依頼に対するレスポンス。

###### **レスポンスヘッダー**
- **`X-Spiral-App-Role` (string)**  
  - 説明: アプリロール  
  - 例: `"employee"`

###### **レスポンススキーマ（`application/json`）**

- **`items` (Array of objects)**  
  アイテムのリスト

- **`prevOffset` (integer)**  
  - 説明: 前のリストのオフセット  
  - 値: 前のリストが存在しない場合は`null`

- **`nextOffset` (integer)**  
  - 説明: 次のリストのオフセット  
  - 値: 次のリストが存在しない場合は`null`

- **`totalCount` (integer)**  
  - 説明: 検索結果の全件数

---

##### **エラー**

- **`403`**  
  - 説明: アプリの利用権限がない、または権限が不足している場合に発生します。
# API リファレンス

## 概要
**レコード一括削除依頼を作成**  
指定したDBにおいて、条件に合致するレコードを一括削除するためのAPIです。  
同一DB上でレコードの一括登録、一括更新、一括削除が処理中の場合、新たな依頼はできません。

---

## リクエスト情報

### HTTP メソッド  
**POST**

### エンドポイント
- **本番環境:**  
  `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/batchDeletes`
- **ベータ環境:**  
  `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/batchDeletes`

---

## パスパラメータ (Path Parameters)

| パラメータ名 | 必須 | 型 | 説明           |
|--------------|------|----|----------------|
| `app`        | 必須 | string | アプリID       |
| `db`         | 必須 | string | DB ID         |

---

## ヘッダーパラメータ (Header Parameters)

| パラメータ名           | 型     | デフォルト       | 例           | 説明         |
|------------------------|--------|------------------|--------------|--------------|
| `X-Spiral-App-Role`    | string | `_fullAccess`    | `employee`   | アプリロール |

---

## レスポンス情報

### レスポンスヘッダー

| ヘッダー名               | 型     | 例        | 説明       |
|--------------------------|--------|-----------|------------|
| `X-Spiral-App-Role`      | string | "employee"| アプリロール |

---

### 成功時レスポンスサンプル (`200 OK`)

**Content-Type:** `application/json`  

```json
{
  "items": [
    {
      "id": "100",
      "operatedFrom": "ui",
      "status": "waiting",
      "errors": [
        {
          "code": "string",
          "message": "string",
          "locationType": "string",
          "location": "string"
        }
      ],
      "where": "@age >= 30 AND @name = 'yamada'",
      "numberRowsDeleted": 100,
      "createdAt": "2019-08-24T14:15:22Z",
      "finishedAt": "2019-08-24T14:15:22Z"
    }
  ],
  "prevOffset": 0,
  "nextOffset": 40,
  "totalCount": 200
}
```

#### 各フィールドの説明

| フィールド名            | 型        | 説明                                                                       |
|-------------------------|-----------|----------------------------------------------------------------------------|
| `items`                 | array     | 操作された項目のリスト                                                        |
| `id`                    | string    | 操作の一意ID                                                               |
| `operatedFrom`          | string    | 操作が行われた箇所 (例: "ui")                                               |
| `status`                | string    | ステータス (`waiting`, `success`, `error` など)                              |
| `errors`                | array     | 発生したエラーに関する詳細情報リスト                                          |
| `errors[].code`         | string    | エラーコード                                                                |
| `errors[].message`      | string    | エラーメッセージ                                                            |
| `errors[].locationType` | string    | エラーが発生した箇所のタイプ                                                |
| `errors[].location`     | string    | エラーが発生した具体的な場所                                                |
| `where`                 | string    | 削除条件 (例: `@age >= 30 AND @name = 'yamada'`)                           |
| `numberRowsDeleted`     | integer   | 削除されたレコード数                                                        |
| `createdAt`             | timestamp | 操作要求が作成された時刻 (ISO8601形式)                                       |
| `finishedAt`            | timestamp | 操作が完了した時刻 (ISO8601形式)                                            |
| `prevOffset`            | integer   | 前のオフセット                                                              |
| `nextOffset`            | integer   | 次のオフセット                                                              |
| `totalCount`            | integer   | 処理対象となった項目の総数                                                  |

---

## 注意事項

- 別の操作 (一括登録、一括更新、一括削除) が同一DBで進行中の場合、このAPIで操作を開始することはできません。
# APIリファレンス構造化

## 概要
- **ヘッダーの指定を省略した場合**: 「全権限」のアプリロールが指定されたものとしてAPIが実行される。
- リクエストしたユーザーまたはAPIエージェントが権限を持たないアプリロールを指定された場合はエラーとなる。

---

## Request

- **Body Schema**: `application/json`
  - **wherestring**: 抽出条件式  
    - **備考**: 条件未設定の場合は、条件なしとして扱う。

---

## Responses

### **201**  
- **概要**: レコードの一括削除が依頼された場合のレスポンス。

#### **Response Headers**
- `X-Spiral-App-Role`: `string`  
  - **例**: `"employee"`  
    - アプリロールを表す。

#### **Response Schema**: `application/json`
- `id`: `string`  
  - 一括削除依頼ID。
- `operatedFrom`: `string`  
  - **Enum**: `"ui"` | `"api"`  
    - 操作元の情報。
- `status`: `string`  
  - **Value**: `"waiting"`  
    - ステータスの値。
- `errors`: `Array of objects`  
  - エラー情報。
- `where`: `string`  
  - 抽出条件式。
- `numberRowsDeleted`: `integer`  
  - 削除した行数。
- `createdAt`: `string` (フォーマット: `<date-time>`)  
  - 作成日時。
- `finishedAt`: `string` (フォーマット: `<date-time>`)  
  - 一括削除完了日時。

---

### **403**  
- **概要**: アプリの利用権限がない、または権限が不足している場合のエラーレスポンス。

#### **Response Headers**
- `X-Spiral-App-Role`: `string`  
  - **例**: `"employee"`  
    - アプリロールを表す。
### APIリファレンス: レコード一括削除依頼を取得

---

#### エンドポイント概要
指定されたアプリおよびDBに対応する一括削除依頼を取得します。

#### エンドポイント (本番環境)
```
https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/batchDeletes/{batchDeleteId}
```

#### エンドポイント (ベータ環境)
```
https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/batchDeletes/{batchDeleteId}
```

---

### パラメーター

#### **Path Parameters**
| 名前           | 必須   | 型      | 説明                  |
|----------------|--------|---------|-----------------------|
| `app`          | 必須   | string  | アプリID              |
| `db`           | 必須   | string  | DB ID                |
| `batchDeleteId`| 必須   | string  | 一括削除依頼ID        |

#### **Header Parameters**
| 名前                  | 型      | デフォルト値  | 例                 | 説明            |
|-----------------------|---------|--------------|--------------------|-----------------|
| `X-Spiral-App-Role`   | string  | `_fullAccess`| `employee`         | アプリロール     |

---

### リクエストサンプル

#### Content-Type
```
application/json
```

#### Payload
```json
{
  "where": "@age >= 30 AND @name = 'yamada'"
}
```

---

### レスポンス

#### ステータスコード
**201**

#### Content-Type
```
application/json
```

#### レスポンスボディ
```json
{
  "id": "100",
  "operatedFrom": "ui",
  "status": "waiting",
  "errors": [
    {
      "code": "string",
      "message": "string",
      "locationType": "string",
      "location": "string"
    }
  ],
  "where": "@age >= 30 AND @name = 'yamada'",
  "numberRowsDeleted": 100,
  "createdAt": "2019-08-24T14:15:22Z",
  "finishedAt": "2019-08-24T14:15:22Z"
}
```

---

### 説明

- **`id`**: 一括削除依頼のID。
- **`operatedFrom`**: 削除依頼を発行した方法（例: `ui`）。
- **`status`**: 処理の状態（例: `waiting`）。
- **`errors`**: エラーが存在する場合の詳細情報。
  - **`code`**: エラーコード。
  - **`message`**: エラーメッセージ。
  - **`locationType`**: エラーが発生した場所のタイプ。
  - **`location`**: エラーの具体的な位置。
- **`where`**: 削除条件を表すSQL形式のクエリ。
- **`numberRowsDeleted`**: 削除された行数。
- **`createdAt`**: 一括削除依頼の作成日時 (ISO 8601形式)。
- **`finishedAt`**: 一括削除依頼の完了日時 (ISO 8601形式)。
### API リファレンス

#### 概要
- ヘッダーの指定を省略した場合、「全権限」のアプリロールが指定されたものとしてAPIが実行されます。
- リクエストしたユーザ・APIエージェントが権限を持たないアプリロールを指定された場合、エラーとなります。

---

### Responses

#### 200 OK
指定した一括削除依頼のレスポンス情報。

##### Response Headers
- **X-Spiral-App-Role** (string)  
  指定されたアプリロール  
  **例:** `"employee"`

##### Response Schema: `application/json`
| フィールド名            | 型                     | 説明                                                                                          |
|-------------------------|------------------------|---------------------------------------------------------------------------------------------|
| `id`                   | string                | 一括削除依頼ID                                                                             |
| `operatedFrom`         | string (Enum: `"ui"`, `"api"`) | 操作元                                                                                      |
| `status`               | string (Enum: `"waiting"`, `"processing"`, `"canceling"`, `"succeeded"`, `"failed"`, `"canceled"`) | ステータス                                                                                  |
| `errors`               | Array of objects      | エラー情報（ステータスが `"failed"` になった場合に出力）                                      |
| `where`                | string                | 抽出条件式                                                                                  |
| `numberRowsDeleted`    | integer               | 削除した行数（ステータスが `"succeeded"`, `"failed"`, `"canceled"` の場合に出力）            |
| `createdAt`            | string (<date-time>)  | 作成日時                                                                                    |
| `finishedAt`           | string (<date-time>)  | 一括削除完了日時（ステータスが `"succeeded"`, `"failed"`, `"canceled"` の場合に出力）        |

---

#### 403 Forbidden
- アプリの利用権限がない（または権限が不足している）場合に発生します。
# API Reference: レコード一括削除依頼をキャンセル

## 概要
このエンドポイントは、レコードの一括削除依頼をキャンセルするためのAPIです。この操作は、削除リクエストのステータスが `waiting` または `processing` の場合にのみ有効です。

---

## エンドポイント

### 本番環境
```
https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/records/batchDeletes/{batchDeleteId}/cancel
```

### ベータ環境
```
https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/records/batchDeletes/{batchDeleteId}/cancel
```

---

## パラメータ

### Path Parameters
| パラメータ名      | 必須  | 型      | 説明                 |
|------------------|-------|---------|----------------------|
| `app`            | 必須  | string  | アプリID             |
| `db`             | 必須  | string  | データベースID       |
| `batchDeleteId`  | 必須  | string  | 一括削除依頼ID       |

---

### Header Parameters
| パラメータ名               | 型      | デフォルト値   | 例             | 説明         |
|---------------------------|---------|----------------|----------------|--------------|
| `X-Spiral-App-Role`       | string  | `_fullAccess`  | `employee`      | アプリロール |

---

## レスポンス

### Response Headers
| パラメータ名                | 型      | 値の例        | 説明         |
|----------------------------|---------|---------------|--------------|
| `X-Spiral-App-Role`        | string  | `"employee"`  | アプリロール |

---

### Response Samples

#### HTTP ステータスコード: 200  
**Content-Type:** `application/json`

```json
{
    "id": "100",
    "operatedFrom": "ui",
    "status": "waiting",
    "errors": [
        {
            "code": "string",
            "message": "string",
            "locationType": "string",
            "location": "string"
        }
    ],
    "where": "@age >= 30 AND @name = 'yamada'",
    "numberRowsDeleted": 100,
    "createdAt": "2019-08-24T14:15:22Z",
    "finishedAt": "2019-08-24T14:15:22Z"
}
```

**説明:**
- このレスポンスは、成功時のサンプルを示しています。
- レスポンスには、操作履歴やエラー情報、クエリ条件、削除されたレコード数、作成日時と完了日時などが含まれます。
```
# APIリファレンス構造

## ヘッダーの仕様
- ヘッダーの指定を省略した場合、「全権限」のアプリロールが指定されたものとしてAPIが実行されます。
- リクエストしたユーザまたはAPIエージェントが権限を持たないアプリロールを指定した場合、エラーとなります。

---

## レスポンス詳細

### 201 - キャンセルした一括削除依頼
- **Response Headers**
  - `X-Spiral-App-Role` (string)  
    Example: `"employee"`  
    アプリロール

- **Response Schema** (`application/json`)
  - `id` (string): 一括削除依頼ID
  - `operatedFrom` (string): 操作元  
    **Enum**: `"ui"`, `"api"`
  - `status` (string): ステータス  
    **Enum**: `"canceling"`, `"canceled"`
  - `errors` (Array of objects): エラー情報
  - `where` (string): 抽出条件式
  - `numberRowsDeleted` (integer): 削除した行数  
    *ステータスが`"canceled"`になった時に出力される*
  - `createdAt` (string, `<date-time>`): 作成日時
  - `finishedAt` (string, `<date-time>`): 一括削除完了日時  
    *ステータスが`"canceled"`になった時に出力される*

---

### 403 - アプリの利用権限がない（または不足している）
- **Response Headers**
  - `X-Spiral-App-Role` (string)  
    Example: `"employee"`  
    アプリロール
```
### API Reference

---

#### Response Sample

**Status:** `201 Content`

**Content-Type:** `application/json`

```json
{
  "id": "100",
  "operatedFrom": "ui",
  "status": "canceling",
  "errors": [
    {
      "code": "string",
      "message": "string",
      "locationType": "string",
      "location": "string"
    }
  ],
  "where": "@age >= 30 AND @name = 'yamada'",
  "numberRowsDeleted": 100,
  "createdAt": "2019-08-24T14:15:22Z",
  "finishedAt": "2019-08-24T14:15:22Z"
}
```

---

### Record File

#### File Upload Token Issuance API

##### Endpoint for Live Server:
`https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/{field}/files/uploadToken`

##### Endpoint for Beta Environment:
`https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/{field}/files/uploadToken`

##### Functionality:
This API is used to generate a file upload token that is necessary when uploading a file to a file-type field of a record.

- **Token Limit:** A maximum of 3 tokens can be issued per account.
- **Error Condition:** If there are already 3 active tokens, the system will return an error.
- **Token Expiry:**
  - Tokens are automatically deleted after:
    - **3 minutes** have passed since issuance.
    - The token has been used to upload a file.

---

#### Path Parameters

| Parameter | Required | Type   | Description           |
|-----------|----------|--------|-----------------------|
| `app`     | Yes      | string | Application ID        |
| `db`      | Yes      | string | Database ID           |
| `field`   | Yes      | string | Field ID of the record|

---
```
APIリファレンス

### Parameters

#### Header Parameters
- **X-Spiral-App-Role**: `string`  
  - Default: `_fullAccess`  
  - Example: `employee`  
  - 説明: アプリロールを指定します。ヘッダーの指定を省略した場合、デフォルトで「全権限」のアプリロールとしてAPIが実行されます。リクエストしたユーザまたはAPIエージェントが権限を持たないアプリロールを指定した場合はエラーとなります。

---

### Responses

#### 201 - ファイルアップロードトークンを発行
- **Response Headers**
  - **X-Spiral-App-Role**: `string`  
    - Example: `"employee"`  
    - 説明: アプリロール

- **Response Schema**: `application/json`
  - **fileUploadToken**: `string`  
    - 説明: ファイルアップロードトークン
  - **expireAt**: `string` (`<date-time>`)  
    - 説明: ファイルアップロードトークンの期限切れ日時（例: `2019-07-17T01:51:04Z`）。期限切れ日時になるとトークンは自動で削除されます。

#### 403 - アプリの利用権限がない（または不足している）
- **Response Headers**
  - **X-Spiral-App-Role**: `string`  
    - Example: `"employee"`  
    - 説明: アプリロール

---

### Response Samples

- **201 - Success**
  - **Content-Type**: `application/json`
  - **Sample Data:**
    ```json
    {
      "fileUploadToken": "a0eebc999c0b4ef8bb6d6bb9bd380a11",
      "expireAt": "2019-07-17T01:51:04Z"
    }
    ```

---

### API Endpoint: ファイルをアップロード

#### HTTP Method
- POST

#### Endpoint
- `/apps/{app}/dbs/{db}/{field}/files`

#### 環境
- **SPIRAL ver.2 APIサーバ（本番環境）**
```
```
# API リファレンス: ファイルアップロード

## エンドポイント
### 本番環境
`https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/{field}/files`

### ベータ環境
`https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/{field}/files`

## 機能
レコードのファイル型フィールドに対して、事前に取得したトークンを用いてファイルをアップロードします。このエンドポイントは `Multipart/form-data` 形式で動作します。ファイルをアップロードした後、取得したファイルキーを使用してレコードとファイルを関連付けることが可能です。

- アップロードしたファイルはアカウントのファイルストレージ容量にカウントされます。
- レコードに関連付けられていないファイルは、アップロード後1時間で自動削除されます。

---

## パラメーター

### Path Parameters
| 名前   | 必須 | 型     | 説明         |
|--------|------|--------|--------------|
| `app`  | 必須 | string | アプリID     |
| `db`   | 必須 | string | DB ID        |
| `field`| 必須 | string | フィールドID |

---

### Header Parameters
| 名前                      | 型     | デフォルト値     | 説明                                                                 |
|---------------------------|--------|-------------------|----------------------------------------------------------------------|
| `X-Spiral-App-Role`       | string | `_fullAccess`     | アプリロール。例: `employee`                                        |

#### 補足
1. ヘッダーを省略した場合、サーバはデフォルトで「全権限（_fullAccess）」のアプリロールとしてAPIを実行します。
2. リクエストを行うユーザーまたはAPIエージェントに指定されたアプリロールの権限が無い場合は、エラーとなります。
```
### API Reference

#### Request Body Schema: `multipart/form-data`

| Field Name         | Type     | Required | Description                                                                                                  |
|--------------------|----------|----------|--------------------------------------------------------------------------------------------------------------|
| `file`            | string   | Yes      | バイナリ形式のファイル。                                                                                     |
|                    |          |          | - ファイル名に次の記号が含まれている場合エラー: `\`, `/`, `:`, `*`, `?`, `"`, `<`, `>`, `|`                     |
|                    |          |          | - ファイル型フィールドの入力制限を満たしていない場合エラー                                                    |
| `fileUploadToken` | string   | Yes      | ファイルアップロードトークン。                                                                               |
|                    |          |          | - トークンの有効期限が切れている場合エラー                                                                    |

---

#### Responses

##### Status Code: `201` - アップロードしたファイル

- **Response Headers**:
  | Header Name               | Type   | Description                    |
  |---------------------------|--------|--------------------------------|
  | `X-Spiral-App-Role`       | string | アプリロール (例: `"employee"`)|

- **Response Schema**: `application/json`

  | Field Name      | Type        | Description                                                                 |
  |-----------------|-------------|-----------------------------------------------------------------------------|
  | `fileKey`       | string      | ファイルキー。フォーマットは`シーケンシャルID_ファイルハッシュ値`                                               |
  | `fileName`      | string      | ファイル名                                                                  |
  | `fileSize`      | integer     | ファイルサイズ（バイト単位）                                                |
  | `createdBy`     | object      | 登録者                                                                      |
  | `createdAt`     | string      | 登録日時 (`<date-time>`形式)                                                |
  | `expireAt`      | string/null | ファイルの期限切れ日時 (`<date-time>`形式)。<br>期限切れになるとファイルは自動削除。レコード関連付け時は`null`。|

---

##### Status Code: `403` - アプリの利用権限がない（または不足している）

- **Response Headers**:
  | Header Name               | Type   | Description                    |
  |---------------------------|--------|--------------------------------|
  | `X-Spiral-App-Role`       | string | アプリロール (例: `"employee"`)|

---

#### Request Samples

**Payload (Content type: `multipart/form-data`)**:

```
----WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="sample.png"
Content-Type: image/png
```

# API Reference Documentation

## File Upload

### Request
#### Endpoint
```
/file/upload
```

#### Method
`POST`

#### Form Parameters
- **file**: File content goes here.
- **fileUploadToken**: A unique string token required for uploading a file.  
  *Example:* `a0eebc999c0b4ef8bb6d6bb9bd380a11`

#### Headers
The file upload request contains a multipart form-data body, where the boundary (e.g. `------WebKitFormBoundary7MA4YWxkTrZu0gW`) separates the file and token data.

---

### Response

#### Status
**201 Created**

#### Content Type
`application/json`

#### Response Body
```json
{
  "fileKey": "100_196a921286f74e15cd307dc42f1df4523b3e25808659789631092b458d57676e",
  "fileName": "sample.png",
  "fileSize": 2345,
  "createdBy": {
    "type": "user"
  },
  "createdAt": "2019-07-17T00:51:04Z",
  "expireAt": "2019-07-17T01:51:04Z"
}
```

---

## File Download

### Request
#### Endpoint
```
/apps/{app}/dbs/{db}/{field}/{recordId}/files/{fileKey}/download
```

#### Method
`GET`

#### Path Parameters
- **{app}**: Application ID  
- **{db}**: Database ID  
- **{field}**: Field ID  
- **{recordId}**: Record ID  
- **{fileKey}**: Unique file key assigned upon upload  

#### Server URLs
- **Production Server:**  
  `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/{field}/{recordId}/files/{fileKey}/download`
- **Beta Server:**  
  `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/{field}/{recordId}/files/{fileKey}/download`

---

This reference covers file upload and file download functionalities with specific endpoints, required parameters, and expected responses for integration within SPIRAL ver.2 API Server.
# API Reference: Download File from File-Type Field  

## Endpoint  
**URL**:  
`https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/{field}/{recordId}/files/{fileKey}/download`  

**Description**:  
This API downloads files that are registered in a file-type field of a record.  
- The `fileKey` can be retrieved from the file-type field response of the Record Fetch API.  
- Up to **3 concurrent downloads per account** are supported.  
- Attempting to download a file not associated with the file-type field results in an error.  

---

## Path Parameters  
| Parameter   | Required | Type   | Description       |
|-------------|----------|--------|-------------------|
| `app`       | Yes      | String | Application ID    |
| `db`        | Yes      | String | Database ID       |
| `field`     | Yes      | String | Field ID          |
| `recordId`  | Yes      | String | Record ID         |
| `fileKey`   | Yes      | String | File Key          |

---

## Header Parameters  

| Parameter               | Required | Type   | Default Value | Example      | Description                                                                                                   |
|-------------------------|----------|--------|---------------|--------------|---------------------------------------------------------------------------------------------------------------|
| `X-Spiral-App-Role`     | No       | String | `_fullAccess`  | `employee`   | Application role. If omitted, the API assumes the role with "full access". Specifying an invalid role results in an error. |

---

## Responses  

### 200 OK  
**Description**: The specified file is downloaded successfully.  

**Response Headers**:  
| Header                 | Type   | Example    | Description      |
|------------------------|--------|------------|------------------|
| `X-Spiral-App-Role`    | String | "employee" | Application role |

---

### 403 Forbidden  
**Description**: The request is rejected because the user or the API agent lacks the necessary permissions to use the application role.  
```
API Reference: EXPRESSメール設定一覧を取得

# 概要
EXPRESSメール設定一覧を取得します。

## エンドポイント
### 本番環境
- URL: `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/express/email`

### ベータ環境
- URL: `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/express/email`

---

## HTTP メソッド
- GET

---

## Path Parameters
| Parameter | 必須    | 型     | 説明    |
|-----------|---------|--------|---------|
| app       | required | string | アプリID |
| db        | required | string | DBID    |

---

## Query Parameters
| Parameter          | 型     | Enum 値                                                                                             | 説明                                                                                         |
|--------------------|--------|-----------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------|
| expressStatus      | string | `"setting"`, `"ready"`, `"closed"`                                                                 | 検索するEXPRESSメールのステータス                                                           |
| emailJobStatus     | string | `"spooling"`, `"failed"`, `"waiting"`, `"delivering"`, `"finished"`, `"forceCanceled"`, `"canceled"`| 検索するEXPRESSメールのメール配信ジョブのステータス。**本番メール配信ジョブのみが対象。**   |
| statusCategory     | string | `"settingStatus"`, `"deliveredStatus"`                                                             | `"settingStatus"` の場合: 設定中、予約完了、配信準備中、配信待機中のEXPRESSメールを取得する |

---

## Response Headers
| Header                  | 型      | 説明          |
|-------------------------|---------|---------------|
| X-Spiral-App-Role       | string  | アプリロール。例: `"employee"` |
```
### APIリファレンス: EXPRESSメールステータス取得

#### 機能概要
- "deliveredStatus"の場合のEXPRESSメールの一覧を取得します。
- ステータスには「配信中」「配信終了」「配信失敗」「強制配信中止」が含まれます。
- **注意点**: `expressStatus` および `emailJobStatus` パラメータとの併用はできません。

---

### パラメータ詳細

#### **クエリパラメータ**
| パラメータ名   | 型      | 説明                                                                                                   | 制約                                                   |
|----------------|---------|------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
| `subject`      | `string`| 検索するEXPRESSメールの件名のキーワード。部分一致による検索が可能です。                                    | 最大128バイト                                           |
| `sort`         | `string`| ソート基準設定。指定がなければデフォルト値`updatedAt:desc`が使用されます。                            | Enumに基づく。以下に詳細を記載。                        |
| `offset`       | `integer`| リストのオフセット値。                                             | 例: `offset=20`                                       |
| `limit`        | `integer`| リストの取得件数の上限。                                        | 範囲: 1 - 200<br>デフォルト値: `20`<br>例: `limit=20` |

##### **ソートオプション (sort パラメータ)**:
| 値                 | 説明                                             |
|--------------------|--------------------------------------------------|
| `startedAt:asc`    | 配信開始日時を昇順でソート                       |
| `startedAt:desc`   | 配信開始日時を降順でソート                       |
| `status:asc`       | ステータスを昇順でソート                         |
| `status:desc`      | ステータスを降順でソート                         |
| `updatedAt:asc`    | 更新日時を昇順でソート                           |
| `updatedAt:desc`   | 更新日時を降順でソート （デフォルト値）          |

---

#### **ヘッダーパラメータ**
| パラメータ名             | 型      | 説明                                                                                          | 制約                      |
|--------------------------|---------|---------------------------------------------------------------------------------------------|--------------------------|
| `X-Spiral-App-Role`      | `string`| APIリクエスト時に指定するアプリロール。デフォルト値は`_fullAccess`です。                     | ユーザー/APIエージェントが指定されたロールの権限を持つ必要があります。<br>権限を持たない場合はエラーが返されます。 |

---

### レスポンス
| ステータスコード | 内容                                      |
|------------------|-------------------------------------------|
| `200`            | 取得したEXPRESSメール設定の一覧を返します。 |

---

### その他
- **デフォルト値**: `sort`のデフォルトは`updatedAt:desc`、`limit`のデフォルトは`20`です。
- ヘッダーの`X-Spiral-App-Role`を省略すると、自動的に「全権限」（`_fullAccess`）のアプリロールが適用されます。
```
# API Reference

## Response Headers

- **X-Spiral-App-Role** (string)  
  - **Example**: `"employee"`  
    アプリのロール。

---

## Response Schema

- **Content Type**: `application/json`

### Items (Array of objects)
Expressメール設定の一覧。

#### Properties:
- **prevOffset** (integer)  
  - 説明: 前のリストのオフセット。前のリストが存在しない場合は`null`。
  
- **nextOffset** (integer)  
  - 説明: 次のリストのオフセット。次のリストが存在しない場合は`null`。
  
- **totalCount** (integer)  
  - 説明: 検索結果の全件数。

---

## HTTP Status Codes

- **403**  
  アプリの利用権限がない（または不足している）。

---

## Additional Notes

- **Response Headers**
  - **X-Spiral-App-Role** (string)  
    アプリロール。  
    **Example**: `"employee"`
```
## APIリファレンス - EXPRESSメール設定を作成

### 概要
EXPRESSメール設定を作成するためのAPIエンドポイントです。

### エンドポイント
- **本番環境:**  
  `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/express/email`
  
- **ベータ環境:**  
  `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/express/email`

---

### パスパラメーター

| パラメーター名 | 必須 | 型      | 説明         |
|----------------|------|---------|--------------|
| app            | Yes  | string  | アプリID      |
| db             | Yes  | string  | データベースID |

---

### ヘッダーパラメーター

| パラメーター名        | 型     | デフォルト値    | 例                | 説明           |
|-----------------------|--------|----------------|-------------------|----------------|
| X-Spiral-App-Role     | string | `_fullAccess`  | `employee`        | アプリロール     |

---

### レスポンスサンプル

**ステータスコード:** 200  
**Content Type:** `application/json`

```json
{
  "items": [
    {
      "excludeErrorCount": 1,
      "exists": {
        "type": "exists",
        "dbId": "100",
        "fieldId": "100"
      },
      "from": {
        "displayName": "事務局",
        "email": "from@mail.example.com",
        "emailFromDomainId": 100
      },
      "replyTo": "reply@example.com",
      "subject": {
        "content": "メール件名テスト"
      },
      "contentsTimeZone": "Asia/Tokyo",
      "timing": "scheduled",
      "scheduleDate": "2017-01-01T12:00:00Z",
      "status": "setting",
      "emailJob": {
        "id": "100",
        "status": "finished",
        "deliveredCount": "10",
        "errorCount": "2",
        "startedAt": "2019-08-24T14:15:22Z",
        "requiredTime": "3600"
      },
      "createdBy": {
        "type": "user",
        "userId": "100"
      },
      "updatedBy": {
        "type": "user",
        "userId": "100"
      },
      "createdAt": "2019-08-24T14:15:22Z",
      "updatedAt": "2019-08-24T14:15:22Z"
    }
  ],
  "prevOffset": 0,
  "nextOffset": 40,
  "totalCount": 200
}
```

---

### フィールドの詳細

#### items

| フィールド名             | 型       | 説明                                                                 |
|--------------------------|----------|----------------------------------------------------------------------|
| excludeErrorCount        | integer  | 除外されたエラー数                                                    |
| exists                   | object   | 存在チェック情報                                                     |
| exists.type              | string   | 存在のタイプ（例: `exists`）                                          |
| exists.dbId              | string   | 対象のデータベースID                                                 |
| exists.fieldId           | string   | 対象のフィールドID                                                   |
| from                     | object   | 送信者情報                                                           |
| from.displayName         | string   | 送信者表示名                                                         |
| from.email               | string   | 送信者メールアドレス                                                 |
| from.emailFromDomainId   | integer  | 送信者のドメインID                                                   |
| replyTo                  | string   | 返信先メールアドレス                                                 |
| subject                  | object   | 件名情報                                                             |
| subject.content          | string   | メール件名                                                           |
| contentsTimeZone         | string   | タイムゾーン（例: `Asia/Tokyo`）                                     |
| timing                   | string   | 配信タイミング（例: `scheduled`）                                    |
| scheduleDate             | string   | 配信予定日時（ISO 8601形式）                                         |
| status                   | string   | ステータス（例: `setting`）                                          |
| emailJob                 | object   | メールジョブ情報                                                     |
| emailJob.id              | string   | メールジョブID                                                       |
| emailJob.status          | string   | メールジョブステータス（例: `finished`）                             |
| emailJob.deliveredCount  | string   | 配信済み件数                                                         |
| emailJob.errorCount      | string   | 配信エラー件数                                                       |
| emailJob.startedAt       | string   | ジョブ開始日時（ISO 8601形式）                                       |
| emailJob.requiredTime    | string   | ジョブに必要な時間（秒）                                             |
| createdBy                | object   | 作成者情報                                                           |
| createdBy.type           | string   | 作成者のタイプ（例: `user`）                                         |
| createdBy.userId         | string   | 作成者のユーザーID                                                   |
| updatedBy                | object   | 更新者情報                                                           |
| updatedBy.type           | string   | 更新者のタイプ（例: `user`）                                         |
| updatedBy.userId         | string   | 更新者のユーザーID                                                   |
| createdAt                | string   | 作成日時（ISO 8601形式）                                             |
| updatedAt                | string   | 更新日時（ISO 8601形式）                                             |

#### その他

| フィールド名 | 型       | 説明               |
|--------------|----------|--------------------|
| prevOffset   | integer  | 前回のオフセット値 |
| nextOffset   | integer  | 次回のオフセット値 |
| totalCount   | integer  | 合計件数           |
### APIリファレンス

---

#### **概要**
- ヘッダー指定を省略した場合、APIは「全権限」のアプリロールが指定されたものとして実行されます。
- リクエストしたユーザーまたはAPIエージェントに権限がないアプリロールが指定された場合、エラーとなります。

---

#### **Request Body Schema**
- **Content Type**: `application/json`

##### **フィールド構成**
1. **`to` (required)**  
   - **型**: `object`  
   - **概要**: 宛先設定

2. **`excludeErrorCount`**  
   - **型**: `integer`  
   - **制限**: 値の範囲は `1` から `3`  
   - **デフォルト値**: `1`  
   - **概要**: 配信エラー除外の対象とするエラーの発生回数

3. **`exists`**  
   - **型**: `object`  
   - **概要**: 他のデータベースにおけるメールアドレスの有無による抽出  
   - **注意**: `null` の場合は抽出を行いません。

4. **`from` (required)**  
   - **型**: `object`  
   - **概要**: 差出人設定

5. **`replyTo`**  
   - **型**: `string`  
   - **制限**: 文字数は `5` から `256` まで  
   - **概要**: 返信先設定  
   - **使用例**: 任意のメールアドレスを指定する

6. **`subject` (required)**  
   - **型**: `object`  
   - **概要**: 件名設定

7. **`plainBody`**  
   - **型**: `object`  
   - **概要**: プレーンテキストメールの本文

8. **`htmlBody`**  
   - **型**: `object`  
   - **概要**: HTMLメールの本文

   **注意**: `plainBody` と `htmlBody` のうち、少なくともどちらか1つは必須です。

9. **`contentsTimeZone`**  
   - **型**: `string`  
   - **デフォルト値**: `"UTC"`  
   - **概要**: タイムゾーン情報  
     - 対象: タイムゾーンを扱う日時フィールド。
     - 使用例: 作成日時、最終更新日時を差替えキーワードとして件名または本文に含める場合、このタイムゾーンを指定します。

---
### APIリファレンス

#### タイムゾーン
- タイムゾーンの一覧はサポートサイトをご確認ください。

---

### パラメータ

#### `timing`
- **必須**: はい
- **型**: `string`
- **Enum**: `"scheduled"`, `"now"`
- **説明**: 配信タイミングを選択
  - `scheduled`: 予約配信
  - `now`: 即時配信

#### `scheduleDate`
- **型**: `string`（`<date-time>`形式）
- **説明**: 予約日時
  - 指定可能な日時の条件:
    - 現在時刻から10分経過後かつ2年以内
    - 毎時00分から5分刻みで指定可能
  - `timing`が`scheduled`の場合: **必須**
  - `timing`が`now`の場合: 指定するとエラー

#### `status`
- **型**: `string`
- **デフォルト**: `"setting"`
- **Enum**: `"setting"`, `"ready"`
- **説明**: ステータス選択
  - `setting`: 設定中
  - `ready`: 設定完了
    - `timing`が`now`の場合: 配信が開始される
    - `timing`が`scheduled`の場合: 待機状態になる

---

#### 注意事項
- `ready`を指定した場合、以下のバリデーションが行われる:
  - `from`に設定した送信ドメインの認証
    - ドメイン設定が存在しない、または利用不可の場合、エラーが発生します。
### APIリファレンス

---

#### スケジュール情報
- **予約日時**
  - `timing` が `scheduled` の場合のみ指定可能。
  - `scheduleDate` に指定可能な範囲外の日時を指定するとエラーが発生。

---

#### レスポンス

##### **201 Created**  
予約されたEXPRESSメール設定が作成された場合。

###### **Response Headers**
- **X-Spiral-App-Role**: *(string)* アプリロール  
  - 例: `"employee"`

###### **Response Schema**
Content-Type: `application/json`

- **id**: *(string)*  
  EXPRESSメールID
- **to**: *(object)*  
  宛先設定
- **excludeErrorCount**: *(integer)*  
  除外対象とするエラーの発生回数
- **exists**: *(object)*  
  他DBのメールアドレスの有無で抽出。`null` の場合は抽出しない。
- **from**: *(object)*  
  差出人設定
- **replyTo**: *(string)*  
  返信先設定（任意のメールアドレスを指定する）
- **subject**: *(object)*  
  件名
- **plainBody**: *(object)*  
  プレーンテキストメールの本文
- **htmlBody**: *(object)*  
  HTMLメールの本文
- **contentsTimeZone**: *(string)* デフォルト: `"UTC"`  
  - タイムゾーンを扱う日時フィールド、作成日時、最終更新日時などの差替えキーワードを件名か本文に含める場合に、差替え時のタイムゾーンを指定。  
  - タイムゾーンの一覧はサポートサイトを参照。
- **timing**: *(string)* 配信タイミング選択  
  - Enum: `"scheduled"` / `"now"`
### APIリファレンス構造化

#### 配信タイミング設定
- **timing**:  
  配信タイミングを選択します。以下のいずれかを指定可能です。  
  - `scheduled`（予約配信）  
  - `now`（即時配信）  

- **scheduleDate**:  
  - **型**: `string`（<date-time>）  
  - **説明**: 予約日時を指定します。  
  - **指定可能な範囲**:  
    - 現在時刻から10分後以上かつ2年以内。  
    - 毎時00分から5分刻みで指定可能。  
  - **条件**:  
    - `timing`が`scheduled`の場合は必須。  
    - `timing`が`now`の場合に指定するとエラー。

---

#### 配信ステータス
- **status**:  
  - **型**: `string`  
  - **Enum**: `"setting"`, `"ready"`, `"closed"`  
  - **説明**: EXPRESSメール配信設定のステータス。

---

#### その他プロパティ
- **emailJob**:  
  - **型**: `object`  
  - **説明**: メール配信実行情報。本番配信が開始されるまでは`null`。  

- **createdBy**:  
  - **型**: `object`  
  - **説明**: 作成者を示します。  

- **updatedBy**:  
  - **型**: `object`  
  - **説明**: 更新者を示します。更新がないレコードの場合、`createdBy`と同じ。  

- **createdAt**:  
  - **型**: `string`（<date-time>）  
  - **説明**: 作成日時。  

- **updatedAt**:  
  - **型**: `string`（<date-time>）  
  - **説明**: 更新日時。更新がないレコードの場合、`createdAt`と同じ。  

---

#### エラーレスポンス
- **403 Forbidden**:  
  - **説明**: アプリの利用権限がない、または権限が不足している場合のエラー。  

  - **Response Headers**:  
    - **X-Spiral-App-Role**:  
      - **型**: `string`  
      - **例**: `"employee"`  
      - **説明**: アプリロールを示します。  
### API リファレンス - 構造化された内容

#### Request Samples
- **PayloadContent Type**: `application/json`

#### Sample Payload

```json
{
  "to": {
    "field": "100",
    "where": {
      "type": "simple",
      "value": {
        "operator": "or",
        "conditions": [
          {
            "field": "@email",
            "operator": "domain_is",
            "value1": "example.com"
          },
          {
            "field": "@email",
            "operator": "domain_is",
            "value1": "example.net"
          }
        ]
      }
    }
  },
  "excludeErrorCount": 1,
  "exists": {
    "type": "exists",
    "db": "string",
    "field": "100"
  },
  "from": {
    "displayName": "メルマガ事務局",
    "emailLocalPart": "info",
    "emailFromDomainId": 100
  },
  "replyTo": "reply@example.com",
  "subject": {
    "content": "メール件名テスト"
  },
  "plainBody": {
    "content": "{{@customerMst.nickname}}様\\nプレーンテキストメールの本文テスト\\n{{@_url."
  }
}
```
```json
{
  "urls": [
    {
      "name": "CC_001",
      "url": "https://example.com/page1"
    },
    {
      "name": "CC_002",
      "url": "https://example.com/page2"
    }
  ],
  "clickCount": {
    "duplication": false,
    "parameter": "appId={{@_app.id}}&dbId={{@_db.id}}",
    "siteId": "1",
    "urls": [
      {
        "name": "CC_001",
        "url": "https://example.com/page1"
      },
      {
        "name": "CC_002",
        "url": "https://example.com/page2"
      }
    ]
  },
  "clickLogin": [
    {
      "validPeriod": {
        "period": 7
      },
      "keyword": "{{@_url.cl.mysite.top/register}}"
    }
  ],
  "htmlBody": {
    "content": "<p>{{@customerMst.nickname}}様</p><p>HTMLメールの本文テスト</p><a href=\"{{@_url.CC_001}}\">URL Link1</a>"
  }
}
```
```json
{
  "URL_Links": [
    {
      "name": "CC_001",
      "url": "https://example.com/page1"
    },
    {
      "name": "CC_002",
      "url": "https://example.com/page1"
    }
  ],
  "openCount": false,
  "clickCount": {
    "duplication": true,
    "parameter": "appId={{@_app.id}}&dbId={{@_db.id}}",
    "siteId": "1",
    "urls": [
      {
        "name": "CC_001",
        "url": "https://example.com/page1"
      },
      {
        "name": "CC_002",
        "url": "https://example.com/page1"
      }
    ]
  },
  "clickLogin": [
    {
      "validPeriod": {
        "period": 7
      },
      "keyword": "{{@_url.cl.mysite.top/register}}"
    }
  ],
  "contentsTimeZone": "Asia/Tokyo",
  "timing": "scheduled",
  "scheduleDate": "2017-01-01T12:00:00Z",
  "status": "setting"
}
```
```json
{
  "exists": {
    "type": "exists",
    "dbId": "100",
    "fieldId": "100"
  },
  "from": {
    "displayName": "事務局",
    "email": "from@mail.example.com",
    "emailFromDomainId": 100
  },
  "replyTo": "reply@example.com",
  "subject": {
    "content": "メール件名テスト"
  },
  "plainBody": {
    "content": "{{@customerMst.nickname}}様\nプレーンテキストメールの本文テスト\n{{@_url.CC_001}}\n{{@_url.CC_002}}",
    "clickCount": {
      "duplication": false,
      "parameter": "appId={{@_app.id}}&dbId={{@_db.id}}",
      "siteId": "1",
      "urls": [
        {
          "name": "CC_001",
          "url": "https://example."
        }
      ]
    }
  }
}
```
```json
{
  "urls": [
    {
      "name": "CC_001",
      "url": "https://example.com/page1"
    },
    {
      "name": "CC_002",
      "url": "https://example.com/page2"
    }
  ],
  "clickLogin": {
    "validPeriod": {
      "timeUnit": "day",
      "period": 7
    },
    "keyword": "{{@_url.cl.mysite.top/register}}",
    "siteId": 301,
    "authenticationId": 401,
    "pageId": 501
  },
  "htmlBody": {
    "content": "<p>{{@customerMst.nickname}}様</p><p>HTMLメールの本文テスト</p><a href=\"{{@_url.CC_001}}\">URL Link1</a><a href=\"{{@_url.CC_002}}\">URL Link2</a>",
    "openCount": false,
    "clickCount": {
      "duplication": true,
      "parameter": "appId={{@_app.id}}&dbId={{@_db.id}}"
    }
  }
}
```
```json
{
  "siteId": "1",
  "urls": [
    {
      "name": "CC_001",
      "url": "https://example.com/page1"
    },
    {
      "name": "CC_002",
      "url": "https://example.com/page1"
    }
  ],
  "clickLogin": [
    {
      "validPeriod": {
        "timeUnit": "day",
        "period": 7
      },
      "keyword": "{{@_url.cl.mysite.top/register}}",
      "siteId": 301,
      "authenticationId": 401,
      "pageId": 501
    }
  ],
  "contentsTimeZone": "Asia/Tokyo",
  "timing": "scheduled",
  "scheduleDate": "2017-01-01T12:00:00Z",
  "status": "setting",
  "emailJob": {
    "id": "100",
    "status": "finished",
    "deliveredCount": "10",
    "errorCount": "2",
    "startedAt": "2019-08-24T14:15:22Z",
    "requiredTime": "3600"
  }
}
```
```yaml
API Documentation: Get EXPRESS Email Settings

- **Endpoint**:
  - **GET** `/apps/{app}/dbs/{db}/express/email/{expressEmailId}`

- **Description**:
  Retrieves the specified EXPRESS email settings.

- **Base URLs**:
  - **SPIRAL ver.2**: `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/express/email/{expressEmailId}`
  - **SPIRAL ver.2 API Server (Beta Environment)**: `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/express/email/{expressEmailId}`

---

### Path Parameters:
| Name            | Required | Type   | Description          |
|------------------|----------|--------|----------------------|
| `app`           | Yes      | string | App ID               |
| `db`            | Yes      | string | Database ID (DBID)   |
| `expressEmailId`| Yes      | string | EXPRESS Email ID     |

---

### Header Parameters:
| Name                  | Type    | Default Value | Example Value | Description                                                                                      |
|-----------------------|---------|---------------|----------------|--------------------------------------------------------------------------------------------------|
| `X-Spiral-App-Role`   | string  | `_fullAccess`  | `employee`     | App role. If omitted, the API assumes "full access". If an unauthorized app role is specified, an error will occur. |

---

### Responses:

- **200 OK**: Successfully retrieved the EXPRESS email settings.

#### **Response Headers**:
| Name                  | Type    | Example Value | Description     |
|-----------------------|---------|---------------|-----------------|
| `X-Spiral-App-Role`   | string  | `employee`    | App role used. |

#### **Response Schema**:
Content-Type: `application/json`

| Name         | Type   | Description     |
|--------------|--------|-----------------|
| `id`         | string | EXPRESS Email ID |
| `to`         | object | Destination settings |

---

### Metadata:
| Property   | Type   | Description                  |
|------------|--------|------------------------------|
| `createdBy`| object | Object describing the creator. |
| - `type`   | string | Type of creator (always "user"). |
| - `userId` | string | User ID of the creator.        |
| `updatedBy`| object | Object describing the updater. |
| - `type`   | string | Type of updater (always "user"). |
| - `userId` | string | User ID of the updater.        |
| `createdAt`| string | Timestamp of creation (`ISO 8601 format`). |
| `updatedAt`| string | Timestamp of the last update (`ISO 8601 format`). |
```
```markdown
## API Reference

### Parameters

#### excludeErrorCount
- **Type:** integer
- **Description:** 除外対象とするエラーの発生回数。

#### exists
- **Type:** object
- **Description:** 他DBのメールアドレスの有無による抽出。
- **Behavior:** `null` の場合、抽出を行わない。

#### from
- **Type:** object
- **Description:** 差出人設定。

#### replyTo
- **Type:** string
- **Description:** 返信先設定。
- **Additional Information:** 任意のメールアドレスを指定する。

#### subject
- **Type:** object
- **Description:** 件名。

#### plainBody
- **Type:** object
- **Description:** プレーンテキストメールの本文。

#### htmlBody
- **Type:** object
- **Description:** HTMLメールの本文。

#### contentsTimeZone
- **Type:** string
- **Default:** "UTC"
- **Description:**
  - タイムゾーンを扱う日時フィールド（作成日時、最終更新日時）の差替えキーワードを件名または本文に含める場合に、差替え時のタイムゾーンを指定する。
  - **Note:** タイムゾーンの一覧はサポートサイトをご確認ください。

#### timing
- **Type:** string
- **Enum:** "scheduled", "now"
- **Description:** 配信タイミングの選択。
  - `"scheduled"`: 予約配信。
  - `"now"`: 即時配信。

#### scheduleDate
- **Type:** string (`<date-time>`)
- **Description:** 予約日時。
- **Restrictions:**
  - 以下の範囲内で日時を指定可能。
    - 現在時刻から10分経過後かつ2年以内。
    - 毎時00分から5分刻みで指定。
```
### APIリファレンス

#### フィールド詳細

- **timing**  
  - **説明**:  
    - 値が`scheduled`の場合は必須。  
    - 値が`now`の場合に指定するとエラーとなる。  

- **status**  
  - **型**: string  
  - **Enum値**:  
    - `"setting"`  
    - `"ready"`  
    - `"closed"`  
  - **説明**: EXPRESSメール配信設定のステータス。  

- **emailJob**  
  - **型**: object  
  - **説明**: メール配信実行情報。  
    - 本番配信が開始されるまでは`null`となる。  

- **createdBy**  
  - **型**: object  
  - **説明**: 作成者情報。  

- **updatedBy**  
  - **型**: object  
  - **説明**: 更新者情報。  
    - 更新がないレコードの場合は`createdBy`と同じ値となる。  

- **createdAt**  
  - **型**: string `<date-time>`  
  - **説明**: 作成日時。  

- **updatedAt**  
  - **型**: string `<date-time>`  
  - **説明**: 更新日時。  
    - 更新がないレコードの場合は`createdAt`と同じ値となる。  

---

#### エラーレスポンス

- **403 Forbidden**  
  - **説明**: アプリの利用権限がない、または不足している場合に返される。  
  - **レスポンスヘッダー**:  
    - **`X-Spiral-App-Role`**  
      - **型**: string  
      - **例**: `"employee"`  
      - **説明**: アプリのロール情報。  
```
Response Samples:

Status Code: 200

Content Type: application/json

Response Body:
{
  "excludeErrorCount": 1,
  "exists": {
    "type": "exists",
    "dbId": "100",
    "fieldId": "100"
  },
  "from": {
    "displayName": "事務局",
    "email": "from@mail.example.com",
    "emailFromDomainId": 100
  },
  "replyTo": "reply@example.com",
  "subject": {
    "content": "メール件名テスト"
  },
  "plainBody": {
    "content": "{{@customerMst.nickname}}様\\nプレーンテキストメールの本文テスト\\n{{@_url.CC_001}}\\n{{@_url.CC_002}}",
    "clickCount": {
      "duplication": false,
      "parameter": "appId={{@_app.id}}&dbId={{@_db.id}}",
      "siteId": null
    }
  }
}
```
```json
{
  "urls": [
    {
      "name": "CC_001",
      "url": "https://example.com/page1"
    },
    {
      "name": "CC_002",
      "url": "https://example.com/page2"
    }
  ],
  "clickLogin": [
    {
      "validPeriod": {
        "timeUnit": "day",
        "period": 7
      },
      "keyword": "{{@_url.cl.mysite.top/register}}",
      "siteId": 301,
      "authenticationId": 401,
      "pageId": 501
    }
  ],
  "htmlBody": {
    "content": "<p>{{@customerMst.nickname}}様</p><p>HTMLメールの本文テスト</p><a href=\"{{@_url.CC_001}}\">URL Link1</a><a href=\"{{@_url.CC_002}}\">URL Link2</a>",
    "openCount": false,
    "clickCount": {
      "duplication": true,
      "parameter": null
    }
  }
}
```
```json
{
  "appId": "{{@_app.id}}",
  "dbId": "{{@_db.id}}",
  "siteId": "1",
  "urls": [
    {
      "name": "CC_001",
      "url": "https://example.com/page1"
    },
    {
      "name": "CC_002",
      "url": "https://example.com/page1"
    }
  ],
  "clickLogin": [
    {
      "validPeriod": {
        "timeUnit": "day",
        "period": 7
      },
      "keyword": "{{@_url.cl.mysite.top/register}}",
      "siteId": 301,
      "authenticationId": 401,
      "pageId": 501
    }
  ],
  "contentsTimeZone": "Asia/Tokyo",
  "timing": "scheduled",
  "scheduleDate": "2017-01-01T12:00:00Z",
  "status": "setting",
  "emailJob": {
    "id": "100",
    "status": "finished",
    "deliveredCount": "10",
    "errorCount": "2",
    "startedAt": ""
  }
}
```
```
API リファレンス: EXPRESSメール設定を更新

## 概要
指定されたEXPRESSメール設定を更新します。  
- ステータスが "setting" または "ready" 以外のものを指定するとエラーとなります。
- ステータスが "ready" の場合、status のみ変更可能。それ以外のパラメータは変更不可。

---

## エンドポイント
### 本番環境
```
PATCH https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/express/email/{expressEmailId}
```

### ベータ環境
```
PATCH https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/express/email/{expressEmailId}
```

---

## パラメータ

### Path Parameters
| パラメータ名       | 必須    | 型      | 説明             |
| ------------------ | ------- | ------- | ---------------- |
| `app`             | 必須    | string  | アプリID         |
| `db`              | 必須    | string  | DBID             |
| `expressEmailId`  | 必須    | string  | EXPRESSメールID  |

---

### Header Parameters
| パラメータ名          | 型        | デフォルト値      | 例               | 説明             |
| --------------------- | --------- | ---------------- | ---------------- | ---------------- |
| `X-Spiral-App-Role`  | string    | _fullAccess      | employee         | アプリロール      |

---

## その他情報
- 作成および更新日時: `2019-08-24T14:15:22Z`
- 必要な時間: `3600` 秒
- 作成・更新者:
  - 作成者: `{ type: "user", userId: "100" }`
  - 更新者: `{ type: "user", userId: "100" }`
```
### API リファレンス

---

### 概要
- **ヘッダー指定省略時の挙動**  
  ヘッダーの指定を省略した場合、「全権限」のアプリロールが指定されたものとしてAPIが実行されます。
- **例外条件**  
  リクエストしたユーザまたはAPIエージェントが権限を持たないアプリロールを指定された場合、エラーになります。

---

### Request Body

**Schema: `application/json`**

#### 宛先設定

| フィールド名          | 型      | 詳細                                                                                     |
|-----------------------|---------|----------------------------------------------------------------------------------------|
| `excludeErrorCount`   | integer | 配信エラーの除外対象となるエラーの発生回数を指定します。<br>**範囲:** 1〜3                                               |
| `exists`              | object  | 他のDBにおけるメールアドレスの有無で抽出します。<br>`null`の場合は抽出を行いません。                                     |
| `from`                | object  | 差出人の設定                                                                             |
| `replyTo`             | string  | 返信先のメールアドレスを指定します。<br>**文字数:** 5〜256                                                               |
| `subject`             | object  | 件名の設定                                                                               |
| `plainBody`           | object  | プレーンテキストメールの本文を指定します。<br>`null`の場合は本文が削除されます。                                         |
| `htmlBody`            | object  | HTML形式のメール本文を指定します。<br>`null`の場合は本文が削除されます。                                               |
| `contentsTimeZone`    | string  | タイムゾーンを扱う日時フィールド（例: 作成日時、最終更新日時）の差し替え時に<br>タイムゾーンを指定します。<br>**既定値:** `"UTC"` |

#### 詳細説明

1. **`excludeErrorCount`**
   - 配信エラーを除外する基準として、指定した回数分のエラー発生を設定できます。
   - 範囲は1〜3のいずれかです。

2. **`exists`**
   - 他DBでのメールアドレス有無によるフィルタリングを行います。
   - 値が`null`の場合、フィルタリングは実施されません。

3. **`replyTo`**
   - 任意の返信先メールアドレスを指定するフィールドです。
   - 入力可能な文字数は5〜256文字です。

4. **`plainBody`**
   - プレーンテキストメールの本文を入力できます。
   - 値に`null`が設定された場合、本文が削除されます。

5. **`htmlBody`**
   - HTML形式のメール本文を入力できます。
   - 値に`null`が設定された場合、本文が削除されます。

6. **`contentsTimeZone`**
   - 件名または本文内に差し替えキーワードを使用する際、差し替え時のタイムゾーン設定を行います。
   - 既定値は`"UTC"`です。
### APIリファレンス

#### タイムゾーンの一覧
- タイムゾーンの詳細はサポートサイトを参照してください。

---

### フィールド詳細

#### `timing`
- **型**: `string` (Enum)
- **選択肢**: `"scheduled"`, `"now"`
- **説明**: 配信タイミングの選択を指定します。
  - `"scheduled"`: 予約配信
  - `"now"`: 即時配信

#### `scheduleDate`
- **型**: `string` (`<date-time>`)
- **説明**: 予約日時を指定します。（`timing`が`"scheduled"`の場合に必須）
- **条件**:
  - 現在時刻から10分経過後かつ2年以内の日時であること。
  - 毎時00分から5分ごとの刻みで指定可能。
- **備考**: 
  - `timing`が`"now"`の場合に`scheduleDate`を指定するとエラーになります。

#### `status`
- **型**: `string` (Enum)
- **選択肢**: `"setting"`, `"ready"`
- **説明**: ステータスの選択を指定します。
  - `"setting"`: 設定中
  - `"ready"`: 設定完了
- **動作**:
  - `timing`が`"now"`の場合:
    - `"ready"`を選択すると配信が開始されます。
  - `timing`が`"scheduled"`の場合:
    - `"ready"`を選択すると待機状態になります。
- **バリデーション**:
  - `"ready"`を指定した場合、以下の条件が確認されます:
    - `from`に設定したドメインの送信ドメイン認証が必要。
    - ドメイン設定が存在しない、または利用不可の場合はエラー。


```
APIリファレンス

---

### 条件
- **timing** が **scheduled** の場合のみ予約日時 (`scheduleDate`) を指定可能。
- `scheduleDate` に指定可能な範囲外の日時が指定されていた場合はエラー。

---

### Responses

#### **200 OK**  
取得したEXPRESSメール設定

##### Response Headers
- **X-Spiral-App-Role**: `string`  
  **Example**: `"employee"`  
  アプリロール。

##### Response Schema: `application/json`
- **id**: `string`  
  EXPRESSメールID。
  
- **to**: `object`  
  宛先設定。
  
- **excludeErrorCount**: `integer`  
  除外対象とするエラーの発生回数。
  
- **exists**: `object`  
  他DBのメールアドレスの有無による抽出。  
  **Note**: `null` の場合、抽出しない。

- **from**: `object`  
  差出人設定。
  
- **replyTo**: `string`  
  返信先設定。任意のメールアドレスを指定する。
  
- **subject**: `object`  
  件名。
  
- **plainBody**: `object`  
  プレーンテキストメールの本文。
  
- **htmlBody**: `object`  
  HTMLメールの本文。
  
- **contentsTimeZone**: `string`  
  **Default**: `"UTC"`  
  タイムゾーンを扱う日時フィールド（作成日時、最終更新日時）の差替えキーワードを件名か本文に含める場合に、差替え時のタイムゾーンを指定する。  
  **備考**: タイムゾーンの一覧はサポートサイトをご確認ください。
  
- **timing**: `string`  
  **Enum**: `"scheduled"`, `"now"`  
  配信タイミング選択。
```
# APIリファレンス

## パラメータ

### 配信スケジュール
- **timing**: `scheduled`（予約配信） または `now`（即時配信） を選択  
- **scheduleDate**: `<date-time>`（予約日時）  
  - 指定可能な範囲:  
    - 現在時刻から10分後〜2年以内  
    - 毎時00分から5分刻み  
  - **条件**:  
    - `timing` が `scheduled` の場合、必須。  
    - `timing` が `now` の場合、指定するとエラー。

### 配信ステータス
- **status**: `string`  
  - Enum: `"setting"`, `"ready"`, `"closed"`  
  - 説明: EXPRESSメール配信設定のステータスを示す。

### メール配信実行情報
- **emailJob**: `object`  
  - 説明: メール配信実行情報。配信が開始されるまでは `null`

### 作成・更新情報
- **createdBy**: `object`  
  - 説明: レコードの作成者。  
- **updatedBy**: `object`  
  - 説明: レコードの更新者。更新がない場合、作成者と同じ。    
- **createdAt**: `<date-time>`  
  - 説明: 作成日時。  
- **updatedAt**: `<date-time>`  
  - 説明: 更新日時。更新がない場合、作成日時と同じ。

---

## エラー

### 403 Forbidden
- 説明: アプリの利用権限がない、または権限が不足している場合に発生。  
- **Response Headers**
  - **X-Spiral-App-Role**: `string`  
    - 例: `"employee"` (アプリロールを示す)

---
### API Reference Structure

#### Request Samples
- **Payload Content Type**: `application/json`

#### Payload Example
```json
{
  "to": {
    "field": "100",
    "where": {
      "type": "simple",
      "value": {
        "operator": "or",
        "conditions": [
          {
            "field": "@email",
            "operator": "domain_is",
            "value1": "example.com"
          },
          {
            "field": "@email",
            "operator": "domain_is",
            "value1": "example.net"
          }
        ]
      }
    }
  },
  "excludeErrorCount": 1,
  "exists": {
    "type": "exists",
    "db": "string",
    "field": "100"
  },
  "from": {
    "displayName": "メルマガ事務局",
    "emailLocalPart": "info",
    "emailFromDomainId": 100
  },
  "replyTo": "reply@example.com",
  "subject": {
    "content": "メール件名テスト"
  },
  "plainBody": {
    "content": "{{@customerMst.nickname}}様\\nプレーンテキストメールの本文テスト\\n{{@_url."
  }
}
```
{
  "CC_001": "{{@_url.CC_002}}",
  "clickCount": {
    "duplication": false,
    "parameter": "appId={{@_app.id}}&dbId={{@_db.id}}",
    "siteId": "1",
    "urls": [
      {
        "name": "CC_001",
        "url": "https://example.com/page1"
      },
      {
        "name": "CC_002",
        "url": "https://example.com/page2"
      }
    ]
  },
  "clickLogin": [
    {
      "validPeriod": {
        "period": 7
      },
      "keyword": "{{@_url.cl.mysite.top/register}}"
    }
  ],
  "htmlBody": {
    "content": "<p>{{@customerMst.nickname}}様</p><p>HTMLメールの本文テスト</p><a href=\"{{@_url.CC_001}}\">URL Link1</a><a href=\"{{@_url."
  }
}
```json
{
  "dataStructure": {
    "URLLink": {
      "name": "CC_002",
      "url": "https://example.com/page1"
    },
    "openCount": false,
    "clickCount": {
      "duplication": true,
      "parameter": "appId={{@_app.id}}&dbId={{@_db.id}}",
      "siteId": "1",
      "urls": [
        {
          "name": "CC_001",
          "url": "https://example.com/page1"
        },
        {
          "name": "CC_002",
          "url": "https://example.com/page1"
        }
      ]
    },
    "clickLogin": [
      {
        "validPeriod": {
          "period": 7
        },
        "keyword": "{{@_url.cl.mysite.top/register}}"
      }
    ],
    "contentsTimeZone": "Asia/Tokyo",
    "timing": "scheduled",
    "scheduleDate": "2017-01-01T12:00:00Z",
    "status": "setting"
  },
  "responseSamples": {
    "statusCode": 200,
    "contentType": "application/json",
    "responseBody": {
      "excludeErrorCount": null
    }
  }
}
```
```json
{
  "exists": {
    "type": "exists",
    "dbId": "100",
    "fieldId": "100"
  },
  "from": {
    "displayName": "事務局",
    "email": "from@mail.example.com",
    "emailFromDomainId": 100
  },
  "replyTo": "reply@example.com",
  "subject": {
    "content": "メール件名テスト"
  },
  "plainBody": {
    "content": "{{@customerMst.nickname}}様\\nプレーンテキストメールの本文テスト\\n{{@_url.CC_001}}\\n{{@_url.CC_002}}",
    "clickCount": {
      "duplication": false,
      "parameter": "appId={{@_app.id}}&dbId={{@_db.id}}",
      "siteId": "1",
      "urls": [
        {
          "name": "CC_001",
          "url": "https://example"
        }
      ]
    }
  }
}
```
{
  "urls": [
    {
      "name": "CC_001",
      "url": "https://example.com/page1"
    },
    {
      "name": "CC_002",
      "url": "https://example.com/page2"
    }
  ],
  "clickLogin": {
    "validPeriod": {
      "timeUnit": "day",
      "period": 7
    },
    "keyword": "{{@_url.cl.mysite.top/register}}",
    "siteId": 301,
    "authenticationId": 401,
    "pageId": 501
  },
  "htmlBody": {
    "content": "<p>{{@customerMst.nickname}}様</p><p>HTMLメールの本文テスト</p><a href=\"{{@_url.CC_001}}\">URL Link1</a><a href=\"{{@_url.CC_002}}\">URL Link2</a>",
    "openCount": false,
    "clickCount": {
      "duplication": true,
      "parameter": "appId={{@_app.id}}&dbId={{@_db.id}}"
    }
  }
}
{
  "siteId": "1",
  "urls": [
    {
      "name": "CC_001",
      "url": "https://example.com/page1"
    },
    {
      "name": "CC_002",
      "url": "https://example.com/page1"
    }
  ],
  "clickLogin": [
    {
      "validPeriod": {
        "timeUnit": "day",
        "period": 7
      },
      "keyword": "{{@_url.cl.mysite.top/register}}",
      "siteId": 301,
      "authenticationId": 401,
      "pageId": 501
    }
  ],
  "contentsTimeZone": "Asia/Tokyo",
  "timing": "scheduled",
  "scheduleDate": "2017-01-01T12:00:00Z",
  "status": "setting",
  "emailJob": {
    "id": "100",
    "status": "finished",
    "deliveredCount": "10",
    "errorCount": "2",
    "startedAt": "2019-08-24T14:15:22Z",
    "requiredTime": "3600"
  }
}
### API Reference: EXPRESSメール設定を削除

---

#### 概要
指定されたEXPRESSメール設定を削除します。  
※ステータスが`"setting"`のもの以外を指定するとエラーとなります。

---

### エンドポイント

**本番環境**  
```
https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/express/email/{expressEmailId}
```

**ベータ環境**  
```
https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/express/email/{expressEmailId}
```

---

### HTTP メソッド

**DELETE**

---

### パスパラメータ (Path Parameters)

| パラメータ名      | 必須 | 種類   | 説明      |
|-------------------|------|--------|-----------|
| `app`            | 必須 | string | アプリID  |
| `db`             | 必須 | string | DBID      |
| `expressEmailId` | 必須 | string | EXPRESSメールID |

---

### ヘッダーパラメータ (Header Parameters)

| パラメータ名            | 種類   | デフォルト値      | 例               | 説明                                                                                       |
|-------------------------|--------|-------------------|------------------|------------------------------------------------------------------------------------------|
| `X-Spiral-App-Role`    | string | `_fullAccess`     | `employee`       | アプリロール。ヘッダー指定が省略された場合、「全権限」のアプリロールが指定されて実行される。<br>指定されたロールで権限がない場合はエラーとなる。 |

---

### レスポンス

#### HTTP ステータスコード

| ステータスコード | 内容              |
|------------------|-------------------|
| **204**         | レスポンスデータなし |

#### レスポンスヘッダー

| パラメータ名             | 種類   | 例               | 説明      |
|--------------------------|--------|------------------|-----------|
| `X-Spiral-App-Role`     | string | `"employee"`     | アプリロール |

---

### メタ情報

| フィールド名           | タイプ   | 値                                  | 説明                                      |
|------------------------|----------|-------------------------------------|-------------------------------------------|
| `createdBy`           | object   | `{"type": "user", "userId": "100"}` | このエンドポイントを作成したユーザー情報 |
| `updatedBy`           | object   | `{"type": "user", "userId": "100"}` | このエンドポイントを更新したユーザー情報 |
| `createdAt`           | string   | `2019-08-24T14:15:22Z`              | エンドポイント作成日時                   |
| `updatedAt`           | string   | `2019-08-24T14:15:22Z`              | エンドポイント更新日時                   |
### エラーコード: 403  
**説明**: アプリの利用権限がない、または権限が不足している。  

#### Response Headers  
- **X-Spiral-App-Role**  *(string)*  
  アプリロール。  
  **例**: `"employee"`  

---

### テスト配信を実行  
**メソッド**: `POST`  
**エンドポイント**:  
- 本番環境: `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/express/email/{expressEmailId}/test`  
- ベータ環境: `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/express/email/{expressEmailId}/test`  

**説明**:  
指定したDBのレコードに対してテスト配信を実行するAPI。

---

#### パラメータ  

**Path Parameters**:  
| パラメータ名      | 必須 | 種類  | 説明            |
|-------------------|------|-------|-----------------|
| `app`            | Yes  | string | アプリID        |
| `db`             | Yes  | string | DB ID           |
| `expressEmailId` | Yes  | string | EXPRESSメールID |

---

**Header Parameters**:  
| パラメータ名          | 種類      | デフォルト値   | 例        | 説明                                                                                    |
|-----------------------|-----------|----------------|-----------|-----------------------------------------------------------------------------------------|
| `X-Spiral-App-Role`  | string    | `_fullAccess`  | `employee`| アプリロール。省略すると「全権限（_fullAccess）」としてAPIが実行される。                  |

**注意**:  
- リクエストしたユーザ・APIエージェントが権限を持たないアプリロールを指定した場合、エラーとなる。  

---

#### Request Body  
- **Content-Type**: `application/json`  
- **形式**:  
  ```json
  {
    "to": object
  }
  ```
  **説明**: 宛先設定。

---

#### Responses  
**200 OK**: 実行したテスト配信のメール配信ジョブ情報を返す。  
### APIリファレンス構造

---

#### Response Headers
- **X-Spiral-App-Role**  
  - **Type:** string  
  - **Example:** `"employee"`  
  - **Description:** アプリロール。

#### Response Schema
- **Content Type:** application/json  
  - **emailJobId**  
    - **Type:** string  
    - **Description:** メール配信ジョブID。

#### ステータスコード
- **403 Forbidden**  
  - アプリの利用権限が不足している場合。

---

#### Request Samples
- **Payload Content Type:** application/json  
  - **Example Payload:**  
    ```json
    {
      "to": {
        "records": ["1", "2"]
      }
    }
    ```

---

#### Response Samples
- **200 OK**  
  - **Content Type:** application/json  
  - **Example Response:**  
    ```json
    {
      "emailJobId": "100"
    }
    ```

---

### メール配信ジョブ

#### エンドポイント: メール配信ジョブ一覧を取得

- **HTTP Method:** GET  
- **URL (本番環境):**  
  `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/emailJobs`  
- **URL (ベータ環境):**  
  `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/emailJobs`  

- **Description:**  
  EXPRESSメール配信ジョブの一覧を取得する。

---

#### パスパラメータ (Path Parameters)
| パラメータ | 必須 | タイプ | 説明     |
|------------|------|--------|----------|
| app        | Yes  | string | アプリID |
| db         | Yes  | string | DBID     |

---

#### クエリパラメータ (Query Parameters)
| パラメータ   | タイプ                | 説明                                                                                  |
|--------------|-----------------------|---------------------------------------------------------------------------------------|
| ids          | Array of strings      | 検索するメール配信ジョブIDのリスト。最大リストサイズは200。                          |
| isTest       | boolean               | `true`を指定するとテスト配信のジョブに絞り込まれる。`false`を指定すると本番に絞り込む。 |
| offset       | integer               | リストのオフセット。**Example:** `offset=20`                                         |
## APIリファレンス

### Query Parameters
- **limit (integer)**  
  - 値の範囲: `[1..200]`  
  - デフォルト値: `20`  
  - 例: `limit=20`  
  - **説明**: リストの取得件数の上限。

---

### Header Parameters
- **X-Spiral-App-Role (string)**  
  - デフォルト値: `_fullAccess`  
  - 例: `"employee"`  
  - **説明**: アプリのロールを指定します。  
    - ヘッダーの指定を省略した場合、デフォルト値の「全権限」ロールでAPIが実行されます。  
    - リクエストしたユーザやAPIエージェントが権限を持たないアプリロールを指定すると、エラーが返されます。

---

### Responses

#### **200 (成功時)**  
**説明**: 取得したEXPRESSメール配信ジョブの一覧を返します。

- **Response Headers**  
  - **X-Spiral-App-Role (string)**  
    - 例: `"employee"`  
    - **説明**: 実行時に使用されたアプリロール。
  
- **Response Schema** (`application/json`)  
  - **items (Array of objects)**  
    - **説明**: EXPRESSメール配信ジョブの一覧。  
  - **prevOffset (integer)**  
    - **説明**: 前のリストのオフセット。前のリストが存在しない場合は`null`。  
  - **nextOffset (integer)**  
    - **説明**: 次のリストのオフセット。次のリストが存在しない場合は`null`。  
  - **totalCount (integer)**  
    - **説明**: 検索結果の全件数。

#### **403 (エラー: 権限不足)**  
**説明**: アプリの利用権限がない、または不足している場合に返されます。

- **Response Headers**  
  - **X-Spiral-App-Role (string)**  
    - 例: `"employee"`  
    - **説明**: 実行時に使用されたアプリロール。

---
```
# APIリファレンス

## 概要
EXPRESSメール配信ジョブを取得するエンドポイント。

### 本番環境 URL
```
https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/emailJobs/{emailJobId}
```

### ベータ環境 URL
```
https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/emailJobs/{emailJobId}
```

このエンドポイントでは、指定した `emailJobId` に該当する EXPRESS メール配信ジョブを取得します。

---

## **パラメータ**

### **Path Parameters**
| 名前       | 必須 | 型       | 説明                     |
|------------|------|----------|--------------------------|
| app        | はい | string   | アプリID                |
| db         | はい | string   | DBID                   |
| emailJobId | はい | string   | メール配信ジョブID     |

### **Header Parameters**
| 名前                  | 型       | デフォルト値      | 説明                                                                                                                                       |
|-----------------------|----------|-------------------|--------------------------------------------------------------------------------------------------------------------|
| X-Spiral-App-Role     | string   | _fullAccess       | 指定可能なアプリロール。<br>例: `employee`。<br>ヘッダーを省略した場合、デフォルトで「全権限」のアプリロールが指定されます。<br>ユーザやAPIエージェントが権限を持たないアプリロールを指定するとエラーとなります。  |

---

## **レスポンス例**

### **HTTP 200 Success**

#### Content-Type: `application/json`

```json
{
  "items": [
    {
      "id": "100",
      "expressEmailId": "string",
      "deliveredCount": "10",
      "errorCount": "2",
      "startedAt": "2019-08-24T14:15:22Z",
      "requiredTime": "3600",
      "isTest": true,
      "status": "finished",
      "errorCode": "U101",
      "errorDetail": "EmailTypeNotSupport"
    }
  ],
  "prevOffset": 0,
  "nextOffset": 40,
  "totalCount": 200
}
```

### フィールド詳細

| フィールド名         | 型       | 説明                                   |
|----------------------|----------|----------------------------------------|
| id                  | string   | 配信ジョブID                          |
| expressEmailId      | string   | EXPRESSメールID                        |
| deliveredCount      | string   | 配信成功件数                         |
| errorCount          | string   | 配信エラー件数                        |
| startedAt           | string   | 配信開始日時 (ISO 8601形式)             |
| requiredTime        | string   | 配信にかかった時間 (秒)               |
| isTest              | boolean  | 配信内容がテストかどうか               |
| status              | string   | 配信ステータス (例: `finished`)       |
| errorCode           | string   | エラーコード                          |
| errorDetail         | string   | エラー詳細                          |

### ページング情報
| フィールド名         | 型       | 説明                                   |
|----------------------|----------|----------------------------------------|
| prevOffset          | integer  | 前のオフセット (存在しない場合は 0)   |
| nextOffset          | integer  | 次のオフセット (存在しない場合は null) |
| totalCount          | integer  | 全体のアイテム数                      |
```
### APIリファレンス構造

#### **Responses**

##### **200 (取得したEXPRESSメール配信ジョブ情報)**

###### **Response Headers**
- `X-Spiral-App-Role`  
  - **Type**: `string`  
  - **Example**: `"employee"`  
  - **Description**: アプリロール

###### **Response Schema:** `application/json`

1. **id**  
   - **Type**: `string`  
   - **Description**: メール配信ジョブID  

2. **expressEmailId**  
   - **Type**: `string`  
   - **Description**: EXPRESSメールID  

3. **deliveredCount**  
   - **Type**: `string`  
   - **Description**: 配信通数  
     - 配信が開始されるまでは`null`

4. **errorCount**  
   - **Type**: `string`  
   - **Description**: 配信エラー件数  
     - 配信が開始された後、初めて配信エラーを受け取るまでは`null`

5. **startedAt**  
   - **Type**: `string` (`<date-time>`)  
   - **Description**: 配信開始時刻  
     - 配信が開始されるまでは`null`  
     - 配信件数が0件の場合は配信準備開始時刻となる

6. **requiredTime**  
   - **Type**: `string` (`<second>`)  
   - **Description**: 所要時間  
     - 配信が開始されるまでは`null`

7. **isTest**  
   - **Type**: `boolean`  
   - **Description**: テスト配信の場合`true`

8. **status**  
   - **Type**: `string`  
   - **Enum**: `"spooling"`, `"failed"`, `"waiting"`, `"delivering"`, `"finished"`, `"forceCanceled"`  
   - **Description**: 配信ステータス

9. **errorCode**  
   - **Type**: `string`  
   - **Description**: ステータスが`failed`の時のみエラーコードが表示される

10. **errorDetail**  
    - **Type**: `string`  
    - **Description**: エラーコードの詳細

---

#### **403 (アプリの利用権限がない、または不足している)**

###### **Response Headers**
- `X-Spiral-App-Role`  
  - **Type**: `string`  
  - **Example**: `"employee"`  
  - **Description**: アプリロール  
### APIリファレンス

---

#### **Response Samples**  
- **Response Code**: `200`
- **Content-Type**: `application/json`  

```json
{
  "id": "100",
  "expressEmailId": "string",
  "deliveredCount": "10",
  "errorCount": "2",
  "startedAt": "2019-08-24T14:15:22Z",
  "requiredTime": "3600",
  "isTest": true,
  "status": "finished",
  "errorCode": "U101",
  "errorDetail": "EmailTypeNotSupport"
}
```

---

### **Endpoint**: Get EXPRESSメール配信ログ一覧  
**Description**:  
指定した条件でEXPRESSメール配信ログ一覧を取得します。各検索条件は全てANDで結合されます。

#### **HTTP Method**
`GET`

#### **URL**
- **SPIRAL ver.2 APIサーバ (本番環境)**  
  `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}/emailLogs`
- **SPIRAL ver.2 APIサーバ (ベータ環境)**  
  `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}/emailLogs`

---

#### **Parameters**  

1. **Path Parameters**
   - **app** (required)  
     - **Type**: `string`  
     - **Description**: アプリID  
   - **db** (required)  
     - **Type**: `string`  
     - **Description**: DBID  

2. **Query Parameters**
   - **email**
     - **Type**: `string`  
     - **Description**: 検索する宛先メールアドレス（部分一致による検索）  
   - **messageId**  
     - **Type**: `string`  
     - **Description**: 検索するメッセージID  
   - **sinceDeliveryDate**  
     - **Type**: `<date-time>`  
     - **Description**: 検索する配信日時（指定した日時以降のメール配信ログで絞り込む）  
     - **Example**: `sinceDeliveryDate=1970-01-01T00:00:00Z`  

--- 


### API リファレンス構造化  

#### パラメータ

- **untilDeliveryDate**  
  - データ型: `string (<date-time>)`  
  - 説明: 検索する配信日時。指定した日時以前のメール配信ログで絞り込みます。  
  - 例: `untilDeliveryDate=1970-01-01T00:00:00Z`  

- **emailJobId**  
  - データ型: `string`  
  - 説明: 検索するメール配信ジョブID。  

- **recordId**  
  - データ型: `string`  
  - 説明: 検索する配信元レコードID。  

- **errorCode**  
  - データ型: `string (<5.x.x or 4.x.x or NULL or NOT NULL>)`  
  - 説明: 検索する配信エラーコード。前方一致で検索を行います。  

- **enableTotalCount**  
  - データ型: `boolean`  
  - デフォルト値: `false`  
  - 説明: `true`の場合、検索結果の対象件数を取得します。  

- **sort**  
  - データ型: `string`  
  - デフォルト値: `"messageId:desc"`  
  - 説明: ソートする対象 (メッセージID、配信日時)。`:asc`を指定すると昇順、`:desc`を指定すると降順になります。  
  - 列挙値:  
    - `"messageId:asc"`  
    - `"messageId:desc"`  
    - `"deliveryDate:asc"`  
    - `"deliveryDate:desc"`  

- **offset**  
  - データ型: `integer`  
  - 説明: リストのオフセット。  
  - 例: `offset=20`  

- **limit**  
  - データ型: `integer`  
  - 範囲: `[1 .. 200]`  
  - デフォルト値: `20`  
  - 説明: リストの上限。  
  - 例: `limit=20`  

#### ヘッダー

- **X-Spiral-App-Role**  
  - データ型: `string`  
  - デフォルト値: `_fullAccess`  
  - 説明: アプリロール。  
  - 例: `employee`
## APIリファレンス構造化

### 挙動
1. **ヘッダーが指定されない場合**  
   - 「全権限」のアプリロールが指定されたものとしてAPIが実行される。
2. **指定されたアプリロールが権限を持たない場合**  
   - エラーが発生する。

---

### Responses

#### **200 - 成功 (取得したEXPRESSメール配信ログ一覧)**

- **Response Headers**
  - **X-Spiral-App-Role (string)**  
    - 例: `"employee"`（アプリロール）

- **Response Schema: application/json**
  - **items** (Array of objects)  
    - EXPRESSメール配信ログの一覧。
  - **prevOffset** (integer)  
    - 前のリストのオフセット値。  
      値が存在しない場合は`null`。
  - **nextOffset** (integer)  
    - 次のリストのオフセット値。  
      値が存在しない場合は`null`。
  - **totalCount** (integer)  
    - 検索結果の全件数。

---

#### **403 - エラー (アプリの利用権限がない/不足している)**

- **Response Headers**
  - **X-Spiral-App-Role (string)**  
    - 例: `"employee"`（アプリロール）
## API リファレンス構造化

### **レスポンスサンプル**
#### **正常系 (HTTP 200)**
- **Content Type**: `application/json`

```json
{
  "items": [
    {
      "email": "yamada.taro@example.com",
      "messageId": "100",
      "deliveryDate": "2019-08-24T14:15:22Z",
      "subject": "8月のメールマガジン",
      "emailJobId": "100",
      "expressEmailId": "100",
      "fieldId": "100",
      "recordId": "100",
      "errorCode": "5.1.1",
      "errorMessage": "5.1.1 user unknown"
    }
  ],
  "prevOffset": 0,
  "nextOffset": 40,
  "totalCount": 200
}
```

---

### **エンドポイント**
#### **アプリ一覧を取得**

- **HTTP メソッド**: `GET`
- **エンドポイント (本番環境)**:  
  `https://api.spiral-platform.com/v1/apps`
- **エンドポイント (ベータ環境)**:  
  `https://api.beta.spiral-platform.net/v1/apps`

---

### **用途**
- アプリの一覧を取得します。

---

### **リクエストに関する注意事項**
- `X-Spiral-App-Authority` ヘッダーが `use`（利用）に設定されている場合、アプリパッケージで **インポート中のアプリ** はレスポンスに含まれません。

---

### **リクエスト パラメーター**
#### **クエリパラメーター**
| パラメーター名 | 型               | 説明                                 | 注意事項 |
| -------------- | ---------------- | ------------------------------------ | -------- |
| `ids`          | Array of strings | 検索するアプリIDのリスト             | 最大200アイテム |
| `querystring`  | string           | 検索キーワード (表示名、説明)       | 部分一致による検索 |


### APIリファレンス

#### パラメータ

##### クエリパラメータ
- **sort** `string`  
  **Default**: `"createdAt:desc"`  
  **Enum**: `"id:asc"`, `"id:desc"`, `"name:asc"`, `"name:desc"`, `"displayName:asc"`, `"displayName:desc"`, `"createdAt:asc"`, `"createdAt:desc"`, `"updatedAt:asc"`, `"updatedAt:desc"`  
  ソート対象 (ID、識別名、表示名、作成日時、更新日時)。  
  - `:asc`: 昇順  
  - `:desc`: 降順  

- **offset** `integer`  
  **Example**: `offset=20`  
  リストのオフセット。  

- **limit** `integer`  
  **Default**: `20`  
  **Range**: `[1 .. 200]`  
  **Example**: `limit=20`  
  リストの上限。

##### ヘッダーパラメータ
- **X-Spiral-App-Authority** `string`  
  **Default**: `"use"`  
  **Enum**: `"use"`, `"manage"`  
  **Example**: `"manage"`  
  アプリ権限種別。利用または管理のどちらの立場でAPIを実行するかを指定します。  
  - ヘッダーの指定を省略した場合、`"use"` がデフォルトで指定されます。

---

#### レスポンス

- **ステータスコード**: `200`  
  検索条件にマッチするアプリの一覧を取得します。

##### レスポンスヘッダー
- **X-Spiral-App-Authority** `string`  
  **Enum**: `"use"`, `"manage"`  
  **Example**: `"manage"`  
  アプリ権限種別。

##### レスポンススキーマ: `application/json`
- **items**: `Array` of `objects`  
  アプリの一覧。

- **prevOffset**: `integer`  
  前のリストのオフセット。前のリストが存在しない場合は `null`。
### API リファレンス

#### 共通情報
- **nextOffset** `integer`:
  - 次のリストのオフセット。次のリストが存在しない場合は `null`。
- **totalCount** `integer`:
  - 検索結果の全件数。

---

### レスポンス サンプル
**200 (成功時)**  
**Content-Type:** `application/json`  

```json
{
  "items": [
    {
      "id": "100",
      "name": "Name",
      "displayName": "アプリ",
      "description": "アプリ説明",
      "revision": 2,
      "version": 1,
      "defaultPhpVersion": "7.4",
      "createdBy": {
        "type": "user",
        "userId": "100"
      },
      "updatedBy": {
        "type": "user",
        "userId": "100"
      },
      "createdAt": "2019-08-24T14:15:22Z",
      "updatedAt": "2019-08-24T14:15:22Z"
    }
  ],
  "prevOffset": 0,
  "nextOffset": 40,
  "totalCount": 200
}
```

---

### アプリ作成

#### エンドポイント
- SPIRAL Ver.2 API サーバ (本番環境):
  - `https://api.spiral-platform.com/v1/apps`
- SPIRAL Ver.2 API サーバ (ベータ環境):
  - `https://api.beta.spiral-platform.net/v1/apps`

#### メソッド
`POST /apps`

---

#### リクエストボディ

**Schema:** `application/json`

| パラメータ        | 必須          | タイプ   | 制約                                                                                     | 説明                                                     |
|--------------------|---------------|----------|------------------------------------------------------------------------------------------|----------------------------------------------------------|
| **name**          | 任意          | `string` | 1 ～ 64文字。アルファベット、数字、アンダースコアのみ使用可能。最初の文字はアルファベットでなければならない。 | 識別名。重複不可。未指定の場合は自動発行される。         |
| **displayName**   | **必須**      | `string` | 1 ～ 64文字。重複不可。                                                               | 表示名                                                   |
| **description**   | 任意          | `string` | 0 ～ 512文字。                                                                         | アプリケーションの説明                                   |

---

#### レスポンス

- **201 (成功時)**  
  作成されたアプリ情報が返されます。
```yaml
Response Schema: application/json
  id: string
    description: ID
  name: string
    description: 識別名
    constraints: [1..64] characters
  displayName: string
    description: 表示名
  description: string
    description: 説明
  revision: integer
    description: リビジョン。アプリを変更するとカウントアップする数値
  version: integer
    description: バージョン
  defaultPhpVersion: string
    description: |
      Enum: "7.4", "8.1", "system_default"
      現在指定可能なPHPバージョンは7.4, 8.1, system_defaultの3種類。
      ※system_defaultは、サービス推奨バージョン。
      現在のsystem_defaultは8.1。
      system_defaultを選択している場合、将来PHPサービス推奨バージョンが更新されると自動的にサービス推奨バージョンを参照します。
  createdBy: object
    description: 作成者
  updatedBy: object
    description: |
      更新者。
      更新がないレコードの場合は作成者と同じ。
  createdAt: string
    format: <date-time>
    description: 作成日時
Error Responses:
  403:
    description: アカウント管理のアプリ管理権限がない
```
### API リファレンス構造化データ

---

#### **リクエストサンプル**

##### Payload
- **Content Type:** `application/json`

```json
{
  "name": "app",
  "displayName": "アプリ",
  "description": "アプリ説明"
}
```

---

#### **レスポンスサンプル**

##### **201**
- **Content Type:** `application/json`

```json
{
  "id": "100",
  "name": "app",
  "displayName": "アプリ",
  "description": "アプリ説明",
  "revision": 2,
  "version": 1,
  "defaultPhpVersion": "7.4",
  "createdBy": {
    "type": "user",
    "userId": "100"
  },
  "updatedBy": {
    "type": "user",
    "userId": "100"
  },
  "createdAt": "2019-08-24T14:15:22Z"
}
```

---

### **エンドポイント:** アプリを取得

#### **GET** `/apps/{appId}`

- **SPIRAL ver.2 APIサーバ (本番環境):**
  `https://api.spiral-platform.com/v1/apps/{appId}`
  
- **SPIRAL ver.2 APIサーバ (ベータ環境):**
  `https://api.beta.spiral-platform.net/v1/apps/{appId}`

#### **メモ**
- `X-Spiral-App-Authority` ヘッダーが `use`（利用） の場合、アプリパッケージでインポート中のアプリを取得することはできません。

---

#### **Path Parameters**

| Name    | Type   | Description | Required |
|---------|--------|-------------|----------|
| `appId` | string | アプリID     | Yes      |

---

#### **Header Parameters**

| Name                     | Type   | Default | Value Options       | Example  | Description                                                                                                           |
|--------------------------|--------|---------|---------------------|----------|-----------------------------------------------------------------------------------------------------------------------|
| `X-Spiral-App-Authority` | string | `use`   | `"use"`, `"manage"` | `manage` | アプリ権限種別: 利用または管理の立場としてAPIを実行しようとしているかを指定します。デフォルトは `use` です。ヘッダーの指定を省略すると `use` が適用されます。 |


```
Responses200
指定したアプリを取得

### Response Headers
- **X-Spiral-App-Authority**: `string`
  - Enum: `"use"`, `"manage"`
  - Example: `"manage"`
  - 概要: アプリ権限種別

### Response Schema: `application/json`
- **id**: `string`
  - 概要: アプリのID
- **name**: `string`
  - 概要: 識別名
  - 制約:
    - 1〜64文字
    - 重複不可
    - 使用可能文字: アルファベット大文字・小文字、数字、アンダースコア
    - 最初の文字はアルファベットである必要あり
    - 未指定の場合は自動発行
- **displayName**: `string`
  - 概要: 表示名
- **description**: `string`
  - 概要: 説明
- **revision**: `integer`
  - 概要: リビジョン
  - 備考: アプリを変更するたびにカウントアップする数値
- **version**: `integer`
  - 概要: バージョン
- **defaultPhpVersion**: `string`
  - Enum: `"7.4"`, `"8.1"`, `"system_default"`
  - 概要: PHPのバージョン
  - 詳細:
    - 現在指定可能なPHPバージョンは `7.4`, `8.1`, `system_default`
    - `system_default`:
      - 現在の推奨バージョン: `8.1`
      - 将来サービス推奨バージョンが更新されると、自動的に参照されるバージョンも更新される

- **createdBy**: `object`
  - 概要: 作成者の情報
- **updatedBy**: `object`
  - 概要: 更新者の情報
```
### API Reference: アプリ変更 API

#### **エンドポイント**
- **本番環境**  
  `https://api.spiral-platform.com/v1/apps/{appId}`  

- **ベータ環境**  
  `https://api.beta.spiral-platform.net/v1/apps/{appId}`  

---

### **API概要**
アプリ情報を変更します。

---

### **HTTP メソッド**
`PATCH`

---

### **パスパラメーター**

| **パラメーター名** | **必須** | **型**   | **説明** |
|--------------------|----------|----------|-----------|
| **appId**          | Yes      | `string` | アプリID |

---

### **リクエストボディ**

Content-Type: `application/json`

| **プロパティ名** | **型**   | **制約**               | **説明**             |
|------------------|----------|-----------------------|----------------------|
| **name**         | `string` | 最小1文字〜最大64文字 | 識別名（重複不可） |

---

### **レスポンス**

#### **成功時**
- HTTP ステータス: `200 OK`
- Content-Type: `application/json`

レスポンス例:
```json
{
  "id": "100",
  "name": "Name",
  "displayName": "アプリ",
  "description": "アプリ説明",
  "revision": 2,
  "version": 1,
  "defaultPhpVersion": "7.4",
  "createdBy": {
    "type": "user",
    "userId": "100"
  },
  "updatedBy": {
    "type": "user",
    "userId": "100"
  },
  "createdAt": "2019-08-24T14:15:22Z",
  "updatedAt": "2019-08-24T14:15:22Z"
}
```

##### フィールド詳細
| **フィールド名**       | **型**      | **説明**                             |
|-------------------------|-------------|--------------------------------------|
| **id**                 | `string`    | アプリのID                          |
| **name**               | `string`    | 識別名                              |
| **displayName**        | `string`    | アプリの表示名                      |
| **description**        | `string`    | アプリの説明                        |
| **revision**           | `integer`   | リビジョン番号                      |
| **version**            | `integer`   | バージョン番号                      |
| **defaultPhpVersion**  | `string`    | デフォルトPHPバージョン             |
| **createdBy**          | `object`    | レコード作成者情報                  |
| **updatedBy**          | `object`    | レコード更新者情報                  |
| **createdAt**          | `datetime`  | 作成日時（更新がない場合、`updatedAt`と同じ） |
| **updatedAt**          | `datetime`  | 更新日時（更新がない場合、`createdAt`と同じ） |

##### 子オブジェクト: `createdBy` / `updatedBy`
| **フィールド名** | **型**   | **説明** |
|------------------|----------|----------|
| **type**         | `string` | 種別 ("user") |
| **userId**       | `string` | ユーザーID |

---

#### **エラー時**

##### **403 Forbidden**
以下のいずれかのケースで発生:
1. アプリの利用権限がない
2. アプリ管理の設定権限がない

---

### **レスポンスヘッダー**

| **ヘッダー名**                 | **型**   | **許可される値**          | **説明**         |
|--------------------------------|----------|---------------------------|-----------------|
| **X-Spiral-App-Authority**     | `string` | `"use"` または `"manage"` | アプリ権限種別   |

Header Example:
```
X-Spiral-App-Authority: "manage"
```
```
# APIリファレンス

## 概要
APIでは以下のフィールドやデータ型を使用します。

---

### **フィールド仕様**

#### 識別名
- **規則**
  - アルファベット大文字・小文字、数字、アンダースコア (`_`) のみ使用可能
  - 最初の文字はアルファベットである必要があります

---

#### displayName (string)
- **説明**: 表示名
- **制約**:
  - 文字数: 1 ～ 64文字
  - 重複不可

---

#### description (string)
- **説明**: 説明
- **制約**:
  - 文字数: 0 ～ 512文字

---

#### defaultPhpVersion (string)
- **説明**: PHPのデフォルトバージョン
- **選択可能値 (Enum)**:
  - `"7.4"`
  - `"8.1"`
  - `"system_default"`
- **備考**:
  - 現在指定可能なPHPバージョンは `7.4`, `8.1`, `system_default` の3種類。
  - `"system_default"` を選択した場合、サービス推奨バージョンが自動的に参照される。
  - 現在の `"system_default"` は **8.1**。
  - 將来、PHPサービス推奨バージョンが更新されるとその新しいバージョンに切り替わります。

---

### **レスポンス**

#### HTTPステータス
- **200**: 変更が正常に行われたアプリ情報を取得

#### **Response Schema: application/json**
- **id (string)**: アプリのID
- **name (string)**: 
  - 説明: 識別名
  - 制約: 1 ～ 64文字
- **displayName (string)**:
  - 説明: 表示名
- **description (string)**:
  - 説明: 説明
- **revision (integer)**:
  - 説明: リビジョン
  - 備考: アプリを変更するたびにカウントアップする数値
- **version (integer)**:
  - 説明: バージョン番号
- **defaultPhpVersion (string)**:
  - 説明: 現在指定可能なPHPバージョン
  - 選択可能値 (Enum):
    - `"7.4"`
    - `"8.1"`
    - `"system_default"`
  - 備考:
    - `"system_default"` は **8.1**。
    - サービス推奨バージョンが更新された場合はその値が自動的に参照される。
```
```
# APIリファレンス

## PHPサービス推奨バージョン

- **system_default**: サービス推奨バージョン
  - 現在の `system_default`: **8.1**
  - `system_default` を選択した場合、将来サービス推奨バージョンが更新されると、自動的に新しいサービス推奨バージョンが適用される。

---

## フィールド定義

| フィールド名     | 型        | 説明                                         |
|------------------|-----------|----------------------------------------------|
| **createdBy**    | `object`  | 作成者                                       |
| **updatedBy**    | `object`  | 更新者（更新がない場合、作成者と同じ）       |
| **createdAt**    | `string`  | 作成日時 (`<date-time>` フォーマット)         |

---

## エラーコード

- **403**: アプリ管理の全権限がない。

---

## リクエストサンプル

### Payload

#### Content-Type: `application/json`
```json
{
  "name": "Name",
  "displayName": "アプリ",
  "description": "アプリ説明",
  "defaultPhpVersion": "7.4"
}
```

---

## レスポンスサンプル

### 200 OK

#### Content-Type: `application/json`
```json
{
  "id": "100",
  "name": "app",
  "displayName": "アプリ",
  "description": "アプリ説明",
  "revision": 2,
  "version": 1,
  "defaultPhpVersion": "7.4",
  "createdBy": {
    "type": "user",
    "userId": "100"
  },
  "updatedBy": {
    "type": "user",
    "userId": "100"
  },
  "createdAt": "2019-08-24T14:15:22Z"
}
```

---

## エンドポイント: アプリを削除

### DELETE `/apps/{appId}`

#### 説明
アプリを削除します。

#### ベースURL
- **本番環境**: `https://api.spiral-platform.com/v1/apps/{appId}`
- **ベータ環境**: `https://api.beta.spiral-platform.net/v1/apps/{appId}`

#### パスパラメータ
| パラメータ名 | 型       | 必須 | 説明     |
|--------------|----------|------|----------|
| **appId**    | `string` | 必須 | アプリID |
```
# API リファレンス

## 1. アプリ削除
### **Responses**
- **204**: 指定したアプリを削除成功。
- **403**: アプリ管理の全権限がない。

---

## 2. DB一覧の取得

### **エンドポイント**
- **本番環境**: `https://api.spiral-platform.com/v1/apps/{app}/dbs`
- **ベータ環境**: `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs`

DBの一覧を取得するためのAPIです。

### **HTTP メソッド**
- `GET`

### **Path Parameters**
| 名称         | 必須  | 型     | 説明    |
| ------------ | ----- | ------ | ------- |
| `app`        | 必須  | string | アプリID |

---

### **Query Parameters**
| 名称           | 型         | デフォルト値               | 許容値                                                             | 説明                                |
| -------------- | ---------- | ------------------------- | ------------------------------------------------------------------ | ----------------------------------- |
| `query`        | string     | なし                      | 任意の文字列                                                       | 検索するDBのキーワード (表示名、説明)。 |
| `sort`         | string     | `"createdAt:desc"`        | `"id:asc"`, `"id:desc"`, `"name:asc"`, `"name:desc"`, `createdAt:asc`, その他詳細参照 | ソート対象 (ID、識別名、表示名、作成日時、更新日時)。`:asc` = 昇順、`:desc` = 降順。 |
| `offset`       | integer    | なし                      | 任意                                                                 | データ取得開始のオフセット値 (例: `offset=20`)。 |
| `limit`        | integer    | `20`                      | `[ 1 .. 200 ]`                                                     | 取得件数の上限値 (例: `limit=20`)。 |

---

### **Header Parameters**
| 名称                        | 型     | デフォルト値 | 許容値               | 説明                     |
| --------------------------- | ------ | ------------ | -------------------- | ------------------------ |
| `X-Spiral-App-Authority`    | string | `use`        | `"use"`, `"manage"`  | アプリ権限種別 (例: `manage`) 。 |


### APIリファレンス

#### 概要
API実行時に「利用」または「管理」の立場を指定する必要があります。  
- **ヘッダーの指定を省略した場合**: `use`（利用）がデフォルトとして指定されます。  

---

### ヘッダー

#### **X-Spiral-App-Role**
- **Default**: `_fullAccess`
- **Example**: `employee`（アプリロール）

#### **X-Spiral-App-Authority**
- **説明**: `use`（利用）の場合にのみ指定が必要です。
- **動作**:
  - ヘッダーの指定を省略すると、デフォルトで「全権限」のアプリロールが適用されます。
  - リクエストしたユーザーまたはAPIエージェントが権限を持たないアプリロールを指定した場合、エラーが発生します。

---

### レスポンス

#### **HTTPステータスコード**
- `200 OK`: DBの一覧を取得成功。

#### **レスポンスヘッダー**

1. **X-Spiral-App-Authority**
   - **Type**: `string`
   - **Enum**: `"use"`, `"manage"`
   - **Example**: `"manage"`（アプリ権限種別）

2. **X-Spiral-App-Role**
   - **Type**: `string`
   - **Example**: `"employee"`（アプリロール）

---

### レスポンススキーマ

- **Content-Type**: `application/json`

#### **アイテム情報: Array of objects**
- **各フィールドの詳細**:
  - **prevOffset**
    - **Type**: `integer`
    - **説明**: 前のリストのオフセット。前のリストが存在しない場合は`null`。
  - **nextOffset**
    - **Type**: `integer`
    - **説明**: 次のリストのオフセット。次のリストが存在しない場合は`null`。
  - **totalCount**
    - **Type**: `integer`
    - **説明**: 検索結果の全件数。
```
APIリファレンス

### 403 エラー概要
以下のケースで発生します：
- アプリの利用権限がない、または不足している
- アプリ管理の設定権限がない

---

### Response Headers

| Header Name              | Type    | Enum Values       | Example    | Description       |
|--------------------------|---------|-------------------|------------|-------------------|
| X-Spiral-App-Authority   | string  | "use", "manage"   | "manage"   | アプリ権限種別      |
| X-Spiral-App-Role        | string  | -                 | "employee" | アプリロール        |

---

### Response Samples

#### HTTP Code: 200  
**Content-Type**: application/json  
**Response Body**:
```json
{
  "items": [
    {
      "id": "100",
      "name": "inquirydb",
      "displayName": "問い合わせ管理DB"
    }
  ]
}
```
```
### API Reference: 問い合わせ管理DB

#### 概要
- **Description**: 問い合わせを管理するDBです。
- **Revision**: 1

---

### Fields

#### 1. 氏名 (Name)
- **ID**: 1
- **Name**: name
- **Display Name**: 氏名
- **Type**: text
- **Field Order**: 0
- **Size**: 128
- **Required**: true
- **Unique**: false
- **Index**: true
- **Validation**:
  - **Min Length**: 1
  - **Max Length**: 128
  - **Allowed Character Types**: `alphabet`, `multibyte`
  - **Regular Expression**: `example.*`

#### 2. 問い合わせ内容 (Inquiry Detail)
- **ID**: 2
- **Name**: inquiry_detail
- **Display Name**: 問い合わせ内容
- **Type**: textarea
- **Field Order**: 1
- **Size**: 1024
- **Required**: false
- **Unique**: false
- **Index**: false
- **Validation**:
  - **Min Length**: 1
  - **Max Length**: 20000
  - **Allowed Character Types**: `numeral`, `alphabet`, `sign`, `multibyte`
```json
[
    {
        "id": "3",
        "name": "email",
        "displayName": "メールアドレス",
        "size": 256,
        "fieldOrder": 2,
        "type": "email",
        "required": true,
        "unique": true,
        "index": true,
        "regexp": "^[a-z]+[.]+[a-z]*@.*",
        "allowDomains": ["pi-pe.co.jp"],
        "denyDomains": ["example.co.jp"]
    },
    {
        "id": "4",
        "name": "gender",
        "displayName": "性別",
        "size": 8,
        "fieldOrder": 3,
        "type": "select",
        "required": true,
        "index": true,
        "options": [
            {
                "id": "1",
                "label": "男性"
            },
            {
                "id": "2",
                "label": "女性"
            }
        ]
    },
    {
        "id": "5",
        "name": "inquiry_type",
        "displayName": "問い合わせ種別"
    }
]
```
```json
[
  {
    "id": null,
    "name": null,
    "displayName": null,
    "size": 125,
    "fieldOrder": 4,
    "type": "multiselect",
    "required": true,
    "index": false,
    "minSelection": 1,
    "maxSelection": 4,
    "options": [
      {
        "id": "1",
        "label": "資料請求"
      },
      {
        "id": "2",
        "label": "見積"
      },
      {
        "id": "3",
        "label": "サポート"
      },
      {
        "id": "4",
        "label": "その他"
      }
    ]
  },
  {
    "id": "6",
    "name": "inquiry_ID",
    "displayName": "問い合わせID",
    "size": 8,
    "fieldOrder": 5,
    "type": "integer",
    "required": true,
    "unique": true,
    "index": true,
    "minRange": 1,
    "maxRange": 10000
  },
  {
    "id": "7",
    "name": "weight",
    "displayName": "重量",
    "size": 8,
    "fieldOrder": null,
    "type": null,
    "required": null,
    "unique": null,
    "index": null,
    "minRange": null,
    "maxRange": null
  }
]
```
```json
[
  {
    "id": "6",
    "name": null,
    "displayName": null,
    "size": null,
    "fieldOrder": 6,
    "type": "double",
    "required": true,
    "unique": false,
    "index": true,
    "minRange": "0",
    "maxRange": "100.0",
    "decimalDigit": {
      "digitNumber": "1",
      "enableRoundDown": false
    }
  },
  {
    "id": "8",
    "name": "phone",
    "displayName": "電話番号",
    "size": 19,
    "fieldOrder": 7,
    "type": "phone",
    "required": true,
    "unique": true,
    "index": true,
    "phoneRegionCode": "JP"
  },
  {
    "id": "9",
    "name": "response_date_time",
    "displayName": "対応日時",
    "size": 8,
    "fieldOrder": 8,
    "type": "dateTime",
    "required": true,
    "unique": false,
    "index": false,
    "minRange": "1989-12-31T15:00:00Z",
    "maxRange": "2021-12-31T14:30:00Z"
  }
]
```
```json
[
    {
        "id": "10",
        "name": "response_date",
        "displayName": "対応日付",
        "size": 4,
        "fieldOrder": 9,
        "type": "date",
        "required": true,
        "unique": false,
        "index": true,
        "minRange": "1900-01-01",
        "maxRange": "2021-12-31"
    },
    {
        "id": "11",
        "name": "preferred_date",
        "displayName": "希望日",
        "size": 8,
        "fieldOrder": 10,
        "type": "monthDay",
        "required": false,
        "unique": false,
        "index": false,
        "minRange": "01-01",
        "maxRange": "12-31"
    },
    {
        "id": "12",
        "name": "preferred_time",
        "displayName": "希望時刻",
        "size": 8,
        "fieldOrder": 11,
        "type": "time",
        "required": true,
        "unique": false,
        "index": false,
        "minRange": "06:00:00",
        "maxRange": null
    }
]
```
```json
[
  {
    "id": "13",
    "name": "file",
    "displayName": "添付ファイル",
    "size": "null",
    "fieldOrder": 12,
    "type": "file",
    "required": true,
    "allowFileExtensionCategories": ["text"],
    "allowFileExtensions": ["jpe", "jpg", "txt", "csv", "tsv"],
    "maxFiles": "10",
    "maxFileSize": "104857600"
  },
  {
    "id": "14",
    "name": "password",
    "displayName": "パスワード",
    "size": 128,
    "fieldOrder": 13,
    "type": "password",
    "required": true,
    "minLength": "8",
    "maxLength": "128",
    "allowCharTypes": [
      "numeral",
      "sign",
      "lowercase_alphabet",
      "uppercase_alphabet"
    ],
    "minCharTypes": "4"
  },
  {
    "id": "15",
    "name": "customer",
    "displayName": "顧客",
    "size": 8,
    "fieldOrder": null
  }
]
```
```json
{
  "fields": [
    {
      "id": 14,
      "type": "reference",
      "required": true,
      "referenceDb": {
        "id": "1",
        "name": "customer_address",
        "displayName": "顧客アドレス"
      },
      "referenceMultiple": true,
      "referenceLabelField": {
        "type": "_id",
        "id": "_id",
        "name": "_id",
        "displayName": "(ID)"
      },
      "referenceUnique": false,
      "minReference": "1",
      "maxReference": "10",
      "onReferenceDelete": "restrict",
      "multipleUnique": "1"
    },
    {
      "id": 16,
      "name": "response_person",
      "displayName": "問い合わせ担当者",
      "size": 320,
      "fieldOrder": 15,
      "type": "user",
      "defaultValue": {
        "type": "dynamic",
        "valueType": 5,
        "isOverwrite": true
      },
      "required": true,
      "unique": false,
      "index": false
    }
  ],
  "createdBy": {
    "type": "user",
    "userId": "100"
  }
}
```
```
API リファレンス: DBを作成

### エンドポイント
- **URL (SPIRAL ver.2)**: https://api.spiral-platform.com/v1/apps/{app}/dbs
- **URL (ベータ環境)**: https://api.beta.spiral-platform.net/v1/apps/{app}/dbs

### 説明
指定したアプリに新しいDBを作成します。

---

### パスパラメータ
| パラメータ | 必須   | 型     | 説明     |
|------------|--------|--------|----------|
| `app`      | 必須   | string | アプリID |

---

### リクエストボディ
- **Content-Type**: `application/json`

| フィールド名       | 必須     | 型        | 制約・説明                                                                                      |
|--------------------|----------|-----------|-----------------------------------------------------------------------------------------------|
| `name`            | 任意     | string    | 識別名                                                                                       |
|                    |          |           | - 1〜64文字                                                                                 |
|                    |          |           | - アルファベットの大文字・小文字、数字、アンダースコア(_) のみ使用可能                          |
|                    |          |           | - 先頭の文字はアルファベットでなければならない                                                 |
|                    |          |           | - 未指定の場合は自動発行                                                                      |
| `displayName`      | 必須     | string    | DB表示名                                                                                     |
|                    |          |           | - 1〜64文字                                                                                 |
| `description`      | 任意     | string    | DB説明                                                                                       |
|                    |          |           | - 最大512文字                                                                                |
| `fields`           | 任意     | array     | フィールドのリスト                                                                            |

---

### レスポンス

#### 201: 作成したDBの情報
- **Content-Type**: `application/json`

| フィールド名       | 型        | 説明                                                                                           |
|--------------------|-----------|-----------------------------------------------------------------------------------------------|
| `id`              | string    | DBID                                                                                         |
| `name`            | string    | 識別名                                                                                       |
|                    |           | - 1〜64文字                                                                                 |
|                    |           | - アルファベットの大文字・小文字、数字、アンダースコア(_) のみ使用可能                          |
|                    |           | - 先頭の文字はアルファベットでなければならない                                                 |

---

### Example (Response Metadata)
| フィールド名       | 型        | 説明                                                                                           |
|--------------------|-----------|-----------------------------------------------------------------------------------------------|
| `updatedBy`        | object    | 更新者情報                                                                                    |
|                    |           | - `type`: "user"                                                                             |
|                    |           | - `userId`: "100"                                                                            |
| `createdAt`        | string    | 作成日時 (ISO 8601フォーマット)                                                                |
| `updatedAt`        | string    | 更新日時 (ISO 8601フォーマット)                                                                |
| `prevOffset`       | integer   | 前のオフセット                                                                                |
| `nextOffset`       | integer   | 次のオフセット                                                                                |
| `totalCount`       | integer   | 総件数                                                                                       |
```
```
API リファレンス

項目一覧:
1. displayName (string)
   - 長さ: 1 ～ 64 文字
   - 説明: DB表示名
   
2. description (string)
   - 長さ: 0 ～ 512 文字
   - 説明: DB説明
   
3. revision (string)
   - 説明: DBリビジョン

4. fields (Array of objects)
   - 説明: フィールド一覧

5. createdBy (object)
   - 説明: 作成者

6. updatedBy (object)
   - 説明: 更新者
   - 備考: 更新がないレコードの場合は作成者と同じ

7. createdAt (string, <date-time>)
   - 説明: 作成日時

8. updatedAt (string, <date-time>)
   - 説明: 更新日時
   - 備考: 更新がないレコードの場合は作成日時と同じ

エラーレスポンス:
- 403: アプリ管理の設定権限がない
```
```json
{
  "name": "inquirydb",
  "displayName": "問い合わせ管理DB",
  "description": "問い合わせを管理するDBです。",
  "fields": [
    {
      "name": "name",
      "displayName": "氏名",
      "type": "text",
      "required": true,
      "unique": false,
      "index": true,
      "minLength": "1",
      "maxLength": "128",
      "allowCharTypes": ["alphabet", "multibyte"],
      "regexp": "example.*"
    },
    {
      "name": "inquiry_detail",
      "displayName": "問い合わせ内容",
      "type": "textarea",
      "required": false,
      "unique": false,
      "index": false,
      "minLength": "1",
      "maxLength": "20000",
      "allowCharTypes": []
    }
  ]
}
```
```json
[
  {
    "name": "numeral",
    "alphabet": "alphabet",
    "sign": "sign",
    "multibyte": "multibyte",
    "regexp": "example.*"
  },
  {
    "name": "email",
    "displayName": "メールアドレス",
    "type": "email",
    "required": true,
    "unique": true,
    "index": true,
    "regexp": "^[a-z]+[.]+[a-z]*@.*",
    "allowDomains": ["pi-pe.co.jp"],
    "denyDomains": ["example.co.jp"]
  },
  {
    "name": "gender",
    "displayName": "性別",
    "type": "select",
    "required": true,
    "index": true,
    "options": [
      {
        "id": "1",
        "label": "男性"
      },
      {
        "id": "2",
        "label": "女性"
      }
    ]
  },
  {
    "name": "inquiry_type",
    "displayName": "問い合わせ種別",
    "type": "multiselect",
    "required": true
  }
]
```
```json
[
  {
    "name": "index",
    "required": false,
    "type": "boolean",
    "defaultValue": "false"
  },
  {
    "name": "minSelection",
    "type": "integer",
    "required": true,
    "minRange": 1
  },
  {
    "name": "maxSelection",
    "type": "integer",
    "required": true,
    "minRange": 1,
    "maxRange": 4
  },
  {
    "name": "options",
    "type": "array",
    "required": true,
    "items": [
      {
        "id": "1",
        "label": "資料請求"
      },
      {
        "id": "2",
        "label": "見積"
      },
      {
        "id": "3",
        "label": "サポート"
      },
      {
        "id": "4",
        "label": "その他"
      }
    ]
  },
  {
    "name": "inquiry_ID",
    "displayName": "問い合わせID",
    "type": "integer",
    "required": true,
    "unique": true,
    "index": true,
    "minRange": 1,
    "maxRange": 10000
  },
  {
    "name": "weight",
    "displayName": "重量",
    "type": "double",
    "required": true,
    "unique": false,
    "index": true,
    "minRange": 0,
    "maxRange": 100.0,
    "decimalDigits": {
      "digitNumber": 1,
      "enableRoundDown": true
    }
  }
]
```
```
[
  {
    "name": "phone",
    "displayName": "電話番号",
    "type": "phone",
    "required": true,
    "unique": true,
    "index": true,
    "phoneRegionCode": "JP"
  },
  {
    "name": "response_date_time",
    "displayName": "対応日時",
    "type": "dateTime",
    "required": true,
    "unique": false,
    "index": false,
    "minRange": "1989-12-31T15:00:00Z",
    "maxRange": "2021-12-31T14:30:00Z"
  },
  {
    "name": "response_date",
    "displayName": "対応日付",
    "type": "date",
    "required": true,
    "unique": false,
    "index": true,
    "minRange": "1900-01-01",
    "maxRange": "2021-12-31"
  },
  {
    "name": "preferred_day",
    "displayName": "希望日",
    "type": null
  }
]
```
```json
[
  {
    "name": "monthDay",
    "required": false,
    "unique": false,
    "index": false,
    "minRange": "01-01",
    "maxRange": "12-31"
  },
  {
    "name": "preferred_time",
    "displayName": "希望時刻",
    "type": "time",
    "required": true,
    "unique": false,
    "index": false,
    "minRange": "06:00:00",
    "maxRange": "12:00:00"
  },
  {
    "name": "file",
    "displayName": "添付ファイル",
    "type": "file",
    "required": true,
    "allowFileExtensionCategories": ["text"],
    "allowFileExtensions": ["jpeg", "jpg", "txt"],
    "maxFiles": "10",
    "maxFileSize": "104857600"
  },
  {
    "name": "password",
    "displayName": "パスワード",
    "type": "password",
    "required": true,
    "minLength": "8",
    "maxLength": "128",
    "allowCharTypes": ["numeral", "sign"]
  }
]
```
```json
{
  "fields": [
    {
      "name": "lowercase_alphabet",
      "type": "string",
      "constraints": {
        "case": "lowercase"
      }
    },
    {
      "name": "uppercase_alphabet",
      "type": "string",
      "constraints": {
        "case": "uppercase"
      }
    },
    {
      "name": "minCharTypes",
      "type": "string",
      "value": "4"
    },
    {
      "name": "customer",
      "displayName": "顧客",
      "type": "reference",
      "required": true,
      "properties": {
        "referenceDbId": "1",
        "referenceMultiple": true,
        "referenceLabelFieldId": "_id",
        "referenceUnique": false,
        "minReference": "1",
        "maxReference": "10",
        "onReferenceDelete": "restrict",
        "multipleUnique": "1"
      }
    },
    {
      "name": "response_person",
      "displayName": "問い合わせ担当者",
      "type": "user",
      "defaultValue": {
        "type": "dynamic",
        "valueType": 5,
        "isOverwrite": true
      },
      "required": true,
      "unique": false,
      "index": false
    }
  ],
  "response": {
    "status": "201",
    "contentType": "application/json",
    "sample": {
      "id": "100",
      "name": "inquirydb",
      "displayName": "問い合わせ管理DB"
    }
  }
}
```
```json
{
  "description": "問い合わせを管理するDBです",
  "revision": "1",
  "fields": [
    {
      "id": "1",
      "name": "name",
      "displayName": "氏名",
      "size": 128,
      "fieldOrder": 0,
      "type": "text",
      "required": true,
      "unique": false,
      "index": true,
      "minLength": "1",
      "maxLength": "128",
      "allowCharTypes": ["alphabet", "multibyte"],
      "regexp": "example.*"
    },
    {
      "id": "2",
      "name": "inquiry_detail",
      "displayName": "問い合わせ内容",
      "size": 1024,
      "fieldOrder": 1,
      "type": "textarea",
      "required": false,
      "unique": false,
      "index": false,
      "minLength": "1",
      "maxLength": "20000",
      "allowCharTypes": ["numeral", "alphabet", "sign", "multibyte"]
    }
  ]
}
```
```json
[
  {
    "id": "3",
    "name": "email",
    "displayName": "メールアドレス",
    "size": 256,
    "fieldOrder": 2,
    "type": "email",
    "required": true,
    "unique": true,
    "index": true,
    "regexp": "^[a-z]+[.]+[a-z]*@.*",
    "allowDomains": ["pi-pe.co.jp"],
    "denyDomains": ["example.co.jp"]
  },
  {
    "id": "4",
    "name": "gender",
    "displayName": "性別",
    "size": 8,
    "fieldOrder": 3,
    "type": "select",
    "required": true,
    "index": true,
    "options": [
      {
        "id": "1",
        "label": "男性"
      },
      {
        "id": "2",
        "label": "女性"
      }
    ]
  },
  {
    "id": "5",
    "name": "inquiry_type",
    "displayName": "問い合わせ種別"
  }
]
```
```json
[
  {
    "size": 125,
    "fieldOrder": 4,
    "type": "multiselect",
    "required": true,
    "index": false,
    "minSelection": "1",
    "maxSelection": "4",
    "options": [
      {
        "id": "1",
        "label": "資料請求"
      },
      {
        "id": "2",
        "label": "見積"
      },
      {
        "id": "3",
        "label": "サポート"
      },
      {
        "id": "4",
        "label": "その他"
      }
    ]
  },
  {
    "id": "6",
    "name": "inquiry_ID",
    "displayName": "問い合わせID",
    "size": 8,
    "fieldOrder": 5,
    "type": "integer",
    "required": true,
    "unique": true,
    "index": true,
    "minRange": "1",
    "maxRange": "10000"
  },
  {
    "id": "7",
    "name": "weight",
    "displayName": "重量",
    "size": 8,
    "fieldOrder": null
  }
]
```
```json
[
  {
    "id": "6",
    "type": "double",
    "required": true,
    "unique": false,
    "index": true,
    "minRange": "0",
    "maxRange": "100.0",
    "decimalDigit": {
      "digitNumber": "1",
      "enableRoundDown": false
    }
  },
  {
    "id": "8",
    "name": "phone",
    "displayName": "電話番号",
    "size": 19,
    "fieldOrder": 7,
    "type": "phone",
    "required": true,
    "unique": true,
    "index": true,
    "phoneRegionCode": "JP"
  },
  {
    "id": "9",
    "name": "response_date_time",
    "displayName": "対応日時",
    "size": 8,
    "fieldOrder": 8,
    "type": "dateTime",
    "required": true,
    "unique": false,
    "index": false,
    "minRange": "1989-12-31T15:00:00Z",
    "maxRange": "2021-12-31T14:30:00Z"
  }
]
```
```json
[
    {
        "id": "10",
        "name": "response_date",
        "displayName": "対応日付",
        "size": 4,
        "fieldOrder": 9,
        "type": "date",
        "required": true,
        "unique": false,
        "index": true,
        "minRange": "1900-01-01",
        "maxRange": "2021-12-31"
    },
    {
        "id": "11",
        "name": "preferred_date",
        "displayName": "希望日",
        "size": 8,
        "fieldOrder": 10,
        "type": "monthDay",
        "required": false,
        "unique": false,
        "index": false,
        "minRange": "01-01",
        "maxRange": "12-31"
    },
    {
        "id": "12",
        "name": "preferred_time",
        "displayName": "希望時刻",
        "size": 8,
        "fieldOrder": 11,
        "type": "time",
        "required": true,
        "unique": false,
        "index": false,
        "minRange": "06:00:00",
        "maxRange": null
    }
]
```
```json
[
    {
        "id": "13",
        "name": "file",
        "displayName": "添付ファイル",
        "size": "null",
        "fieldOrder": 12,
        "type": "file",
        "required": true,
        "allowFileExtensionCategories": ["text"],
        "allowFileExtensions": ["jpe", "jpg", "txt", "csv", "tsv"],
        "maxFiles": "10",
        "maxFileSize": "104857600"
    },
    {
        "id": "14",
        "name": "password",
        "displayName": "パスワード",
        "size": 128,
        "fieldOrder": 13,
        "type": "password",
        "required": true,
        "minLength": "8",
        "maxLength": "128",
        "allowCharTypes": [
            "numeral",
            "sign",
            "lowercase_alphabet",
            "uppercase_alphabet"
        ],
        "minCharTypes": "4"
    },
    {
        "id": "15",
        "name": "customer",
        "displayName": "顧客",
        "size": 8,
        "fieldOrder": null
    }
]
```
```json
{
  "fields": [
    {
      "id": 14,
      "type": "reference",
      "required": true,
      "referenceDb": {
        "id": "1",
        "name": "customer_address",
        "displayName": "顧客アドレス"
      },
      "referenceMultiple": true,
      "referenceLabelField": {
        "type": "_id",
        "id": "_id",
        "name": "_id",
        "displayName": "(ID)"
      },
      "referenceUnique": false,
      "minReference": "1",
      "maxReference": "10",
      "onReferenceDelete": "restrict",
      "multipleUnique": "1"
    },
    {
      "id": 16,
      "name": "response_person",
      "displayName": "問い合わせ担当者",
      "size": 320,
      "fieldOrder": 15,
      "type": "user",
      "defaultValue": {
        "type": "dynamic",
        "valueType": 5,
        "isOverwrite": true
      },
      "required": true,
      "unique": false,
      "index": false
    }
  ],
  "createdBy": {
    "type": "user",
    "userId": "100"
  }
}
```
## API リファレンス - DBを取得

### エンドポイント
**Production 環境:**  
`https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}`  

**Beta 環境:**  
`https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}`  

---

### HTTP メソッド
**GET**

---

### 説明
指定されたアプリケーション及びデータベースIDに対応するデータベースを取得します。

---

### パスパラメータ (Path Parameters)
| パラメータ名 | 必須 | 型       | 説明     |
|--------------|------|----------|----------|
| `app`        | 必須 | `string` | アプリID |
| `db`         | 必須 | `string` | DBID     |

---

### ヘッダーパラメータ (Header Parameters)
| パラメータ名                   | 型       | デフォルト値     | 説明                                                                                                                                      |
|--------------------------------|----------|------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| `X-Spiral-App-Authority`       | `string` | `use`            | アプリ権限種別を指定します。`use`（利用）または `manage`（管理）のいずれかを指定可能です。<br>**例:** `manage`                      |
| `X-Spiral-App-Authority`省略時| -        | 自動的に`use`指定 | ヘッダーの指定を省略した場合、自動で `use` が指定されたものとしてAPIが実行されます。                                                  |
| `X-Spiral-App-Role`            | `string` | `_fullAccess`     | アプリロールを指定します。このパラメータは `X-Spiral-App-Authority` が `use` の場合のみ必須です。<br>**例:** `employee`             |

---

### レスポンスのプロパティ
| プロパティ名       | 型       | 説明                              |
|--------------------|----------|-----------------------------------|
| `updatedBy`        | `object` | 更新者の情報                      |
| `updatedBy.type`   | `string` | 更新者の種別 (`user` 等)          |
| `updatedBy.userId` | `string` | 更新者のユーザーID (`100` 等)     |
| `createdAt`        | `string` | 作成日時 (ISO 8601 フォーマット)  |
| `updatedAt`        | `string` | 更新日時 (ISO 8601 フォーマット)  |

---

### レスポンス例
```json
{
  "updatedBy": {
    "type": "user",
    "userId": "100"
  },
  "createdAt": "2021-01-28T03:57:23Z",
  "updatedAt": "2021-01-28T03:57:23Z"
}
```
# APIリファレンス構造化

## 説明
- **ヘッダー指定省略時**: 「全権限」のアプリロールが指定されたものとしてAPIが実行されます。
- **エラー条件**: リクエストしたユーザもしくはAPIエージェントが権限を持たないアプリロールを指定した場合、エラーとなります。

---

## Responses
### **200 OK**: DB設定情報
#### Response Headers
- **X-Spiral-App-Authority**  
  - **型**: string (Enum: "use", "manage")  
  - **説明**: アプリ権限の種別  
  - **例**: "manage"

- **X-Spiral-App-Role**  
  - **型**: string  
  - **説明**: アプリロール  
  - **例**: "employee"

---

#### Response Schema: application/json
- **id**  
  - **型**: string  
  - **説明**: DB ID  
  - **備考**: 
    - 複製不可
    - 文字制限: 1～64文字
    - 使用可能文字: アルファベット大文字・小文字、数字、アンダースコア  
      - ただし最初の文字はアルファベットである必要があります。
    - 未指定の場合は自動発行されます。

- **name**  
  - **型**: string  
  - **文字制限**: 1～64文字  
  - **説明**: 識別名  

- **displayName**  
  - **型**: string  
  - **文字制限**: 1～64文字  
  - **説明**: DB表示名

- **description**  
  - **型**: string  
  - **文字制限**: 0～512文字  
  - **説明**: DB説明

- **revision**  
  - **型**: string  
  - **説明**: DBリビジョン  

- **fields**  
  - **型**: Array of objects  
  - **説明**: フィールド一覧  

- **createdBy**  
  - **型**: object  
  - **説明**: 作成者  

- **updatedBy**  
  - **型**: object  
  - **説明**: 更新者  
  - **備考**: 更新がない場合は作成者と同じ内容になります。  

- **createdAt**  
  - **型**: string (<date-time>)  
  - **説明**: 作成日時  

- **updatedAt**  
  - **型**: string (<date-time>)  
  - **説明**: 更新日時  
### API Reference

---

#### Behavior for Records
- **No Updates on Record**: For records without updates, the creation timestamp is the same as the timestamp for the last update.

---

#### Error Handling: HTTP 403
Occurs in the following cases:
1. The application lacks necessary permissions (or has insufficient permissions).
2. The user does not have administrative access to application settings.

---

#### Response Headers

| Header Name                  | Type     | Description                             | Example    |
|------------------------------|----------|-----------------------------------------|------------|
| X-Spiral-App-Authority       | string   | Application permission type. Enum: `"use"`, `"manage"`. | `"manage"` |
| X-Spiral-App-Role            | string   | Application role.                       | `"employee"` |

---

#### Response Samples

- **Status Code**: `200`
- **Content Type**: `application/json`
{
  "id": "100",
  "name": "inquirydb",
  "displayName": "問い合わせ管理DB",
  "description": "問い合わせを管理するDBです",
  "revision": "1",
  "fields": [
    {
      "id": "1",
      "name": "name",
      "displayName": "氏名",
      "size": 128,
      "fieldOrder": 0,
      "type": "text",
      "required": true,
      "unique": false,
      "index": true,
      "minLength": "1",
      "maxLength": "128",
      "allowCharTypes": ["alphabet", "multibyte"],
      "regexp": "example.*"
    },
    {
      "id": "2",
      "name": "inquiry_detail",
      "displayName": "問い合わせ内容",
      "size": 1024,
      "fieldOrder": 1,
      "type": "textarea",
      "required": false,
      "unique": null
    }
  ]
}
```json
[
  {
    "id": "false",
    "index": false,
    "minLength": 1,
    "maxLength": 20000,
    "allowCharTypes": ["numeral", "alphabet", "sign", "multibyte"],
    "regexp": "example.*"
  },
  {
    "id": "3",
    "name": "email",
    "displayName": "メールアドレス",
    "size": 256,
    "fieldOrder": 2,
    "type": "email",
    "required": true,
    "unique": true,
    "index": true,
    "regexp": "^[a-z]+[.]+[a-z]*@.*",
    "allowDomains": ["pi-pe.co.jp"],
    "denyDomains": ["example.co.jp"]
  },
  {
    "id": "4",
    "name": "gender",
    "displayName": "性別",
    "size": 8,
    "fieldOrder": 3,
    "type": "select",
    "required": true,
    "index": true,
    "options": [
      {
        "id": "1",
        "label": "男性"
      }
    ]
  }
]
```
```json
[
  {
    "id": "5",
    "name": "inquiry_type",
    "displayName": "問い合わせ種別",
    "size": 125,
    "fieldOrder": 4,
    "type": "multiselect",
    "required": true,
    "index": false,
    "minSelection": "1",
    "maxSelection": "4",
    "options": [
      {
        "id": "1",
        "label": "資料請求"
      },
      {
        "id": "2",
        "label": "見積"
      },
      {
        "id": "3",
        "label": "サポート"
      },
      {
        "id": "4",
        "label": "その他"
      }
    ]
  },
  {
    "id": "6",
    "name": "inquiry_ID",
    "displayName": "問い合わせID",
    "size": 8,
    "fieldOrder": 5,
    "type": "integer",
    "required": true,
    "unique": true
  }
]
```
```json
[
  {
    "id": "7",
    "name": "weight",
    "displayName": "重量",
    "size": 8,
    "fieldOrder": 6,
    "type": "double",
    "required": true,
    "unique": false,
    "index": true,
    "minRange": "0",
    "maxRange": "100.0",
    "decimalDigit": {
      "digitNumber": "1",
      "enableRoundDown": false
    }
  },
  {
    "id": "8",
    "name": "phone",
    "displayName": "電話番号",
    "size": 19,
    "fieldOrder": 7,
    "type": "phone",
    "required": true,
    "unique": true,
    "index": true,
    "phoneRegionCode": "JP"
  },
  {
    "id": "9",
    "name": "response_date_time",
    "displayName": "対応日時",
    "size": 8,
    "fieldOrder": 8,
    "type": "dateTime",
    "required": true,
    "unique": false
  }
]
```
```json
[
  {
    "id": "10",
    "name": "response_date",
    "displayName": "対応日付",
    "size": 4,
    "fieldOrder": 9,
    "type": "date",
    "required": true,
    "unique": false,
    "index": true,
    "minRange": "1900-01-01",
    "maxRange": "2021-12-31"
  },
  {
    "id": "11",
    "name": "preferred_date",
    "displayName": "希望日",
    "size": 8,
    "fieldOrder": 10,
    "type": "monthDay",
    "required": false,
    "unique": false,
    "index": false,
    "minRange": "01-01",
    "maxRange": "12-31"
  },
  {
    "id": "12",
    "name": "preferred_time",
    "displayName": "希望時刻"
  }
]
```
```json
[
  {
    "id": null,
    "name": null,
    "displayName": null,
    "details": {
      "size": 8,
      "fieldOrder": 11,
      "type": "time",
      "required": true,
      "unique": false,
      "index": false,
      "minRange": "06:00:00",
      "maxRange": "12:00:00"
    }
  },
  {
    "id": "13",
    "name": "file",
    "displayName": "添付ファイル",
    "details": {
      "size": null,
      "fieldOrder": 12,
      "type": "file",
      "required": true,
      "allowFileExtensionCategories": ["text"],
      "allowFileExtensions": ["jpe", "jpg", "txt", "csv", "tsv"],
      "maxFiles": "10",
      "maxFileSize": "104857600"
    }
  },
  {
    "id": "14",
    "name": "password",
    "displayName": "パスワード",
    "details": {
      "size": 128,
      "fieldOrder": 13,
      "type": "password",
      "required": true,
      "minLength": "8",
      "maxLength": "128",
      "allowCharTypes": [
        "numeral",
        "sign",
        "lowercase_alphabet",
        "uppercase_alphabet"
      ]
    }
  }
]
```
```json
[
  {
    "minCharTypes": 4
  },
  {
    "id": "15",
    "name": "customer",
    "displayName": "顧客",
    "size": 8,
    "fieldOrder": 14,
    "type": "reference",
    "required": true,
    "referenceDb": {
      "id": "1",
      "name": "customer_address",
      "displayName": "顧客アドレス"
    },
    "referenceMultiple": true,
    "referenceLabelField": {
      "type": "_id",
      "id": "_id",
      "name": "_id",
      "displayName": "(ID)"
    },
    "referenceUnique": false,
    "minReference": 1,
    "maxReference": 10,
    "onReferenceDelete": "restrict",
    "multipleUnique": 1
  },
  {
    "id": "16",
    "name": "response_person",
    "displayName": "問い合わせ担当者",
    "size": 320,
    "fieldOrder": 15,
    "type": "user",
    "defaultValue": {
      "type": "dynamic",
      "valueType": null
    }
  }
]
```
### APIリファレンス：DBを変更

---
#### エンドポイント
- **ベーシックURL (SPIRAL ver.2):**  
  `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}`  
- **ベータ環境URL:**  
  `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}`  

#### 概要
指定のDBを変更する。

---

### パラメータ
#### Path Parameters
| パラメータ名 | 必須 | タイプ   | 説明                     |
|--------------|------|----------|--------------------------|
| `app`        | Yes  | `string` | アプリID                |
| `db`         | Yes  | `string` | DBID                    |

#### Request Body
Content-Type: `application/json`

| フィールド名       | タイプ   | 長さ                      | 必須 | 説明                                                                                                          |
|--------------------|----------|---------------------------|------|--------------------------------------------------------------------------------------------------------------|
| `name`            | `string` | 1〜64文字まで              | No   | 識別名。<br>アプリ内で重複不可。<br>使用可能文字: アルファベット大文字・小文字、数字、アンダースコア。<br>最初の文字はアルファベット。 |
| `displayName`     | `string` | 1〜64文字まで              | No   | DB表示名。<br>アプリ内で重複不可。                                                                          |
| `description`     | `string` | 0〜512文字まで             | No   | DB説明                                                                                                       |
| `revision`        | `string` | -                         | No   | DBリビジョン。<br>変更元のリビジョンを指定する必要があります。<br>指定されたリビジョンが最新でない場合、エラーが発生します。<br>指定しない場合、リビジョンのチェックを行いません。 |

---

### その他メタデータ
- **作成者:**  
  Type: `user`  
  UserID: `100`  
  Timestamp: `2021-01-28T03:57:23Z`

- **更新者:**  
  Type: `user`  
  UserID: `100`  
  Timestamp: `2021-01-28T03:57:23Z`
### API Reference

#### Request Parameters

1. **addFields**  
   - **Type**: Array of objects  
   - **Description**: 配列に追加するフィールド。  

2. **updateFields**  
   - **Type**: Array of objects  
   - **Description**: 配列に更新するフィールド。

3. **deleteFields**  
   - **Type**: Array of strings  
   - **Description**: 削除するフィールドのフィールドID、あるいはフィールド識別名の配列。  
   - **Restriction**: `multipleUnique`で指定されているフィールドは削除不可。

4. **fieldOrder**  
   - **Type**: Array of strings  
   - **Description**:  
     フィールドの並び順をフィールド識別名にて指定。配列内の並び順で設定。  
     一部のフィールドのみ指定する場合、配列の先頭に指定されたフィールドの順序に基づいて再配置される。  
   - **Error Handling**: 更新後に存在しないフィールド識別名を指定するとエラーを返す。  
   - **Behavior**:  
     1つのフィールドのみを指定した場合は、並び順は変わらない。

---

#### Responses

- **200 OK**  
  - **Description**: 変更後のDB。

##### Response Schema: `application/json`
1. **id**  
   - **Type**: string  
   - **Description**: DBID  

2. **name**  
   - **Type**: string  
   - **Character Limit**: 1〜64 characters  
   - **Description**: 識別名  
   - **Restrictions**:  
     - 重複不可  
     - 使用可能文字: アルファベット大文字・小文字、数字、アンダースコア  
     - 制約: 最初の文字はアルファベットである必要がある  
   - **Behavior**: 未指定の場合、自動発行。  

3. **displayName**  
   - **Type**: string  
   - **Character Limit**: 1〜64 characters  
   - **Description**: DB表示名
```
API Reference

Fields Description:

1. description
   - Type: string
   - Length: 0 to 512 characters
   - Description: DB説明

2. revision
   - Type: string
   - Description: DBリビジョン

3. fields
   - Type: Array of objects
   - Description: フィールド一覧

4. createdBy
   - Type: object
   - Description: 作成者

5. updatedBy
   - Type: object
   - Description: 更新者  
     Note: 更新がないレコードの場合、作成者と同じ値となる。

6. createdAt
   - Type: string
   - Format: <date-time>
   - Description: 作成日時

7. updatedAt
   - Type: string
   - Format: <date-time>
   - Description: 更新日時  
     Note: 更新がないレコードの場合、作成日時と同じ値となる。

Error Codes:

- 403  
  - Description: アプリ管理の設定権限がない

Request Samples:

- Content-Type: application/json
- Example Payload:
  ```json
  {
    "name": ""
  }
  ```
```
```json
{
  "id": "inquirydb",
  "displayName": "問い合わせ管理DB",
  "description": "問い合わせを管理するDBです",
  "revision": "1",
  "addFields": [
    {
      "name": "name",
      "displayName": "氏名",
      "type": "text",
      "required": true,
      "unique": false,
      "index": true,
      "minLength": "1",
      "maxLength": "128",
      "allowCharTypes": [
        "alphabet",
        "multibyte"
      ],
      "regexp": "example.*"
    },
    {
      "name": "inquiry_detail",
      "displayName": "問い合わせ内容",
      "type": "textarea",
      "required": false,
      "unique": false,
      "index": false,
      "minLength": "1",
      "maxLength": "20000",
      "allowCharTypes": [
        "numeral",
        "alphabet",
        "sign",
        "multibyte"
      ]
    }
  ]
}
```
```json
[
  {
    "name": "email",
    "displayName": "メールアドレス",
    "type": "email",
    "required": true,
    "unique": true,
    "index": true,
    "regexp": "^[a-z]+[.]+[a-z]*@.*",
    "allowDomains": ["pi-pe.co.jp"],
    "denyDomains": ["example.co.jp"]
  },
  {
    "name": "gender",
    "displayName": "性別",
    "type": "select",
    "required": true,
    "index": true,
    "options": [
      {
        "id": "1",
        "label": "男性"
      },
      {
        "id": "2",
        "label": "女性"
      }
    ]
  },
  {
    "name": "inquiry_type",
    "displayName": "問い合わせ種別",
    "type": "multiselect",
    "required": true,
    "index": false,
    "minSelection": "1",
    "maxSelection": null
  }
]
```
```json
{
  "fields": [
    {
      "id": "1",
      "label": "資料請求"
    },
    {
      "id": "2",
      "label": "見積"
    },
    {
      "id": "3",
      "label": "サポート"
    },
    {
      "id": "4",
      "label": "その他"
    }
  ],
  "parameters": [
    {
      "name": "inquiry_ID",
      "displayName": "問い合わせID",
      "type": "integer",
      "required": true,
      "unique": true,
      "index": true,
      "minRange": 1,
      "maxRange": 10000
    },
    {
      "name": "weight",
      "displayName": "重量",
      "type": "double",
      "required": true,
      "unique": false,
      "index": true,
      "minRange": 0,
      "maxRange": 100.0,
      "decimalDigit": {
        "digitNumber": 1,
        "enableRoundDown": false
      }
    },
    {
      "name": "phone",
      "displayName": "電話番号"
    }
  ]
}
```
```json
[
  {
    "name": "phone",
    "type": "phone",
    "required": true,
    "unique": true,
    "index": true,
    "phoneRegionCode": "JP"
  },
  {
    "name": "response_date_time",
    "displayName": "対応日時",
    "type": "dateTime",
    "required": true,
    "unique": false,
    "index": false,
    "minRange": "1989-12-31T15:00:00Z",
    "maxRange": "2021-12-31T14:30:00Z"
  },
  {
    "name": "response_date",
    "displayName": "対応日付",
    "type": "date",
    "required": true,
    "unique": false,
    "index": true,
    "minRange": "1900-01-01",
    "maxRange": "2021-12-31"
  },
  {
    "name": "preferred_day",
    "displayName": "希望日",
    "type": "monthDay",
    "required": false,
    "unique": false,
    "index": false,
    "minRange": "01-01"
  }
]
```
```json
[
  {
    "name": "maxRange",
    "type": "range",
    "range": "12-31"
  },
  {
    "name": "preferred_time",
    "displayName": "希望時刻",
    "type": "time",
    "required": true,
    "unique": false,
    "index": false,
    "minRange": "06:00:00",
    "maxRange": "12:00:00"
  },
  {
    "name": "file",
    "displayName": "添付ファイル",
    "type": "file",
    "required": true,
    "allowFileExtensionCategories": ["text"],
    "allowFileExtensions": ["jpeg", "jpg", "txt"],
    "maxFiles": "10",
    "maxFileSize": "104857600"
  },
  {
    "name": "password",
    "displayName": "パスワード",
    "type": "password",
    "required": true,
    "minLength": "8",
    "maxLength": "128",
    "allowCharTypes": [
      "numeral",
      "sign",
      "lowercase_alphabet",
      "uppercase_alphabet"
    ],
    "minCharTypes": "4"
  }
]
```
```json
{
  "fields": [
    {
      "name": "customer",
      "displayName": "顧客",
      "type": "reference",
      "required": true,
      "referenceDbId": "1",
      "referenceMultiple": true,
      "referenceLabelFieldId": "_id",
      "referenceUnique": false,
      "minReference": "1",
      "maxReference": "10",
      "onReferenceDelete": "restrict",
      "multipleUnique": "1"
    },
    {
      "name": "response_person",
      "displayName": "問い合わせ担当者",
      "type": "user",
      "defaultValue": {
        "type": "dynamic",
        "valueType": 5,
        "isOverwrite": true
      },
      "required": true,
      "unique": false,
      "index": false
    }
  ],
  "updateFields": [
    {
      "id": "1",
      "name": "name",
      "displayName": "氏名",
      "required": true,
      "unique": true,
      "index": true,
      "minLength": "1",
      "maxLength": "128",
      "allowCharTypes": [
        "alphabet",
        "multibyte"
      ]
    }
  ]
}
```
```json
[
  {
    "id": "1",
    "name": "regexp",
    "regexp": "example.*"
  },
  {
    "id": "2",
    "name": "inquiry_detail",
    "displayName": "問い合わせ内容",
    "required": false,
    "unique": false,
    "index": false,
    "minLength": "1",
    "maxLength": "20000",
    "allowCharTypes": ["numeral", "alphabet", "sign", "multibyte"],
    "regexp": "example.*"
  },
  {
    "id": "3",
    "name": "email",
    "displayName": "メールアドレス",
    "required": true,
    "unique": true,
    "index": true,
    "regexp": "^[a-z]+[.]+[a-z]*@.*",
    "allowDomains": ["pi-pe.co.jp"],
    "denyDomains": ["example.co.jp"]
  },
  {
    "id": "4",
    "name": "gender",
    "displayName": "性別",
    "required": true,
    "index": true
  }
]
```
```json
[
  {
    "id": "3",
    "addOptions": [
      {
        "id": "3",
        "label": "他"
      }
    ],
    "updateOptions": [
      {
        "id": "1",
        "label": "男性"
      },
      {
        "id": "2",
        "label": "女性"
      }
    ],
    "deleteOptions": [2]
  },
  {
    "id": "5",
    "name": "inquiry_type",
    "displayName": "問い合わせ種別",
    "required": true,
    "index": false,
    "minSelection": "1",
    "maxSelection": "4",
    "addOptions": [
      {
        "id": "99",
        "label": "その他"
      }
    ],
    "updateOptions": [
      {
        "id": "1",
        "label": "資料請求"
      },
      {
        "id": "2",
        "label": "見積"
      },
      {
        "id": "3",
        "label": "サポート"
      }
    ],
    "deleteOptions": [4]
  },
  {
    "id": "6",
    "name": "inquiry_ID"
  }
]
```
```json
[
  {
    "displayName": "問い合わせID",
    "required": true,
    "unique": true,
    "index": true,
    "minRange": "1",
    "maxRange": "10000"
  },
  {
    "id": "7",
    "name": "weight",
    "displayName": "重量",
    "required": true,
    "unique": false,
    "index": true,
    "minRange": "0",
    "maxRange": "100.0",
    "decimalDigit": {
      "digitNumber": "1",
      "enableRoundDown": false
    }
  },
  {
    "id": "8",
    "name": "phone",
    "displayName": "電話番号",
    "required": true,
    "unique": true,
    "index": true,
    "phoneRegionCode": "JP"
  },
  {
    "id": "9",
    "name": "response_date_time",
    "displayName": "対応日時",
    "required": true,
    "unique": false,
    "index": false,
    "minRange": "1989-12-31T15:00:00Z"
  }
]
```
```json
[
  {
    "id": "10",
    "name": "response_date",
    "displayName": "対応日付",
    "required": true,
    "unique": false,
    "index": false,
    "minRange": "1900-01-01",
    "maxRange": "2021-12-31T14:30:00Z"
  },
  {
    "id": "11",
    "name": "preferred_date",
    "displayName": "希望日",
    "required": false,
    "unique": false,
    "index": false,
    "minRange": "01-01",
    "maxRange": "12-31"
  },
  {
    "id": "12",
    "name": "preferred_time",
    "displayName": "希望時刻",
    "required": true,
    "unique": false,
    "index": false,
    "minRange": "06:00:00",
    "maxRange": "12:00:00"
  },
  {
    "id": "13",
    "name": "file",
    "displayName": null,
    "required": null,
    "unique": null,
    "index": null,
    "minRange": null,
    "maxRange": null
  }
]
```
```
{
  "fields": [
    {
      "id": "13",
      "name": "添付ファイル",
      "required": true,
      "allowFileExtensionCategories": ["text"],
      "allowFileExtensions": ["jpeg", "jpg", "txt"],
      "maxFiles": 10,
      "maxFileSize": 104857600
    },
    {
      "id": "14",
      "name": "password",
      "displayName": "パスワード",
      "required": true,
      "minLength": 8,
      "maxLength": 128,
      "allowCharTypes": [
        "numeral",
        "sign",
        "lowercase_alphabet",
        "uppercase_alphabet"
      ],
      "minCharTypes": 4
    },
    {
      "id": "15",
      "name": "customer",
      "displayName": "顧客",
      "required": true,
      "referenceLabelFieldId": "_id",
      "referenceUnique": false,
      "minReference": 1,
      "maxReference": 10,
      "onReferenceDelete": "restrict",
      "multipleUnique": 1
    },
    {
      "id": "16",
      "name": "response_person",
      "displayName": "問い合わせ担当者"
    }
  ]
}
```
```json
{
  "defaultValue": {
    "type": "dynamic",
    "valueType": 5,
    "isOverwrite": true
  },
  "required": true,
  "unique": false,
  "index": false
},
"deleteFields": [10, 11],
"fieldOrder": [
  "inquiry_ID",
  "inquiry_type",
  "inquiry_detail",
  "response_date_time",
  "preferred_time"
],
"multipleUnique": [100, 200],
"responseSamples": {
  "200": {
    "contentType": "application/json",
    "sample": {
      "id": "100",
      "name": "inquirydb",
      "displayName": "問い合わせ管理DB",
      "description": "問い合わせを管理するDBです",
      "revision": "1",
      "fields": [
        {
          "id": "1",
          "name": "name",
          "displayName": "氏名",
          "size": 128,
          "fieldOrder": 0,
          "type": "text",
          "required": true
        }
      ]
    }
  }
}
```
```json
[
  {
    "id": "1",
    "name": "name",
    "displayName": "名前",
    "size": 128,
    "fieldOrder": 0,
    "type": "text",
    "required": true,
    "unique": false,
    "index": true,
    "minLength": "1",
    "maxLength": "128",
    "allowCharTypes": ["alphabet", "multibyte"],
    "regexp": "example.*"
  },
  {
    "id": "2",
    "name": "inquiry_detail",
    "displayName": "問い合わせ内容",
    "size": 1024,
    "fieldOrder": 1,
    "type": "textarea",
    "required": false,
    "unique": false,
    "index": false,
    "minLength": "1",
    "maxLength": "20000",
    "allowCharTypes": ["numeral", "alphabet", "sign", "multibyte"],
    "regexp": "example.*"
  },
  {
    "id": "3",
    "name": "email",
    "displayName": "メールアドレス",
    "size": 256,
    "fieldOrder": 2,
    "type": "email",
    "required": true,
    "unique": true,
    "index": true,
    "regexp": "^[a-z]+[."
  }
]
```
```json
[
  {
    "id": "4",
    "name": "gender",
    "displayName": "性別",
    "size": 8,
    "fieldOrder": 3,
    "type": "select",
    "required": true,
    "index": true,
    "options": [
      { "id": "1", "label": "男性" },
      { "id": "2", "label": "女性" }
    ]
  },
  {
    "id": "5",
    "name": "inquiry_type",
    "displayName": "問い合わせ種別",
    "size": 125,
    "fieldOrder": 4,
    "type": "multiselect",
    "required": true,
    "index": false,
    "minSelection": "1",
    "maxSelection": "4",
    "options": [
      { "id": "1", "label": "資料請求" }
    ]
  }
]
```
```json
[
  {
    "id": "2",
    "label": "見積"
  },
  {
    "id": "3",
    "label": "サポート"
  },
  {
    "id": "4",
    "label": "その他"
  }
],
{
  "id": "6",
  "name": "inquiry_ID",
  "displayName": "問い合わせID",
  "size": 8,
  "fieldOrder": 5,
  "type": "integer",
  "required": true,
  "unique": true,
  "index": true,
  "minRange": "1",
  "maxRange": "10000"
},
{
  "id": "7",
  "name": "weight",
  "displayName": "重量",
  "size": 8,
  "fieldOrder": 6,
  "type": "double",
  "required": true,
  "unique": false,
  "index": true,
  "minRange": "0",
  "maxRange": "100.0",
  "decimalDigit": {
    "digitNumber": "1",
    "enableRoundDown": false
  }
},
{
  "id": "8",
  "name": "phone",
  "displayName": ""
}
```
```json
[
  {
    "id": "7",
    "name": "phone_number",
    "displayName": "電話番号",
    "size": 19,
    "fieldOrder": 7,
    "type": "phone",
    "required": true,
    "unique": true,
    "index": true,
    "phoneRegionCode": "JP"
  },
  {
    "id": "9",
    "name": "response_date_time",
    "displayName": "対応日時",
    "size": 8,
    "fieldOrder": 8,
    "type": "dateTime",
    "required": true,
    "unique": false,
    "index": false,
    "minRange": "1989-12-31T15:00:00Z",
    "maxRange": "2021-12-31T14:30:00Z"
  },
  {
    "id": "10",
    "name": "response_date",
    "displayName": "対応日付",
    "size": 4,
    "fieldOrder": 9,
    "type": "date",
    "required": true,
    "unique": false,
    "index": true,
    "minRange": "1900-01-01",
    "maxRange": "2021-12-31"
  }
]
```
- **Field 1**
  - **ID**: 11  
  - **Name**: preferred_date  
  - **Display Name**: 希望日  
  - **Size**: 8  
  - **Field Order**: 10  
  - **Type**: monthDay  
  - **Required**: false  
  - **Unique**: false  
  - **Index**: false  
  - **Min Range**: 01-01  
  - **Max Range**: 12-31  

- **Field 2**
  - **ID**: 12  
  - **Name**: preferred_time  
  - **Display Name**: 希望時刻  
  - **Size**: 8  
  - **Field Order**: 11  
  - **Type**: time  
  - **Required**: true  
  - **Unique**: false  
  - **Index**: false  
  - **Min Range**: 06:00:00  
  - **Max Range**: 12:00:00  

- **Field 3**
  - **ID**: 13  
  - **Name**: file  
  - **Display Name**: 添付ファイル  
  - **Size**: null  
  - **Field Order**: 12  
  - **Type**: file  
  - **Required**: true  
  - **Allow File Extension Categories**: [text]  
  - **Allow File Extensions**: [jpe]  
```json
[
  {
    "id": "14",
    "name": "password",
    "displayName": "パスワード",
    "size": 128,
    "fieldOrder": 13,
    "type": "password",
    "required": true,
    "minLength": "8",
    "maxLength": "128",
    "allowCharTypes": [
      "numeral",
      "sign",
      "lowercase_alphabet",
      "uppercase_alphabet"
    ],
    "minCharTypes": "4"
  },
  {
    "id": "15",
    "name": "customer",
    "displayName": "顧客",
    "size": 8,
    "fieldOrder": 14,
    "type": "reference",
    "required": true,
    "referenceDb": {
      "id": "1",
      "name": "customer_address",
      "displayName": "顧客アドレス"
    },
    "referenceMultiple": true,
    "referenceLabelField": {
      "type": "_id",
      "id": "_id",
      "name": "_id"
    }
  }
]
```
```json
{
  "fields": [
    {
      "id": "16",
      "name": "response_person",
      "displayName": "問い合わせ担当者",
      "size": 320,
      "fieldOrder": 15,
      "type": "user",
      "defaultValue": {
        "type": "dynamic",
        "valueType": 5,
        "isOverwrite": true
      },
      "required": true,
      "unique": false,
      "index": false
    }
  ],
  "referenceSettings": {
    "referenceUnique": false,
    "minReference": "1",
    "maxReference": "10",
    "onReferenceDelete": "restrict",
    "multipleUnique": "1"
  },
  "auditInfo": {
    "createdBy": {
      "type": "user",
      "userId": "100"
    },
    "updatedBy": {
      "type": "user",
      "userId": "100"
    },
    "createdAt": "2021-01-28T03:57:23Z",
    "updatedAt": "2021-01-28T03:57:23Z"
  },
  "apiEndpoints": {
    "deleteDatabase": "delete/apps/{app}/dbs/{db}"
  },
  "system": "SPIRAL"
}
```
```
# API リファレンス構造

## バージョン 2

### 1. データベース削除 API

- **URL（本番環境）**:  
  `https://api.spiral-platform.com/v1/apps/{app}/dbs/{db}`

- **URL（ベータ環境）**:  
  `https://api.beta.spiral-platform.net/v1/apps/{app}/dbs/{db}`

- **説明**:  
  指定されたデータベース（DB）を削除するAPIです。

  - DBに依存する設定が存在する場合、削除はエラーとなります。  
  - 一部の設定はDB削除時に連動して削除される場合があります。  
  - 詳細な挙動についてはサポートサイトをご確認ください。

- **リクエストパラメータ**:
  - **Path Parameters**:
    - `app` (required, string): アプリID
    - `db` (required, string): DBID

- **レスポンス**:
  - **204**: レスポンスデータなし
  - **403**: アプリ管理の設定権限が不足している

---

### 2. アクション実行 API

- **URL（本番環境）**:  
  `https://api.spiral-platform.com/v1/apps/{app}/actions/{actionId}/run`

- **URL（ベータ環境）**:  
  `https://api.beta.spiral-platform.net/v1/apps/{app}/actions/{actionId}/run`

- **説明**:  
  指定のアクションを実行するAPIです。

- **リクエストパラメータ**:
  - **Path Parameters**:
    - `app` (required, string): アプリID
    - `actionId` (required, string): アクションID

  - **Request Body**:
    - スキーマ: application/json  
      （アクション毎に異なるリクエストボディが必要。詳細はサポートサイトをご確認ください。）

- **レスポンス**:
  - **204**: レスポンスデータなし
```
# API リファレンス

## エラーコード
### 403 アプリ管理の設定権限がない

---

## 認証エリアにログイン API  
**エンドポイント**:  
- **本番環境**  
  `https://api.spiral-platform.com/v1/sites/{siteId}/authentications/{authenticationId}/login`
- **ベータ環境**  
  `https://api.beta.spiral-platform.net/v1/sites/{siteId}/authentications/{authenticationId}/login`

**説明**:  
本番環境の認証エリアにログインし、セッションに紐づくエリア認証トークンを発行します。このトークンの有効期限は、認証エリアで設定されたセッション有効期限に準じます。APIエージェントのみが使用可能です。

---

### パラメーター

#### Path Parameters
| パラメーター名        | 必須  | 型     | 説明               |
|-----------------------|-------|--------|--------------------|
| `siteId`             | 必須  | string | サイトID           |
| `authenticationId`   | 必須  | string | 認証エリアID       |

---

#### リクエストボディ
**Content-Type**: `application/json`

| フィールド名        | 必須  | 型     | 説明                                      |
|---------------------|-------|--------|-------------------------------------------|
| `id`               | 必須  | string | 認証エリアで指定されたIDフィールドの値   |
| `password`         | 必須  | string | 認証エリアで指定されたパスワードの値     |

---

### レスポンス

#### ステータスコード
- **200**: 発行されたエリア認証トークンを取得します。

#### レスポンススキーマ
**Content-Type**: `application/json`

| フィールド名        | 型     | 説明                                   |
|---------------------|--------|----------------------------------------|
| `recordId`         | string | ID・パスワードによって認証したレコードID |
### API リファレンス構造化

---

#### **エリア認証トークンの生成**

##### **リクエスト情報**
- **Payload Content-Type**: `application/json`

```json
{
  "id": "spiral.taro",
  "password": "7jSkFW5,.T_D~hE"
}
```

##### **レスポンス情報**
- **成功時 (200)** Content-Type: `application/json`

```json
{
  "recordId": "100",
  "token": "59220e7f-b813-47d8-8a1e-95cacd88a13e",
  "expireTime": 1588266389
}
```

---

#### **エリア認証トークンの有効性確認**

##### **概要**
- セッションに紐づくエリア認証トークンの有効性を確認します。
- 指定するエリア認証トークンを発行したAPIエージェントのみ使用可能です。
- デフォルトで、有効性確認と同時にセッションの有効期限が延長されます。

##### **エンドポイント**
- **SPIRAL ver.2 API サーバ(本番環境):**
  - `https://api.spiral-platform.com/v1/sites/{siteId}/authentications/{authenticationId}/status`

- **SPIRAL ver.2 API サーバ(ベータ環境):**
  - `https://api.beta.spiral-platform.net/v1/sites/{siteId}/authentications/{authenticationId}/status`

##### **リクエスト情報**

- **パスパラメータ**
  - `siteId` (必須): サイトID (string)
  - `authenticationId` (必須): 認証エリアID (string)

- **リクエストボディ**  
  - Content-Type: `application/json`
  
```json
{
  "token": "{エリア認証トークン}"
}
```

##### **レスポンスフィールド**
- **token** (string): エリア認証トークン
- **expireTime** (integer): エリア認証トークンの有効期限日時（エポック秒）
### APIリファレンス

---

#### **エリア認証トークンの有効期限の延長**

- **`extendExpireTime`** (boolean)  
  - デフォルト: `true`  
  - エリア認証トークンの有効期限を延長します。延長時間は認証エリアで設定されたセッション有効期限に基づきます。
  - 値:  
    - `true`: 有効期限を延長する  
    - `false`: 有効期限を延長しない  

---

#### **レスポンス**

- **HTTP 200**  
  指定したエリア認証トークンの有効性情報を取得します。

##### **Response Schema: application/json**
- **`status`** (boolean)  
  - エリア認証トークンの有効性  
  - 値:  
    - `true`: 有効  
    - `false`: 無効  

- **`expireTime`** (integer)  
  - エリア認証トークンの有効期限日時（エポック秒）  
  - **注意**: `status` が `false` の場合は `null` を返します。  

---

#### **リクエストサンプル**

##### Payload
- **Content type**: `application/json`
```json
{
  "token": "59220e7f-b813-47d8-8a1e-95cacd88a13e",
  "extendExpireTime": true
}
```

---

#### **レスポンスサンプル**

##### HTTP 200
- **Content type**: `application/json`
```json
{
  "status": true,
  "expireTime": 1588266389
}
```

---

#### **認証エリアログインのワンタイムURL発行**

- **HTTP メソッド**: `POST`
- **エンドポイント**:  
  - 本番環境: `https://api.spiral-platform.com/v1/sites/{siteId}/authentications/{authenticationId}/oneTimeLogin`  
  - ベータ環境: `https://api.spiral-platform.com/v1/sites/{siteId}/authentications/{authenticationId}/oneTimeLogin`  
### API Reference

#### Endpoint

**URL**
```
https://api.beta.spiral-platform.net/v1/sites/{siteId}/authentications/{authenticationId}/oneTimeLogin
```

**Description**
- Generates a one-time URL that allows browser login to an authenticated area using a valid area authentication token.
- The one-time URL becomes invalid after the first access and cannot be reused.
- The token can only be used by the API agent that issued the area authentication token.

---

#### Path Parameters

| Name               | Required | Type   | Description                   |
|--------------------|----------|--------|-------------------------------|
| `siteId`           | Yes      | string | Site ID                       |
| `authenticationId` | Yes      | string | Authentication Area ID        |

---

#### Request Body

**Content-Type:** `application/json`

| Name   | Required | Type   | Description                                                                                      |
|--------|----------|--------|--------------------------------------------------------------------------------------------------|
| `token`| Yes      | string | Area authentication token. If invalid, an error will occur.                                      |
| `path` | Yes      | string | Page path of the authenticated area to be displayed after login. Can only specify authenticated areas logged in via the login API. |

---

#### Responses

| Status Code | Description                                        |
|-------------|----------------------------------------------------|
| `200`       | A one-time URL has been issued for the specified page path. |

**Response Schema:** `application/json`

| Name | Type   | Description                                                                                                                  |
|------|--------|------------------------------------------------------------------------------------------------------------------------------|
| `url`| string | One-time URL with query parameters for logging in to the specified page path.                                                |
|      |        | Valid for 1 minute after issuing, or invalidated upon being accessed once, or when a new URL is issued with the same token.  |
### APIリファレンス

---

#### サンプルリクエスト

**Payload**  
Content-Type: `application/json`  

```json
{
  "token": "59220e7f-b813-47d8-8a1e-95cacd88a13e",
  "path": "/memberAuth/update"
}
```

---

#### サンプルレスポンス

**200 Success**  
Content-Type: `application/json`  

```json
{
  "url": "https://example.com/memberAuth/update?tid=50ce7b8a-e612-42ae-b5af-9748b2808310_jwnfswnrda_c3bd085f9045469da024593dd50a4cc4f0c86e2a99d68f1a784ee20acb300697"
}
```

---

### 認証エリアからログアウト  

#### エンドポイント

##### 本番環境  
`POST https://api.spiral-platform.com/v1/sites/{siteId}/authentications/{authenticationId}/logout`

##### ベータ環境  
`POST https://api.beta.spiral-platform.net/v1/sites/{siteId}/authentications/{authenticationId}/logout`

#### 概要  

- 本番環境で指定された認証エリアからログアウトします。  
- ログアウト後、**エリア認証トークン**は無効になります。  
- ワンタイムURLを用いて認証エリアにログインしている場合、そのセッションもログアウトされます。  
- **エリア認証トークン**は、トークンを発行したAPIエージェント以外では使用できません。  

---

#### パスパラメータ

| **パラメータ名**        | **型**  | **必須** | **説明**          |
|-------------------------|---------|----------|-------------------|
| `siteId`               | string  | required | サイトID          |
| `authenticationId`     | string  | required | 認証エリアID      |

---

#### リクエストボディ

**Content-Type:** `application/json`  

| **フィールド名** | **型**    | **必須** | **説明**          |
|-------------------|-----------|----------|-------------------|
| `token`          | string    | required | エリア認証トークン |  
```
# API Reference

## Endpoint: Logout from Authentication Area

### Description
Logs out from the specified authentication area. Will result in an error if the operation is invalid.

---

### Responses

- **204**: Successfully logs out from the specified authentication area.

---

### Request Samples

#### Payload
Content-Type: `application/json`

```json
{
  "token": "59220e7f-b813-47d8-8a1e-95cacd88a13e"
}
```
```